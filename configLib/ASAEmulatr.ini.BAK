; ===============================================================================
; Alpha Emulator Configuration File - COMPLETE VERSION
; ===============================================================================
; System sections remain unchanged
; Device sections use flattened structure with dot notation
; ===============================================================================

; ===============================================================================
; SYSTEM CONFIGURATION
; ===============================================================================

[System]
MemorySizeGB=32
hw-Model=ES40 
hw-Serial-Number=AX122312341243134
Coherency-Cache=2048
Platform-Ev=6
PTE-PageSize=8192
ThreadCount=4
Processor-Count=1
; DS10[0]       // Tsunami chipset, 2 GB RAM max
; DS20[1]       // Tsunami chipset, 2 GB RAM max
; ES40[2]       // Clipper chipset, 64 GB RAM max
; ES45[3]       // Clipper chipset, 64 GB RAM max
; GS80[4]       // Wildfire chipset, 128 GB RAM max
; GS160[5]      // Wildfire chipset, 256 GB RAM max
; GS320[6]      // Wildfire chipset, 512 GB RAM max
system_type_q8=2
CPU_FREQUENCY_HZ=500000000

; ===============================================================================
; MEMORY MAP CONFIGURATION - Physical Address Space Layout
; ===============================================================================

[MemoryMap]
; Hardware Restart Parameter Block (SRM boot parameters)
HwrpbBase=0x2000
HwrpbSize=0x4000

; PALcode region (may be unused in C++ PAL emulation)
;PALcode offset within SRM firmware file (clipper.bin specific)
; NOTE: clipper.bin has headers at 0x0-0x7FFF, PAL code starts at 0x8000
; bin implementations may require an offset to bypass the bin-section-HWPCB
; PalBase = 0x0 (default)
PalBase=0x8000 
PalSize=0x10000

; SRM firmware ROM (clipper.bin loads here)
SrmBase=0x20000000
SrmSize=0x200000

; Main system RAM (size from [System] MemorySizeGB)
; NOTE: 0x200000000 (8 GB) is ONLY safe if RAM ceiling is below 8 GB.
RamBase=0x80000000

; Memory-mapped I/O - Device registers
MmioBase=0xF0000000
MmioSize=0x10000000

; ---------------------------------------------------------------------------
; PCI MEMORY WINDOW (Device BAR space) - PHYSICAL addresses
; ---------------------------------------------------------------------------
; Purpose:
;   64-bit PCIe/PCI BAR mappings for MMIO buffers (NIC rings, framebuffers,
;   DMA windows, controller SRAM, etc.). This is NOT normal RAM.
;
; Requirements / Constraints:
;   1) MUST be above the top of system RAM (no overlap with RAM region).
;      RamTop = RamBase + RamSizeBytes
;      PciMemBase >= align_up(RamTop + GuardGap, PciAlignment)
;
;   2) MUST NOT overlap any other fixed regions (SRM, PAL, MMIO window, etc.).
;
;   3) SHOULD be aligned to a large boundary so BAR allocations are simple:
;      Recommended alignment: 256 MB (0x10000000) minimum
;      Better: 1 GB (0x40000000) or 4 GB (0x100000000) if you want clean decoding.
;
;   4) Size should be large enough for all device BARs:
;      Typical emulator default: 4 GB (0x100000000) or larger if you emulate GPUs.
;
; Auto mode:
;   PciMemBase=auto computes:
;     RamTop = RamBase + RamSizeBytes
;     Base   = align_up(RamTop + 1GB_guard, 1GB_alignment)
;   Example with RamBase=0x80000000:
;     32 GB RAM: RamTop=0x880000000 -> Base>=0x8C0000000 (if 1GB guard & 1GB align)
;     64 GB RAM: RamTop=0x1080000000 -> Base>=0x10C0000000
;
; Manual mode:
;   Only use explicit values if you also enforce the non-overlap rules above.
; ---------------------------------------------------------------------------
PciMemBase=auto
PciMemSize=0x100000000


# ===========================================================================
# USAGE WARNINGS:
# ===========================================================================
# 1. DO NOT overlap regions - GuestMemory will reject overlapping routes
# 2. SRM firmware must be loaded to SrmBase physical address
# 3. HWRPB must be initialized with correct values before OS boot
# 4. PAL region may be unused in C++ PAL emulation
# 5. These are PHYSICAL addresses - VA translation happens separately
# 6. Real hardware had fixed layouts; emulator can be flexible but should
#    match real system (ES40) for compatibility
# ===========================================================================

# ===========================================================================
# COMPATIBILITY NOTES:
# ===========================================================================
# ES40 (Clipper chipset): Supports up to 64 GB RAM
# - Use RamBase=0x80000000 for compatibility
# - PCI window must be above RAM ceiling
#
# DS10/DS20 (Tsunami chipset): Limited to 2 GB RAM
# - Same layout but smaller RAM region
# ===========================================================================

; ===============================================================================
; LOGGING CONFIGURATION
; ===============================================================================

[Logging]
TraceEnabled=false
EnableDiskLogging=true
EnableConsole=true
logLevel=0
AppendLog=append
logFileName=es40_instance.log
MaxLogFileSizeBytes=104857600
MaxLogFileCount=10
logRegisterState=true
regEnableDiskLogging=true
regEnableConsole=true
EnableTimestamps=true
UseHighPerfTimestamps=true
FlushInterval=1000  ; Flush every 1 second (0 = immediate) // TODO

; ===============================================================================
; EXECUTION TRACE CONFIGURATION
; ===============================================================================

[ExecTrace]
ExecTraceEnabled=true
ExecTraceMode=continuous
PerCpuTraceFiles=true
TraceFilePattern=traces/es40_instance.cpu{cpu}.trace
MaxTraceFileSizeBytes=1073741824
MaxTraceFileCount=10
TraceRingRecordsPerCpu=10000
TraceDumpPreRecords=32
TraceDumpPostRecords=32
CpuMask=0x1
TriggerOnException=true
TriggerOnIpi=true
TriggerOnPalEntry=false
TriggerOnPalExit=false
PcRangeEnabled=false
PcRangeStart=0x0000000000000000
PcRangeEnd=0x0000000000000000
IncludeIntRegWrites=true
IncludeFpRegWrites=false
IncludeIprWrites=true
IncludeMemVA=true
IncludeMemPA=false
IncludeOpcodeWord=true
FlushIntervalMs=200
FullTraceDebugBuildOnly=true

; ===============================================================================
; TLB SHOOTDOWN CONFIGURATION
; ===============================================================================

[TLBShootdown]
EnableACKs=false
EnablePreciseInvalidation=false
EnableShootdownLogging=false
MaxShootdownSeq=255

; ===============================================================================
; INTERRUPT CONFIGURATION
; ===============================================================================

[Interrupts]
EnableInterruptMaskingLog=false
CriticalInterruptVectors=0x0080-0x00FF,0x0680,0x0700

; ===============================================================================
; FLOATING POINT CONFIGURATION
; ===============================================================================

[FloatingPoint]
UseSSEForF_Float=0
UseSSEForG_Float=0
UseSSEForD_Float=0
UseSSEForS_Float=1
UseSSEForT_Float=1

; ===============================================================================
; ROM/FIRMWARE CONFIGURATION
; ===============================================================================

[Rom]
; Option 1: Just filename (resolves to <install>/firmware/clipper.bin)
;clipperFileName=clipper.bin

; Option 2: Relative path (resolves to <install>/firmware/custom/clipper.bin)
;clipperFileName=custom/clipper.bin

; Option 3: Absolute path (used as-is)
;clipperFileName=C:/custom/firmware/clipper.bin

; Option 4: Empty (uses default: <install>/firmware/clipper.bin)
;clipperFileName=
clipperFileName=clipper.bin
HostProcessorModuleFirmwareFile=hpmrom.hex
PCIBusModuleFirmWare=pbmrom.hex
SystemModuleFirmwareFile=scmrom.hex
IntelHexLoaderFile=clipper.hex

; ===============================================================================
; CACHE CONFIGURATION
; ===============================================================================

[CACHE/l1]
NumSets=256
Associativity=2
LineSize=64
EnablePrefetch=true
EnableStatistics=true
EnableCoherency=true
CoherencyProtocol=MESI
StatusUpdateInterval=1000
ReplacementPolicy=MRU
EvictionThreshold=1000
CacheSize=48

[CACHE/L2]
NumSets=512
Associativity=4
LineSize=64
TotalSize=131072
EnablePrefetch=true
EnableStatistics=true
EnableCoherency=true
CoherencyProtocol=MESI
StatusUpdateInterval=1000
ReplacementPolicy=MRU
EvictionThreshold=1000
CacheSize=64

[CACHE/L3]
NumSets=1024
Associativity=8
LineSize=64
TotalSize=524288
EnablePrefetch=true
EnableStatistics=true
EnableCoherency=true
CoherencyProtocol=MOESI
StatusUpdateInterval=1000
ReplacementPolicy=MRU
EvictionThreshold=1000

; ===============================================================================
; CONSOLE DEVICES (OPA0, OPA1) - FLATTENED
; ===============================================================================

[Device.OPA0]
classType=UART
name=OPA0
location=cab0/drw0
iface=Net
iface_port=5555
application=putty -raw localhost 5555
rx_buffer_size=256
tx_buffer_size=1024
drop_on_overflow=true
auto_reconnect=true

[Device.OPA1]
classType=UART
name=OPA1
location=cab0/drw0
iface=Net
iface_port=5678
application=putty -load opa1
rx_buffer_size=256
tx_buffer_size=1024
drop_on_overflow=true
auto_reconnect=true

; ===============================================================================
; CONTROLLERS (PKB0, PKC0, PQA0, EWA0) - FLATTENED
; ===============================================================================

[Device.PKB0]
classType=SCSI_HBA
controller_type=KZPBA
location=cab0/drw0/io0/hose0/bus3/slot1
hose=0
pci_bus=3
pci_slot=1
pci_function=0
scsi_id=7
mmio.bar0=auto
irqStr=auto
irqIpl=20
irqTrigger=LEVEL
irqPolicy=ROUND_ROBIN

[Device.PKC0]
classType=SCSI_HBA
controller_type=KZPBA
model=QLogic ISP1040B
location=cab0/drw0/io0/hose0/bus4/slot1
hose=0
pci_bus=4
pci_slot=1
pci_function=0
scsi_id=7
mmio.bar0=auto
irqStr=auto
irqIpl=20
irqTrigger=LEVEL
irqPolicy=ROUND_ROBIN

[Device.EWA0]
classType=NIC
description=DE500 Fast Ethernet
location=cab0/drw0/io0/hose0/bus1/slot1
hose=0
pci_bus=1
pci_slot=1
pci_function=0
mac_address=00-68-EB-AA-9E-63
mmio.bar0=auto
irqStr=auto
irqIpl=18
irqTrigger=LEVEL
irqPolicy=ROUND_ROBIN

[Device.PQA0]
classType=IDE_CONTROLLER
description=ALi 1553C Integrated IDE Controller
location=cab0/drw0/io0/hose0/bus15/slot0
hose=0
pci_bus=15
pci_slot=0
pci_function=0
mmio.cmd=auto
mmio.ctrl=auto
mmio.busmaster=auto
irqStr=auto
irqIpl=20
irqTrigger=LEVEL
irqPolicy=ROUND_ROBIN
irqAffinityCpu=0

; ===============================================================================
; SCSI DISK - DKA0 (FLATTENED STRUCTURE)
; ===============================================================================

[Device.DKA0]
schema=MDisk-1
notes=Default virtual disk profile
parent=PKA0
scsi_id=0
unit=0
image=G:/SomeDir/PaDS20/dka0.vdisk
classType=SCSI_DISK
; Container properties (flattened with dot notation)
container.deviceType=VMDK
container.path=rdsk0.img
container.readonly=false
; Geometry properties
geometry.logical_sector=512
geometry.physical_sector=512
geometry.cylinders=0
geometry.heads=0
geometry.sectors_per_track=0
geometry.size_bytes=0
; Identity properties
identity.vendor=NVY
identity.product=VirtualDisk
identity.revision=0001
identity.serial=NVY00000001
; Cache properties
cache.writeback=true
cache.flush_on_sync=true
; Binding properties
binding.media_sha256=
binding.created_utc=2025-10-25T19:16:08Z
binding.last_open_utc=
; Policy properties
policy.force_write_protect=false
policy.trim_unmap_supported=false
; IRQ properties
Irq.irqStr=auto
Irq.irqIpl=20
Irq.irqTrigger=LEVEL
Irq.irqPolicy=ROUND_ROBIN
Irq.irqAffinityCpu=0

; ===============================================================================
; SCSI DISK - DKA1 (FLATTENED STRUCTURE)
; ===============================================================================

[Device.DKA1]
schema=MDisk-1
notes=Default virtual disk profile
parent=PKA0
scsi_id=1
unit=0
image=G:/SomeDir/PaDS20/DKA1.vdisk
classType=SCSI_DISK
; Container properties
container.deviceType=VMDK
container.path=rdsk1.img
container.readonly=false
; Geometry properties
geometry.logical_sector=512
geometry.physical_sector=512
geometry.cylinders=0
geometry.heads=0
geometry.sectors_per_track=0
geometry.size_bytes=0
; Identity properties
identity.vendor=NVY
identity.product=VirtualDisk
identity.revision=0001
identity.serial=NVY00000002
; Cache properties
cache.writeback=true
cache.flush_on_sync=true
; Binding properties
binding.media_sha256=
binding.created_utc=2025-10-25T19:16:08Z
binding.last_open_utc=
; Policy properties
policy.force_write_protect=false
policy.trim_unmap_supported=false
; IRQ properties
Irq.irqStr=auto
Irq.irqIpl=20
Irq.irqTrigger=LEVEL
Irq.irqPolicy=ROUND_ROBIN
Irq.irqAffinityCpu=0

; ===============================================================================
; SCSI DISK - DKB1 (FLATTENED STRUCTURE)
; ===============================================================================

[Device.DKB1]
schema=MDisk-1
notes=Default virtual disk profile
parent=PKB0
scsi_id=1
unit=0
image=G:/SomeDir/PaDS20/DKB1.vdisk
classType=SCSI_DISK
; Container properties
container.deviceType=VMDK
container.path=rdsk2.img
container.readonly=false
; Geometry properties
geometry.logical_sector=512
geometry.physical_sector=512
geometry.cylinders=0
geometry.heads=0
geometry.sectors_per_track=0
geometry.size_bytes=0
; Identity properties
identity.vendor=NVY
identity.product=VirtualDisk
identity.revision=0001
identity.serial=NVY00000003
; Cache properties
cache.writeback=true
cache.flush_on_sync=true
; Binding properties
binding.media_sha256=
binding.created_utc=2025-10-25T19:16:08Z
binding.last_open_utc=
; Policy properties
policy.force_write_protect=false
policy.trim_unmap_supported=false
; IRQ properties
Irq.irqStr=auto
Irq.irqIpl=20
Irq.irqTrigger=LEVEL
Irq.irqPolicy=ROUND_ROBIN
Irq.irqAffinityCpu=0

; ===============================================================================
; IDE DISK - DQA0 (FLATTENED STRUCTURE)
; ===============================================================================

[Device.DQA0]
classType=IDE_DISK
parent=PQA0
unit=0
image=G:/SomeDir/PaDS20/dqa0.vdisk
serial=RD52-P3
irqStr=auto
irqIpl=20
irqTrigger=LEVEL
irqPolicy=ROUND_ROBIN
irqAffinityCpu=0

; ===============================================================================
; SCSI TAPE - MKA600 (FLATTENED STRUCTURE)
; ===============================================================================

[Device.MKA600]
classType=SCSI_TAPE
parent=PKA0
scsi_id=6
unit=0
image=G:/SomeDir/PaDS20/tape0.vtap
serial=EXABYTE
; VTape properties
format=VTAPE_BE8
readonly=true
uncompressed=true
density=default
notes=Legacy VTape; payload must be delivered verbatim.