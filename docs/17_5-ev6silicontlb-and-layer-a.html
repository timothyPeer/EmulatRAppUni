<!DOCTYPE html>
<html>
<head>
   <title>Introduction &gt; Architecture Overview &gt; Chapter 17 – Address Translation, TLB, and PTE &gt; 17.5 Ev6SiliconTLB and Layer Architecture</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta name="description" content="17.5.1 Three-Layer Design &nbsp;The translation subsystem enforces strict layering to maintain separation of concerns: &nbsp;Layer 0 — Silicon (SPAMShardManager): Provides raw TLB storag" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link type="text/css" href="custom.css" rel="stylesheet" />

   <style TYPE="text/css" media="screen"> 
      html, body { margin:0; 
        padding:0; 
        background: #ffffff; 
      } 
      div#printheader { display: none; }
      #idheader { 
        width:100%; 
        min-height: 60px; 
        padding: 0; 
        margin: 0;
        position: fixed;
        top: 0;
        background: #F0F0F0;
        z-index: 2;
      } 
      /* The "min-height" for "#idheader table" ensures that the (blue) header of the topic
         has at least the same height as the header of the navigation panel left of it */
      #idheader table { min-height: 59px;}             
      #idheader h1 span { color: #000000 }     
      #idnav {
        text-align: right;
        width: 126px;
        vertical-align: middle;        
      } 
      #idnav a { text-decoration: none }
      #idnav span {
        display: inline-block;
        width: 24px;
        height: 24px;
        margin-left: 4px;
        background:url('hm_webhelp_buttons_white.png') top left no-repeat;
      } 
      #idnav a span {
        background-image:url('hm_webhelp_buttons_grey.png');
      } 
      #idnav a span:hover {
        background-image:url('hm_webhelp_buttons_yellow.png');
      } 
      #idnav span.hmbtnprev { background-position: 0 -32px }
      #idnav span.hmbtnnext { background-position: -24px -32px }
      #idnav span.hmbtntop  { background-position: -48px -32px }
      #idnav span.hmbtntoggle  { width: 20px; background-position: -70px -32px }
      #idnav span.hmbtnprint  { background-position: -88px -32px }

      #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
      #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
      #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
      #callout-table a {text-decoration: none; color: blue;}
      #callout-table a:visited {text-decoration: none; color: blue;}
      #overview-table a {text-decoration: none; color: black;}
      #overview-table a:visited {text-decoration: none; color: black;}
      #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}       
      p.help-url { margin: 20px 0 5px 0; text-align: center; }
	  p.help-url a:link { font-size: 50%; text-decoration: none; color: black; }
	  p.help-url a:visited { color: black; }
	  p.help-url a:hover { font-size: 95%; text-decoration: underline; }
      #switchtoggles { text-align: right; padding: 0 2px 0 0; font-size: 90%; } 
      .sync-toc { color: #000000; font-size: 8pt; font-weight: bold; display: none; }
      .sync-toc a { color: #000000; text-decoration: none; font-weight: bold;}
      .sync-toc a:visited { color: #000000; }
      .sync-toc a:hover { text-decoration: underline; }
	  a#printbuttonlink { cursor: pointer; }
      a.hmanchor { display: inline-block; margin-top: -4em; padding-top: 4em; }  
   </style>
   <style TYPE="text/css" media="print">
      div#idheader, img.dropdown-toggle-icon, p.help-url { display:none } 
   </style>
   
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "17_5-ev6silicontlb-and-layer-a.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<div id="printheader"><h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">17.5 Ev6SiliconTLB and Layer Architecture</span></h1>
</div>
<div id="idheader">
<div id="idheaderbg">
<table style="width:100%;border:none;margin:0px;" cellspacing="0" cellpadding="0"> 
  <tr>
    <td class="topichead" style="text-align:left; vertical-align:middle">
      <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="index.html?17_5-ev6silicontlb-and-layer-a.html" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
      <p class="crumbs"><b>Navigation:</b>&nbsp;
      
      <a href="introduction.html">Introduction</a> &gt; <a href="architecture-overview.html">Architecture Overview</a> &gt; <a href="chapter-17---tlb_-pte_-and-add.html">Chapter 17 – Address Translation, TLB, and PTE</a>&nbsp;&gt;</p>
   
      <h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">17.5 Ev6SiliconTLB and Layer Architecture</span></h1>

    </td>
    <td class="topichead" id="idnav">
      
      <a href="17_4-spam-tlb-cache-architectu.html" title="Previous Topic"><span class="hmbtnprev"></span></a>
      <a href="chapter-17---tlb_-pte_-and-add.html" title="Parent Chapter"><span class="hmbtntop"></span></a>
      <a href="17_6-replacement-policies.html" title="Next Topic"><span class="hmbtnnext"></span></a>
      
    </td>
  </tr>  
</table>
</div>
</div>  

<div id="idcontent"><div id="innerdiv">
<!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser --> 
<!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->

<!--ZOOMRESTART-->
<h2 class="p_Heading2" style="page-break-after: avoid;"><span class="f_Heading2">17.5.1 Three-Layer Design</span></h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The translation subsystem enforces strict layering to maintain separation of concerns:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Layer 0 — Silicon (</span><span class="f_CodeExample">SPAMShardManager</span>): Provides raw TLB storage and lookup. Knows nothing about page tables, miss handling, or page table walks. Operates purely on tags, ASNs, and PTE entries. This layer is accessed only through Layer 1.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Layer 1 — TLB Interface (</span><span class="f_CodeExample">Ev6SiliconTLB</span>, <span class="f_CodeExample">Ev6TLBInterface</span>): Wraps Layer 0 with a clean lookup/insert/invalidate API. No traits, no page-table knowledge. This is the layer that MBox, PAL, and IBox call for translation operations. The <span class="f_CodeExample">Ev6SiliconTLB</span> is instantiated as a singleton via <span class="f_CodeExample">Ev6SiliconTLB_Singleton::initialize(cpuCount, cfg)</span> during emulator boot.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Layer 2 — PAL / MMU / Miss Handling:</span> On TLB miss, this layer performs the three-level page table walk via <span class="f_CodeExample">walkPageTable_EV6()</span>, reading PTEs from GuestMemory at each level. On success, it calls Layer 1 insert to refill the TLB. On failure, it raises the appropriate translation fault (TNV, FOE, FOW, FOR) through the FaultDispatcher.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample">Layer&nbsp;2:&nbsp;PAL&nbsp;/&nbsp;MMU&nbsp;/&nbsp;Miss&nbsp;Handler</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;│&nbsp;walkPageTable_EV6()&nbsp;raise&nbsp;TNV/FOE/FOW/FOR</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;│&nbsp;GuestMemory&nbsp;PTE&nbsp;reads&nbsp;FaultDispatcher</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;▼</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Layer&nbsp;1:&nbsp;Ev6TLBInterface&nbsp;/&nbsp;Ev6SiliconTLB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;│&nbsp;lookup()&nbsp;insert()&nbsp;invalidate()</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;▼</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Layer&nbsp;0:&nbsp;SPAMShardManager&nbsp;/&nbsp;SPAMBucket</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;│&nbsp;Per-CPU&nbsp;shards,&nbsp;hash&nbsp;buckets,&nbsp;replacement&nbsp;policies</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;▼</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;PTE&nbsp;entry&nbsp;storage&nbsp;(AlphaPTE&nbsp;via&nbsp;PTETraits)</span></p>
<p class="p_Normal">&nbsp;</p>
<hr style="height:1px; color:#000000; border-width:0; background-color:#000000;" /><p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2" style="page-break-after: avoid;"><span class="f_Heading2">17.5.2 Ev6SiliconTLB Singleton</span></h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span class="f_CodeExample">Ev6SiliconTLB_Singleton</span> (<span class="f_CodeExample">pteLib/Ev6SiliconTLB_Singleton.h</span>) provides process-wide access to the TLB subsystem. Initialization occurs once at emulator boot:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample">Ev6VMConfig&nbsp;cfg{};</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">cfg.basePageSize&nbsp;=&nbsp;systemConfig.vm.pageSize;&nbsp;//&nbsp;8K,&nbsp;16K,&nbsp;32K,&nbsp;64K</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">cfg.enableSuperpage64K&nbsp;=&nbsp;systemConfig.vm.enable64K;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Ev6SiliconTLB_Singleton::initialize(cpuCount,&nbsp;cfg);</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">After initialization, the SPAM shard manager is accessed via <span class="f_CodeExample">Ev6SiliconTLB_Singleton::instance().spam()</span>. The <span class="f_CodeExample">Ev6SiliconConfig</span> class centralizes page size configuration (<span class="f_CodeExample">basePageSize</span>, superpage options) and is fed from the system configuration loader.</p>
<p class="p_Normal">&nbsp;</p>
<hr style="height:1px; color:#000000; border-width:0; background-color:#000000;" /><p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2" style="page-break-after: avoid;"><span class="f_Heading2">17.5.3 EV6 Dual DTB Architecture</span></h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The EV6 implementation uses two Data Translation Buffer banks (DTB0 and DTB1), reflecting the real EV6 hardware's dual-pipe TLB design. The <span class="f_CodeExample">DualDTBManagerInterface</span> (<span class="f_CodeExample">pteLib/DualDTBManagerInterface.h</span>) defines DTB0/DTB1-specific operations: separate lookup, insertion, invalidation, and occupancy queries for each bank. The <span class="f_CodeExample">ev6_DtbPteTempRegister</span> helpers manipulate the EV6 DTB PTE Temporary Register used during DTB miss handling.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">This dual-bank design allows the EV6 to walk PTEs in parallel with execution — one pipe can service a DTB miss while the other continues executing non-memory instructions.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_SeeAlso" style="page-break-after: avoid;"><span class="f_SeeAlso">See Also: pteLib/Ev6SiliconTLB_Singleton.h – TLB singleton; pteLib/DualDTBManagerInterface.h – Dual DTB interface; <a href="14_4-mbox---memory-box.html" class="topiclink">14.4 MBox – Memory Box</a> (translation initiation).</span></p>

<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">



function normHeaders() {
 var topicHeadHeight =  $("#idheaderbg > table").first().height() + 1,
	 $topicHeaderBox = $("#idheader"),
	 $topicContentBox = $("#idcontent"),
	 $navHeader = $("#navbar", parent.document),			 
	$navBox = $("div#hmnavframe", parent.document),
	 navHeaderHeight = $navHeader.height();
 if (topicHeadHeight != navHeaderHeight) {
	 $navHeader.css("height",topicHeadHeight + "px");
	 $navBox.css("top", topicHeadHeight + "px");
	 $topicHeaderBox.css("height", topicHeadHeight + "px");
		if ($topicHeaderBox.css("position") == "fixed"){
			$topicContentBox.css("margin-top", topicHeadHeight + "px");
			}
		}
    }
			 
  $(document).ready(function(){
    $(window).on('resize', function() {
      var y = $('#idheader').height(); 
      $('#idcontent').css('margin-top', y);
      var par = window.parent;
      if ($( par ).width() <= $( window ).width()+20) {
        $('#idheader').css('position', 'relative');
        $('#idcontent').css('margin-top', 0);
        $('#idbacktotop').css('display', 'block');
        $('.hmanchor').css('margin-top', -20);
	$('.hmanchor').css('padding-top', 20);
      }
      else {
        $('#idheader').css('position', 'fixed');
        $('#idcontent').css('margin-top', $('#idheader').height());
        $('#idbacktotop').css('display', 'none');
        $('.hmanchor').css('margin-top', -y-20);
		$('.hmanchor').css('padding-top', y+20);
		$("div#hmsplitter", parent.document).css('width', '3px');
      }
	normHeaders();
    });
    
	 $(window).resize(); //trigger event for initially small displays
  });
 

if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) { $('.sync-toc').show();$('p.crumbs').hide();}

</script>
</body>
</html>
