hmLoadTopic({
hmKeywords:"",
hmTitle:"20.10 Architectural Invariants (Normative)",
hmDescription:"The following invariants govern the PAL emulation subsystem. Violation of any invariant constitutes an emulator bug.",
hmPrevLink:"20_9-boot-sequence.html",
hmNextLink:"20_11-repository-directory-map.html",
hmParentLink:"chapter-20---boot-sequence_-pa.html",
hmBreadCrumbs:"<a href=\"license-_-attributions.html\">ASA-EMulatR Reference Guide<\/a> &gt; <a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-20---boot-sequence_-pa.html\">Chapter 20 – Boot Sequence, PAL, and SRM Integration<\/a>",
hmTitlePath:"ASA-EMulatR Reference Guide > Introduction > Architecture Overview > Chapter 20 – Boot Sequence, PAL, and SRM Integration > 20.10 Architectural Invariants (Normative)",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">20.10 Architectural Invariants (Normative)<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">The following invariants govern the PAL emulation subsystem. Violation of any invariant constitutes an emulator bug.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Binary Privilege:<\/strong> Execution state is either inside PAL mode or outside PAL mode. There is no intermediate state, no partial privilege, and no legal mechanism to blur this boundary. PC bit 0 = 1 indicates PAL mode.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Single Entry, Single Exit:<\/strong> CALL_PAL is the only legal entry into PAL mode. HW_REI is the only legal exit. Exception and interrupt vectors also enter PAL mode through <span class=\"f_CodeExample\">enterPal()<\/span>, but the entry mechanism is architecturally defined — no ad-hoc entry exists.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Full Serialization:<\/strong> PAL entry implies a full barrier stronger than MB + EXCB combined. Write buffers are drained, reservations are cleared, the pipeline is flushed, and interrupts are masked. No speculative instruction may execute across a PAL boundary.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Complete Context Save\/Restore:<\/strong> <span class=\"f_CodeExample\">saveContext()<\/span> captures the full architectural state. <span class=\"f_CodeExample\">restoreContext()<\/span> restores the full architectural state. No partial restoration is permitted. No residual PAL state leaks into non-PAL execution.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Privileged Instruction Enforcement:<\/strong> HW_MFPR, HW_MTPR, HW_LD, HW_ST, and HW_REI fault with OPCDEC outside PAL mode. Enforcement is at instruction decode time.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Reservation Clearing:<\/strong> LL\/SC reservations are cleared unconditionally on CALL_PAL entry, HW_REI exit, exception delivery, interrupt delivery, and context switch. Reservations never survive privilege boundaries.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">PAL Exclusivity:<\/strong> All exception and interrupt handlers are PAL code. No exception handler exists outside PAL. All delivery paths converge on <span class=\"f_CodeExample\">enterPal()<\/span>.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">C++ Implementation:<\/strong> PAL is implemented as C++ code via PalBoxBase → PalService delegation. There is no PAL code stored in GuestMemory. This is a deliberate design choice that eliminates memory synchronization issues while faithfully implementing the architectural interface.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: <a href=\"chapter-11---architectural-inv.html\" class=\"topiclink\">Chapter 11 - Architectural Invariants<\/a> (complete invariant reference); <a href=\"chapter-8_10-enforcing-the-pri.html\" class=\"topiclink\">8.10 Enforcing the Privileged Boundary<\/a>.<\/span><\/p>\n\r"
})
