hmLoadTopic({
hmKeywords:"",
hmTitle:"IPR Cache Optimization - Quick Reference",
hmDescription:"Architecture Overview  ┌─────────────────────────────────────────────────────────────┐ │  PerCpuIPRState (per CPU, cache-line isolated)              │ ├────────────────────────",
hmPrevLink:"",
hmNextLink:"",
hmParentLink:"appendix---trait-examples.html",
hmBreadCrumbs:"",
hmTitlePath:"ASA-EMulatR Reference Guide > Introduction > Appendix > Appendix I – Glossary and Acronyms",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">IPR Cache Optimization - Quick Reference<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Architecture Overview<\/span><\/h2>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">┌─────────────────────────────────────────────────────────────┐<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;PerCpuIPRState&nbsp;(per&nbsp;CPU,&nbsp;cache-line&nbsp;isolated)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">├─────────────────────────────────────────────────────────────┤<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;┌───────────────────────────────────────────┐&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│&nbsp;IPRStorage_Hot64&nbsp;(64&nbsp;bytes,&nbsp;L1&nbsp;cache)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;←&nbsp;Every&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│&nbsp;-&nbsp;ps,&nbsp;ipl,&nbsp;fpcr,&nbsp;pal_mode,&nbsp;asn,&nbsp;cc,&nbsp;cm&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;instr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;└───────────────────────────────────────────┘&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;┌───────────────────────────────────────────┐&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│&nbsp;IPRStorage_HotExt&nbsp;(~512&nbsp;bytes,&nbsp;L2&nbsp;cache)&nbsp;&nbsp;│&nbsp;&nbsp;←&nbsp;Exception&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│&nbsp;-&nbsp;va,&nbsp;exc_addr,&nbsp;ptbr,&nbsp;stacks,&nbsp;PAL&nbsp;temps&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;\/PAL&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;└───────────────────────────────────────────┘&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;┌───────────────────────────────────────────┐&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│&nbsp;IPRStorage_CBox&nbsp;(64&nbsp;bytes,&nbsp;isolated)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;←&nbsp;IRQ&nbsp;poll&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│&nbsp;-&nbsp;irq_pending,&nbsp;ipir,&nbsp;ast&nbsp;(atomics)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;mailbox&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;└───────────────────────────────────────────┘&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;┌───────────────────────────────────────────┐&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│&nbsp;IPRStorage_Cold&nbsp;(variable,&nbsp;L3\/RAM)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;←&nbsp;Rare&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│&nbsp;-&nbsp;mces,&nbsp;diagnostics,&nbsp;perf&nbsp;counters&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;└───────────────────────────────────────────┘&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">└─────────────────────────────────────────────────────────────┘<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Quick API Reference<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">### OLD API (Backward Compatible)<\/p>\n\r<p class=\"p_Normal\">```cpp<\/p>\n\r<p class=\"p_Normal\">auto&amp; ipr = globalIPRHot(cpuId);<\/p>\n\r<p class=\"p_Normal\">ipr.fpcr() = value;<\/p>\n\r<p class=\"p_Normal\">ipr.va() = address;<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">### NEW API (Cache Optimized)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Hot path (every instruction):**<\/p>\n\r<p class=\"p_Normal\">```cpp<\/p>\n\r<p class=\"p_Normal\">auto&amp; hot = globalIPRHot64(cpuId);<\/p>\n\r<p class=\"p_Normal\">hot.fpcr = value;<\/p>\n\r<p class=\"p_Normal\">hot.setIPL(newIPL);<\/p>\n\r<p class=\"p_Normal\">if (hot.isInPalMode()) { ... }<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Exception\/PAL path:**<\/p>\n\r<p class=\"p_Normal\">```cpp<\/p>\n\r<p class=\"p_Normal\">auto&amp; ext = globalIPRHotExt(cpuId);<\/p>\n\r<p class=\"p_Normal\">ext.va = faultAddress;<\/p>\n\r<p class=\"p_Normal\">ext.exc_addr = exceptionPC;<\/p>\n\r<p class=\"p_Normal\">ext.setUSP(stackPtr);<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Interrupt poll:**<\/p>\n\r<p class=\"p_Normal\">```cpp<\/p>\n\r<p class=\"p_Normal\">auto&amp; cbox = globalIPRCBox(cpuId);<\/p>\n\r<p class=\"p_Normal\">if (cbox.hasIRQPending()) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;handleIRQ(cbox.getPendingIPL());<\/p>\n\r<p class=\"p_Normal\">}<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Cold\/diagnostic:**<\/p>\n\r<p class=\"p_Normal\">```cpp<\/p>\n\r<p class=\"p_Normal\">auto&amp; cold = globalIPRCold(cpuId);<\/p>\n\r<p class=\"p_Normal\">cold.mces = status;<\/p>\n\r<p class=\"p_Normal\">cold.pmctr++;<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">&nbsp;<\/span><\/h2>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Field Location Map<\/span><\/h2>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<div style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0; border-collapse:collapse;\">\n\r<thead>\n\r<tr>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Field<\/strong><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Old Location<\/strong><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><strong style=\"font-weight: bold;\">New Location<\/strong><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Access Pattern<\/strong><\/p>\n\r<\/th>\n\r<\/tr>\n\r<\/thead>\n\r<tbody>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">ps<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot64<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Every instruction<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">ipl<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot64<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Every instruction<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">fpcr<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot64<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Every FP op<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">asn<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot64<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Every TLB lookup<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">cc<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot64<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Every instruction<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">cm<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot64<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Every mem access<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">va<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">HotExt<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Exception only<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">exc_addr<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">HotExt<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Exception only<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">ptbr<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">HotExt<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">TLB miss<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">stacks (usp\/ksp\/etc)<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">HotExt<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Mode switch<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">pal_temp[]<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">HotExt<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">PAL flows<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">irq_pending<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">CBox<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">IRQ poll<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">ipir<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Hot<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">CBox<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">IPI poll<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">mces<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Cold<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Cold<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Rare<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">pmctr<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Cold<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Cold<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Diagnostics<\/p>\n\r<\/td>\n\r<\/tr>\n\r<\/tbody>\n\r<\/table>\n\r<\/div>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Code Templates<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">Template 1: Instruction Loop<\/span><\/h3>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">void executeInstructions(CPUIdType cpuId) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;\/\/ Bind Hot64 once - stays in L1 cache<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;auto&amp; hot = globalIPRHot64(cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;for (int i = 0; i &lt; count; ++i) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;\/\/ All fields in same cache line<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;if (hot.getIPL() &gt; threshold) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;checkInterrupts(cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;}<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;if (hot.fpcr &amp; FP_TRAP_ENABLE) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;checkFPExceptions();<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;}<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;hot.cc++; &nbsp;\/\/ Cycle counter<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;executeNextInstruction(cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;}<\/p>\n\r<p class=\"p_Normal\">}<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">Template 2: Exception Handler<\/span><\/h3>\n\r<p class=\"p_Normal\"><span class=\"f_Heading3\">&nbsp;<\/span><\/p>\n\r<p class=\"p_Normal\">void handleMemoryFault(CPUIdType cpuId, quint64 faultVA) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;\/\/ HotExt fits in L2 cache<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;auto&amp; ext = globalIPRHotExt(cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;ext.va = faultVA;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;ext.exc_addr = getCurrentPC(cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;ext.mm_stat = buildMMStatus();<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;enterPALVector(cpuId, PalVectorId::DFAULT);<\/p>\n\r<p class=\"p_Normal\">}<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">Template 3: Interrupt Poll<\/span><\/h3>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">bool checkForInterrupts(CPUIdType cpuId) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;auto&amp; hot = globalIPRHot64(cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;auto&amp; cbox = globalIPRCBox(cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;\/\/ CBox is separate cache line - no bouncing<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;if (cbox.hasIRQPending()) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;quint8 irqIPL = cbox.getPendingIPL();<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;quint8 currentIPL = hot.getIPL();<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;if (irqIPL &gt; currentIPL) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;deliverInterrupt(cpuId, irqIPL);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return true;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;}<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;}<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;return false;<\/p>\n\r<p class=\"p_Normal\">}<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">&nbsp;<\/span><\/h3>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">Template 4: IRQ Controller (Cross-Thread)<\/span><\/h3>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ IRQController thread posts interrupt<\/p>\n\r<p class=\"p_Normal\">void IRQController::postInterrupt(CPUIdType cpuId, quint8 ipl, quint8 vector) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;\/\/ Write to isolated CBox mailbox (no CPU cache line contamination)<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;auto&amp; cbox = globalIPRCBox(cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;cbox.postIRQ(ipl, vector);<\/p>\n\r<p class=\"p_Normal\">}<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ CPU thread drains mailbox<\/p>\n\r<p class=\"p_Normal\">void CPUThread::pollInterrupts() {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;auto&amp; hot = globalIPRHot64(m_cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;auto&amp; cbox = globalIPRCBox(m_cpuId);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;if (cbox.hasIRQPending() &amp;&amp; cbox.getPendingIPL() &gt; hot.getIPL()) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;quint8 vector = cbox.getPendingVector();<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;handleInterrupt(vector);<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp;cbox.clearIRQ(cbox.getPendingIPL());<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;}<\/p>\n\r<p class=\"p_Normal\">}<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Compile-Time Checks<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Add to your code:<\/strong><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ Verify cache line constraints<\/p>\n\r<p class=\"p_Normal\">static_assert(sizeof(IPRStorage_Hot64) == 64,<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;Hot64 must be exactly 64 bytes&quot;);<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">static_assert(alignof(IPRStorage_Hot64) == 64,<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;Hot64 must be 64-byte aligned&quot;);<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">static_assert(sizeof(PerCpuIPRState) % 64 == 0,<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;PerCpuIPRState must not allow false sharing&quot;);<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">static_assert(alignof(PerCpuIPRState) == 64,<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;PerCpuIPRState must be cache-aligned&quot;);<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Performance Expectations<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<div style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0; border-collapse:collapse;\">\n\r<thead>\n\r<tr>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Metric<\/strong><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Before<\/strong><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><strong style=\"font-weight: bold;\">After<\/strong><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Improvement<\/strong><\/p>\n\r<\/th>\n\r<\/tr>\n\r<\/thead>\n\r<tbody>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">L1 misses (hot loop)<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">3-5 per iter<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">1 per iter<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">60-80% ↓<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Cache line bounces<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Frequent<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Zero<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">100% ↓<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Exception latency<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">10-15 L1 misses<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">2-3 L2 hits<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">50% ↓<\/p>\n\r<\/td>\n\r<\/tr>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Overall speedup<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Baseline<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">+10-30%<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Expected<\/p>\n\r<\/td>\n\r<\/tr>\n\r<\/tbody>\n\r<\/table>\n\r<\/div>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Common Mistakes to Avoid<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">❌ **DON\'T: Call accessor functions repeatedly in loops**<\/p>\n\r<p class=\"p_Normal\">```cpp<\/p>\n\r<p class=\"p_Normal\">for (int i = 0; i &lt; N; ++i) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;if (globalIPRHot64(cpuId).getIPL() &gt; X) { } &nbsp;\/\/ ❌ Function call overhead<\/p>\n\r<p class=\"p_Normal\">}<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">✅ **DO: Bind reference once**<\/p>\n\r<p class=\"p_Normal\">auto&amp; hot = globalIPRHot64(cpuId); &nbsp;\/\/ ✅ Bind once<\/p>\n\r<p class=\"p_Normal\">for (int i = 0; i &lt; N; ++i) {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;if (hot.getIPL() &gt; X) { } &nbsp;\/\/ ✅ Direct access<\/p>\n\r<p class=\"p_Normal\">}<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">❌ **DON\'T: Put arrays in Hot64**<\/p>\n\r<p class=\"p_Normal\">struct IPRStorage_Hot64 {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;quint64 pal_temp[32]; &nbsp;\/\/ ❌ Way too big!<\/p>\n\r<p class=\"p_Normal\">};<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">✅ **DO: Put arrays in HotExt or Warm**<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">struct IPRStorage_HotExt {<\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;quint64 pal_temp[32]; &nbsp;\/\/ ✅ In L2, not L1<\/p>\n\r<p class=\"p_Normal\">};<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">❌ **DON\'T: Mix CPU-thread and IRQ-thread writes**<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ IRQController writes hot.irq_pending<\/p>\n\r<p class=\"p_Normal\">\/\/ CPU thread reads hot.ipl<\/p>\n\r<p class=\"p_Normal\">\/\/ ❌ Both in same cache line = bouncing!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">✅ **DO: Use separate CBox mailbox**<\/p>\n\r<p class=\"p_Normal\">```cpp<\/p>\n\r<p class=\"p_Normal\">\/\/ IRQController writes cbox.irq_pending<\/p>\n\r<p class=\"p_Normal\">\/\/ CPU thread reads hot.ipl<\/p>\n\r<p class=\"p_Normal\">\/\/ ✅ Separate cache lines = no bouncing!<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## Debugging Tips<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Print IPR layout:**<\/p>\n\r<p class=\"p_Normal\">```cpp<\/p>\n\r<p class=\"p_Normal\">qDebug() &lt;&lt; &quot;Hot64:&quot; &lt;&lt; sizeof(IPRStorage_Hot64);<\/p>\n\r<p class=\"p_Normal\">qDebug() &lt;&lt; &quot;HotExt:&quot; &lt;&lt; sizeof(IPRStorage_HotExt);<\/p>\n\r<p class=\"p_Normal\">qDebug() &lt;&lt; &quot;PerCpu:&quot; &lt;&lt; sizeof(PerCpuIPRState);<\/p>\n\r<p class=\"p_Normal\">qDebug() &lt;&lt; &quot;CPU0 addr:&quot; &lt;&lt; (void*)&amp;globalIPRState(0);<\/p>\n\r<p class=\"p_Normal\">qDebug() &lt;&lt; &quot;CPU1 addr:&quot; &lt;&lt; (void*)&amp;globalIPRState(1);<\/p>\n\r<p class=\"p_Normal\">qDebug() &lt;&lt; &quot;Offset:&quot; &lt;&lt; ((char*)&amp;globalIPRState(1) - (char*)&amp;globalIPRState(0));<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Expected output:**<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">Hot64: 64<\/p>\n\r<p class=\"p_Normal\">HotExt: 512<\/p>\n\r<p class=\"p_Normal\">PerCpu: 1024 (or higher, must be multiple of 64)<\/p>\n\r<p class=\"p_Normal\">CPU0 addr: 0x12345000<\/p>\n\r<p class=\"p_Normal\">CPU1 addr: 0x12345400 (offset = 1024 = 16 cache lines)<\/p>\n\r<p class=\"p_Normal\">Offset: 1024<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Verify alignment:**<\/p>\n\r<p class=\"p_Normal\">```cpp<\/p>\n\r<p class=\"p_Normal\">Q_ASSERT((quint64)&amp;globalIPRState(cpuId) % 64 == 0);<\/p>\n\r<p class=\"p_Normal\">Q_ASSERT(sizeof(PerCpuIPRState) % 64 == 0);<\/p>\n\r<p class=\"p_Normal\">```<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## Files Summary<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">| File | Purpose | When to Use |<\/p>\n\r<p class=\"p_Normal\">|------|---------|-------------|<\/p>\n\r<p class=\"p_Normal\">| `IPRStorage_Hot64.h` | L1 cache bank | Every instruction |<\/p>\n\r<p class=\"p_Normal\">| `IPRStorage_HotExt.h` | L2 cache bank | Exception\/PAL |<\/p>\n\r<p class=\"p_Normal\">| `IPRStorage_CBox.h` | Cross-thread mailbox | IRQ poll |<\/p>\n\r<p class=\"p_Normal\">| `IPRStorage_Cold.h` | Rare access | Diagnostics |<\/p>\n\r<p class=\"p_Normal\">| `PerCpuIPRState.h` | Composite | Container |<\/p>\n\r<p class=\"p_Normal\">| `IPRStorage_Core_New.h` | Backward compat | Migration |<\/p>\n\r<p class=\"p_Normal\">| `globalIPR_hot_cold_new.h` | Accessors | All code |<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## One-Page Summary<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Goal:** Optimize IPR access for host CPU cache hierarchy<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Solution:** Split monolithic Hot into cache-tiered banks:<\/p>\n\r<p class=\"p_Normal\">- Hot64 (64B, L1): Every instruction<\/p>\n\r<p class=\"p_Normal\">- HotExt (512B, L2): Exception\/PAL<\/p>\n\r<p class=\"p_Normal\">- CBox (64B, isolated): Cross-thread IRQs<\/p>\n\r<p class=\"p_Normal\">- Cold (variable, L3): Rare<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Benefits:**<\/p>\n\r<p class=\"p_Normal\">- 60-80% fewer L1 misses<\/p>\n\r<p class=\"p_Normal\">- Zero cache line bouncing<\/p>\n\r<p class=\"p_Normal\">- 10-30% overall speedup<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Migration:**<\/p>\n\r<p class=\"p_Normal\">- Backward compatible<\/p>\n\r<p class=\"p_Normal\">- Gradual migration<\/p>\n\r<p class=\"p_Normal\">- No breaking changes<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Key insight:** Don\'t chase &quot;everything in one cache line&quot; - instead, match access temperature to cache tier!<\/p>\n\r"
})
