hmLoadTopic({
hmKeywords:"",
hmTitle:"14.3 FBox – Floating-Point Execution Box",
hmDescription:"The FBox handles all IEEE 754 floating-point arithmetic. On the 21264, the Fbox comprised two floating-point pipelines (add and multiply), a divide unit, a square root unit,...",
hmPrevLink:"14_2-ebox---integer-execution-.html",
hmNextLink:"14_4-mbox---memory-box.html",
hmParentLink:"chapter-14---execution-domains.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-14---execution-domains.html\">Chapter 14 – Execution Domains (“Boxes”)<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 14 – Execution Domains (“Boxes”) > 14.3 FBox – Floating-Point Execution Box",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">14.3 FBox – Floating-Point Execution Box<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">The FBox handles all IEEE 754 floating-point arithmetic. On the 21264, the Fbox comprised two floating-point pipelines (add and multiply), a divide unit, a square root unit, and a 72-entry FP register file. In EmulatR, the FBox executes FP operations using host-native double-precision arithmetic modulated by the FPCR (Floating-Point Control Register) and <span class=\"f_CodeExample\">FPVariant<\/span> qualifiers that encode rounding mode, trapping behavior, and precision.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">14.3.1 Responsibilities<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>IEEE arithmetic: ADDS\/ADDT, SUBS\/SUBT, MULS\/MULT, DIVS\/DIVT, SQRTS\/SQRTT (with all rounding\/trapping suffix variants: \/C, \/M, \/D, \/U, \/SU, \/SUI, etc.)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Comparison: CMPTEQ, CMPTLT, CMPTLE, CMPTUN<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Conversion: CVTTS, CVTST, CVTTQ, CVTQS, CVTQT, CVTLQ, CVTQL<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>FP conditional move: FCMOVEQ, FCMOVNE, FCMOVLT, FCMOVGE, FCMOVLE, FCMOVGT<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Sign manipulation: CPYS, CPYSN, CPYSE<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>FPCR management: MT_FPCR (Move To), MF_FPCR (Move From)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Multi-cycle operation simulation with busy\/cyclesRemaining tracking<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>FP register scoreboard (<span class=\"f_CodeExample\">m_fpRegisterDirty[32]<\/span>) for hazard detection<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">14.3.2 FPVariant and FPCR Integration<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Every FBox arithmetic method accepts an <span class=\"f_CodeExample\">FPVariant<\/span> parameter that encodes the instruction\'s rounding mode (\/C chopped, \/M minus-infinity, \/D dynamic from FPCR), underflow behavior (\/U), software-complete trapping (\/S), and inexact reporting (\/I). The FBox calls <span class=\"f_CodeExample\">deriveLocalFpcr()<\/span> to merge the per-instruction variant with the architectural FPCR value, producing a local FPCR that governs that specific operation. This design allows the same underlying arithmetic path to handle all 16 suffix combinations per base instruction.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">14.3.3 Code Example – Floating-Point Add<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">AXP_HOT&nbsp;AXP_ALWAYS_INLINE&nbsp;void&nbsp;executeAdd(PipelineSlot&amp;&nbsp;slot,<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;FPVariant&amp;&nbsp;variant)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;auto*&nbsp;iprs&nbsp;=&nbsp;m_iprGlobalMaster;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;quint64&nbsp;fpcrLocal&nbsp;=&nbsp;deriveLocalFpcr(iprs-&gt;fpcr,&nbsp;variant);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;double&nbsp;srcA&nbsp;=&nbsp;slot.readFpRegAsDouble(slot.di.ra);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;double&nbsp;srcB&nbsp;=&nbsp;slot.readFpRegAsDouble(slot.di.rb);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;double&nbsp;result&nbsp;=&nbsp;addF64_variant(srcA,&nbsp;srcB,&nbsp;fpcrLocal,&nbsp;variant);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;slot.writeFpRegFromDouble(slot.di.rc,&nbsp;result);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">14.3.4 Source Files<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<div style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0; border-collapse:collapse;\">\n\r<thead>\n\r<tr>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><span style=\"font-weight: bold;\">File<\/span><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><span style=\"font-weight: bold;\">Lines (approx)<\/span><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><span style=\"font-weight: bold;\">Content<\/span><\/p>\n\r<\/th>\n\r<\/tr>\n\r<\/thead>\n\r<tbody>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">FBoxLib\/FBoxBase.h<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">~2,639<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">Complete FBox class: all FP arithmetic, conversion, cmov, FPCR, scoreboard<\/p>\n\r<\/td>\n\r<\/tr>\n\r<\/tbody>\n\r<\/table>\n\r<\/div>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: coreLib\/fp_variant_core.h – FPVariant definition and encoding; coreLib\/alpha_fp_helpers_inl.h – FP arithmetic primitives; coreLib\/alpha_fp_ieee_inl.h – IEEE 754 compliance helpers; coreLib\/alpha_fpcr_core.h – FPCR field definitions and deriveLocalFpcr().<\/span><\/p>\n\r"
})
