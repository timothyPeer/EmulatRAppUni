hmLoadTopic({
hmKeywords:"",
hmTitle:"4.8 CBox - Cache \/ Coherency \/ Coordination Box",
hmDescription:"CBox governs global ordering and visibility. It is responsible for serialization and global coordination. CBox controls when forward progress may resume, but never executes...",
hmPrevLink:"chapter-4_7---mbox---memory-bo.html",
hmNextLink:"chapter-4_9-palbox---privilege.html",
hmParentLink:"chapter-4---functionexecution-.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-4---functionexecution-.html\">Chapter 4 - Functional Execution Domains (&quot;Boxes)<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 4 - Functional Execution Domains (\"Boxes) > 4.8 CBox - Cache \/ Coherency \/ Coordination Box",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">4.8 CBox - Cache \/ Coherency \/ Coordination Box<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">CBox governs global ordering and visibility. It is responsible for serialization and global coordination. CBox controls when forward progress may resume, but never executes instruction semantics.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Responsibilities<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Memory barriers — MB (full memory ordering) and WMB (store ordering only). executeMB() and executeWMB() set stall flags and initiate write buffer draining.<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Exception barriers — EXCB (exception serialization)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Trap barriers — TRAPB (trap serialization)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Write buffer management — drainWriteBuffers() flushes pending writes to GuestMemory via the WriteBufferManager callback interface. addWriteBufferEntry() enqueues writes.<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Branch prediction — owns the BranchPredictor instance; provides getBranchPredictor(), updatePrediction(pc, taken, target), clearBranchPredictor(), and flushBranchPredictorOnPipelineFlush()<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>SMP coherency coordination — issueMemoryBarrier() forwards barrier requests to the global MemoryBarrierCoordinator for cross-CPU ordering<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>LL\/SC reservation invalidation coordination — works with ReservationManager via GuestMemory<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>MMIO access routing — holds a reference to mmio_Manager for device-mapped memory regions<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">State Machine<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">CBox operates in one of three states (CBoxState): RUNNING (normal execution), SERIALIZING (memory barrier in progress, pipeline frontend stalled), and HALTED (terminal state).<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Serialization Authority<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">CBox is the only component allowed to stall the pipeline for ordering reasons. Barrier instructions set stall flags in the EX stage, prevent frontend fetch, and release only when architectural conditions are met (write buffer drained, pending faults delivered, etc.).<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Implementation: CBoxBase.h, 1,345 lines, 29 execute\/coordination methods. Dependencies: GuestMemory, WriteBufferManager, MemoryBarrierCoordinator, mmio_Manager, BranchPredictor.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Invariant: Ordering rules live in CBox — never in EBox or MBox.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: <a href=\"chapter-6---serialization-and-.html\" class=\"topiclink\">Chapter 6 - Serialization and Stall Model<\/a>; <a href=\"chapter-3_12-stalls-and-serial.html\" class=\"topiclink\">3.12 Stalls and Serialization<\/a>; CBoxLib\/CBoxBase.h.<\/span><\/p>\n\r"
})
