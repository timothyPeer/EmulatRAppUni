hmLoadTopic({
hmKeywords:"Access,AccessViolation,ACV_FAULT,AddressCalculation,AddressSpace,Alignment,ALIGNMENT_FAULT,BSR,CTLZ,CTPOP,CTTZ,Dependency,Displacement,DTB,DTBM_DOUBLE,DTBM_SINGLE,ECB,EffectiveAddress,Ev6Translator,EX,FaultDetection,FaultDispatcher,FaultOnRead,FaultOnWrite,GuestMemory,IDeviceEmulator,Implementation,Interface,Invariant,ITB,LDL,LDL_L,LDQ,LDQ_L,LDQ_U,LLSC,Load,LoadLocked,LoadPattern,Longword,Management,MBox,MEM,Memory,Method,MMIO,mmio_Manager,Operation,Ordering,Ownership,PA,Payload,PhysicalAddress,Pipeline,Quadword,Read,Region,Reservation,ReservationManager,Retirement,Routing,Semantic,SideEffect,SignExtension,STL,STL_C,Store,StoreConditional,STQ,STQ_C,STQ_U,TLBMiss,Translation,TranslationBuffer,Unaligned,VA,WB,WH64,Write",
hmTitle:"4.7 MBox - Memory Box",
hmDescription:"MBox implements memory access semantics, not memory ownership. GuestMemory owns the physical address space; MBox provides the execution-side interface for loads, stores,...",
hmPrevLink:"chapter-4_6-fbox---floating-po.html",
hmNextLink:"chapter-4_8---cbox---cache-_-c.html",
hmParentLink:"chapter-4---functionexecution-.html",
hmBreadCrumbs:"<a href=\"license-_-attributions.html\">ASA-EMulatR Reference Guide<\/a> &gt; <a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-4---functionexecution-.html\">Chapter 4 - Functional Execution Domains (&quot;Boxes)<\/a>",
hmTitlePath:"ASA-EMulatR Reference Guide > Introduction > Architecture Overview > Chapter 4 - Functional Execution Domains (\"Boxes) > 4.7 MBox - Memory Box",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">4.7 MBox - Memory Box<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">MBox implements memory access semantics, not memory ownership. GuestMemory owns the physical address space; MBox provides the execution-side interface for loads, stores, translation, and reservation management.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Responsibilities<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Load operations — LDL, LDQ, LDQ_U, LDL_L, LDQ_L (sign-extension, unaligned, load-locked)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Store operations — STL, STQ, STQ_U, STL_C, STQ_C (store-conditional)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Address calculation — calculateEffectiveAddress(slot) computes Rb + SEXT(displacement)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Alignment checking — enforces longword (4-byte) and quadword (8-byte) alignment; raises ALIGNMENT_FAULT on violation<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Address translation — delegates to Ev6Translator for VA→PA translation via the DTB (data) and ITB (instruction) translation buffers<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>MMIO routing — physical addresses in MMIO regions are routed through the mmio_Manager to registered IDeviceEmulator instances<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>LL\/SC reservation interactions — LDL_L\/LDQ_L establish reservations; STL_C\/STQ_C test and conditionally succeed; delegation to ReservationManager<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Memory access fault detection — TLB miss (DTBM_SINGLE, DTBM_DOUBLE), access violation (ACV_FAULT), fault-on-read\/write<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Bit manipulation instructions — BSR, CTPOP, CTLZ, CTTZ (routed to MBox due to opcode encoding)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Cache hint instructions — ECB, WH64 (currently stubbed)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Critical Design Point<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Memory accesses occur in the EX stage, not in the MEM stage. The MEM pipeline stage exists for ordering and retirement, not for actual memory access. Loads complete synchronously in EX — the data is placed in slot.payLoad immediately. Stores compute the address (slot.va, slot.pa) in EX; the actual write to GuestMemory is deferred to stage_WB.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Load Execution Pattern<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">All load methods follow the same pattern:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">void&nbsp;executeLDQ(PipelineSlot&amp;&nbsp;slot)&nbsp;noexcept&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;slot.va&nbsp;=&nbsp;calculateEffectiveAddress(slot);&nbsp;\/\/&nbsp;Rb&nbsp;+&nbsp;SEXT(disp)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;\/\/&nbsp;Alignment&nbsp;check&nbsp;(8-byte&nbsp;for&nbsp;LDQ)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;if&nbsp;((slot.va&nbsp;&amp;&nbsp;0x7)&nbsp;!=&nbsp;0)&nbsp;{&nbsp;\/*&nbsp;ALIGNMENT_FAULT&nbsp;*\/&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;\/\/&nbsp;Translate&nbsp;VA&nbsp;→&nbsp;PA&nbsp;via&nbsp;Ev6Translator<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;if&nbsp;(!m_ev6Translator-&gt;translateLoadAddress(slot,&nbsp;slot.va,&nbsp;pa,&nbsp;...))&nbsp;{&nbsp;\/*&nbsp;TLB&nbsp;miss&nbsp;*\/&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;\/\/&nbsp;Read&nbsp;from&nbsp;GuestMemory<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;MEM_STATUS&nbsp;memStat&nbsp;=&nbsp;m_guestMemory-&gt;read64(pa,&nbsp;data);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;slot.payLoad&nbsp;=&nbsp;data;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;slot.needsWriteback&nbsp;=&nbsp;true;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Implementation: MBoxBase.h (2,256 lines) with supporting MBoxBase.cpp. Dependencies: GuestMemory, Ev6Translator, ReservationManager, FaultDispatcher.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Invariant: All architectural memory side effects originate in MBox.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: <a href=\"chapter-5---memory-system-arch.html\" class=\"topiclink\">Chapter 5 - Memory System Architecture<\/a>; <a href=\"3_15-ll_sc-interaction-with-th.html\" class=\"topiclink\">3.15 LL\/SC Interaction with the Pipeline<\/a>; MBoxLib_EV6\/MBoxBase.h.<\/span><\/p>\n\r"
})
