hmLoadTopic({
hmKeywords:"",
hmTitle:"Chapter 12 – AlphaCPU Core",
hmDescription:"Excellent — here is **Chapter 12**, written as the **first chapter of Group 2 (Core Processor Implementation)**. This chapter is intentionally *mechanical, ownership-focused,...",
hmPrevLink:"11_11-summary.html",
hmNextLink:"12_1-purpose-of-this-chapter.html",
hmParentLink:"architecture-overview.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 12 – AlphaCPU Core",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">Chapter 12 – AlphaCPU Core<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">Excellent — here is **Chapter 12**, written as the **first chapter of Group 2 (Core Processor Implementation)**. This chapter is intentionally *mechanical, ownership-focused, and code-oriented*, not conceptual. It answers *“who owns what and who drives execution.”*<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">You can drop this in verbatim.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"># Chapter 12 – AlphaCPU Core<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.1 Purpose of This Chapter<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">This chapter defines the **AlphaCPU core object** and its responsibilities within EmulatR.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU is the **unit of execution**. It owns:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* The processor run loop<\/p>\n\r<p class=\"p_Normal\">* Pipeline state<\/p>\n\r<p class=\"p_Normal\">* Architectural registers<\/p>\n\r<p class=\"p_Normal\">* Per-CPU execution context<\/p>\n\r<p class=\"p_Normal\">* Interaction with SMP, interrupts, and PAL<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">This chapter does **not** redefine architectural rules (those are in Group 1).<\/p>\n\r<p class=\"p_Normal\">Instead, it explains **how those rules are enforced in code**.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.2 AlphaCPU as the Unit of Execution<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Each AlphaCPU instance represents **one physical Alpha processor**.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Key properties:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* One AlphaCPU = one hardware CPU<\/p>\n\r<p class=\"p_Normal\">* Each AlphaCPU runs independently<\/p>\n\r<p class=\"p_Normal\">* All AlphaCPUs execute concurrently in SMP<\/p>\n\r<p class=\"p_Normal\">* AlphaCPU owns *all* per-CPU state<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">There is no shared CPU object and no master CPU.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.3 Ownership Model<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">### 12.3.1 AlphaCPU Owns<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU directly owns or controls:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* AlphaPipeline<\/p>\n\r<p class=\"p_Normal\">* Register banks (integer, FP)<\/p>\n\r<p class=\"p_Normal\">* Processor status (PS, IPL)<\/p>\n\r<p class=\"p_Normal\">* TLBs (ITB \/ DTB)<\/p>\n\r<p class=\"p_Normal\">* Write buffers<\/p>\n\r<p class=\"p_Normal\">* LL\/SC reservation state (via GuestMemory hooks)<\/p>\n\r<p class=\"p_Normal\">* FaultDispatcher (per-CPU view)<\/p>\n\r<p class=\"p_Normal\">* PalBox execution context<\/p>\n\r<p class=\"p_Normal\">* CPU-local interrupt state<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">No other subsystem may mutate this state directly.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">### 12.3.2 AlphaCPU Does *Not* Own<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU does **not** own:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* GuestMemory (shared)<\/p>\n\r<p class=\"p_Normal\">* SafeMemory (shared)<\/p>\n\r<p class=\"p_Normal\">* Devices or MMIO<\/p>\n\r<p class=\"p_Normal\">* DeviceManager<\/p>\n\r<p class=\"p_Normal\">* MMIOManager<\/p>\n\r<p class=\"p_Normal\">* SMPManager<\/p>\n\r<p class=\"p_Normal\">* Global interrupt controller<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">These are accessed via defined interfaces only.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.4 CPU Lifecycle<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">### 12.4.1 Creation<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPUs are created by **SMPManager**.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">During creation:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* CPUId is assigned<\/p>\n\r<p class=\"p_Normal\">* Architectural state is initialized<\/p>\n\r<p class=\"p_Normal\">* Pipeline is reset<\/p>\n\r<p class=\"p_Normal\">* TLBs are cleared<\/p>\n\r<p class=\"p_Normal\">* PAL mode is inactive<\/p>\n\r<p class=\"p_Normal\">* Interrupts are masked<\/p>\n\r<p class=\"p_Normal\">* PC is set to reset vector<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">No execution occurs during construction.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">### 12.4.2 Startup<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Execution begins when:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* SMPManager starts the CPU run loop<\/p>\n\r<p class=\"p_Normal\">* Initial PC is valid<\/p>\n\r<p class=\"p_Normal\">* Reset state is complete<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Each AlphaCPU enters its own run loop.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">### 12.4.3 Shutdown<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU exits its run loop when:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* HALT instruction retires<\/p>\n\r<p class=\"p_Normal\">* Fatal exception occurs<\/p>\n\r<p class=\"p_Normal\">* External shutdown signal is received<\/p>\n\r<p class=\"p_Normal\">* Simulation ends<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Shutdown is graceful:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* Pipeline drains or flushes<\/p>\n\r<p class=\"p_Normal\">* Device state remains intact<\/p>\n\r<p class=\"p_Normal\">* Other CPUs continue unless directed otherwise<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.5 The AlphaCPU Run Loop<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">### 12.5.1 Role of the Run Loop<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The run loop is the **clocked execution engine**.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Each iteration represents **one hardware cycle**.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Responsibilities per cycle:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">1. Pre-cycle checks (halt, interrupts, exceptions)<\/p>\n\r<p class=\"p_Normal\">2. Pipeline advancement<\/p>\n\r<p class=\"p_Normal\">3. Barrier release evaluation<\/p>\n\r<p class=\"p_Normal\">4. Exception \/ interrupt delivery<\/p>\n\r<p class=\"p_Normal\">5. Housekeeping and statistics<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">### 12.5.2 Run Loop Invariants<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The run loop must enforce:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* One cycle per iteration<\/p>\n\r<p class=\"p_Normal\">* Deterministic ordering<\/p>\n\r<p class=\"p_Normal\">* No mid-instruction interruption<\/p>\n\r<p class=\"p_Normal\">* No speculative privilege leakage<\/p>\n\r<p class=\"p_Normal\">* Precise exception semantics<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The run loop is the *only* place where execution advances.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.6 Pipeline Integration<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU owns the **AlphaPipeline** and drives it explicitly.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Responsibilities:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* Advance pipeline stages<\/p>\n\r<p class=\"p_Normal\">* Handle stalls and flushes<\/p>\n\r<p class=\"p_Normal\">* Coordinate serialization<\/p>\n\r<p class=\"p_Normal\">* Commit architectural state in WB<\/p>\n\r<p class=\"p_Normal\">* Restart fetch after control flow changes<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU does **not** execute instructions directly — it delegates execution to the pipeline and grains.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.7 Interaction with FaultDispatcher<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU is responsible for:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* Polling pending faults and interrupts<\/p>\n\r<p class=\"p_Normal\">* Determining delivery timing<\/p>\n\r<p class=\"p_Normal\">* Initiating pipeline flushes<\/p>\n\r<p class=\"p_Normal\">* Entering PAL on delivery<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Fault detection may occur anywhere, but **delivery is centralized in AlphaCPU**.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.8 Interrupt Handling Responsibility<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* Samples interrupt state during pre-cycle phase<\/p>\n\r<p class=\"p_Normal\">* Applies masking and IPL rules<\/p>\n\r<p class=\"p_Normal\">* Selects highest-priority pending interrupt<\/p>\n\r<p class=\"p_Normal\">* Initiates PAL entry when delivered<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Interrupts never interrupt instruction execution mid-cycle.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.9 PAL Integration<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU enforces PAL semantics by:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* Serializing CALL_PAL<\/p>\n\r<p class=\"p_Normal\">* Clearing LL\/SC reservations on PAL entry<\/p>\n\r<p class=\"p_Normal\">* Capturing register-context snapshots<\/p>\n\r<p class=\"p_Normal\">* Blocking speculative execution<\/p>\n\r<p class=\"p_Normal\">* Enforcing HW_REI restore semantics<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">PAL execution is coordinated, not special-cased.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.10 SMP Awareness<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Each AlphaCPU:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* Knows its CPUId<\/p>\n\r<p class=\"p_Normal\">* Participates in SMP coordination<\/p>\n\r<p class=\"p_Normal\">* Receives IPIs as interrupts<\/p>\n\r<p class=\"p_Normal\">* Performs local TLB invalidation<\/p>\n\r<p class=\"p_Normal\">* Enforces per-CPU privilege boundaries<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU never directly modifies another CPU’s state.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.11 Timing and Determinism<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU guarantees:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* Deterministic execution per CPU<\/p>\n\r<p class=\"p_Normal\">* Deterministic interaction ordering<\/p>\n\r<p class=\"p_Normal\">* Explicit visibility boundaries<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">All nondeterminism is **intentional and observable**.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.12 Error Handling Policy<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU responds to errors by:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* Raising precise exceptions<\/p>\n\r<p class=\"p_Normal\">* Entering PAL<\/p>\n\r<p class=\"p_Normal\">* Halting execution if unrecoverable<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Undefined behavior is not permitted.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## 12.13 Summary<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU is:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">* The sole execution authority<\/p>\n\r<p class=\"p_Normal\">* The owner of per-CPU architectural state<\/p>\n\r<p class=\"p_Normal\">* The driver of the pipeline<\/p>\n\r<p class=\"p_Normal\">* The arbiter of exceptions and interrupts<\/p>\n\r<p class=\"p_Normal\">* The enforcer of privilege boundaries<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Nothing executes unless AlphaCPU allows it.<\/p>\n\r"
})
