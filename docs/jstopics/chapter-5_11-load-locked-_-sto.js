hmLoadTopic({
hmKeywords:"Boundary,breakAllReservations,breakReservation,breakReservationsOnCacheLine,CacheLine,CacheLineMatch,checkReservation,Concurrency,CPU,CPUReservation,Exception,Granularity,Interaction,Interrupt,Invalidation,LLSC,LoadLocked,MBox,Mechanism,MemoryBarrier,Mutex,Operation,PALEntry,PhysicalAddress,Pipeline,PipelineFlush,Property,Reservation,ReservationManager,ReservationModel,ReservationSlot,setReservation,SMP,StoreCommit,StoreConditional,SystemReset,Tracking,Visibility,WBStage,Write",
hmTitle:"5.11 Load-Locked \/ Store-Conditional (LL\/SC)",
hmDescription:"5.11.1 Reservation Model  LL\/SC uses reservations, not mutexes. This is an optimistic concurrency mechanism: the load-locked instruction establishes a reservation, and the...",
hmPrevLink:"5_10-memory-barriers-(preview).html",
hmNextLink:"chapter-5_12-memory-faults.html",
hmParentLink:"chapter-5---memory-system-arch.html",
hmBreadCrumbs:"<a href=\"license-_-attributions.html\">ASA-EMulatR Reference Guide<\/a> &gt; <a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-5---memory-system-arch.html\">Chapter 5 - Memory System Architecture<\/a>",
hmTitlePath:"ASA-EMulatR Reference Guide > Introduction > Architecture Overview > Chapter 5 - Memory System Architecture > 5.11 Load-Locked \/ Store-Conditional (LL\/SC)",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">5.11 Load-Locked \/ Store-Conditional (LL\/SC)<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">5.11.1 Reservation Model<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">LL\/SC uses reservations, not mutexes. This is an optimistic concurrency mechanism: the load-locked instruction establishes a reservation, and the store-conditional succeeds only if no other write has invalidated that reservation.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Properties:<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Reservation tracked per CPU — each CPU has exactly one reservation slot (CPUReservation struct with reservedCacheLine and hasReservation)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Granularity is cache line — reservations are tracked at cache-line granularity (physical address masked to cache line boundary)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Other CPUs may freely read\/write — reservations are not locks<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Any write to the reserved cache line invalidates the reservation — via breakReservationsOnCacheLine()<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">5.11.2 ReservationManager<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The ReservationManager (ReservationManager.h, 153 lines) implements reservation tracking globally, not per-CPU. This ensures correct SMP invalidation and global visibility.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Key operations:<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>setReservation(cpuId, physAddr) — called by LDL_L\/LDQ_L in MBox during EX. Records the cache line for this CPU.<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>checkReservation(cpuId, physAddr) — called by STL_C\/STQ_C in MBox during EX. Returns true if the reservation is still valid for the same cache line.<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>breakReservation(cpuId) — explicitly clears one CPU\'s reservation (called on exception, interrupt, PAL entry, pipeline flush)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>breakReservationsOnCacheLine(physAddr) — scans all active CPU reservations and clears any that match the given cache line. Called by WB stage after every store commit.<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>breakAllReservations() — clears all CPU reservations (used at system reset)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Reservation clearing conditions: exception delivery, interrupt delivery, memory barriers, PAL entry, remote store to the reserved cache line, pipeline flush. No reservation survives a pipeline flush.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: <a href=\"3_15-ll_sc-interaction-with-th.html\" class=\"topiclink\">3.15 LL\/SC Interaction with the Pipeline<\/a>; cpuCoreLib\/ReservationManager.h.<\/span><\/p>\n\r"
})
