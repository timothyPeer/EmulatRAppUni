hmLoadTopic({
hmKeywords:"",
hmTitle:"10.8 Asynchronous Operations and DMA",
hmDescription:"10.8.1 Device Execution Model  After receiving a command via MMIO write, the device begins work asynchronously. CPU execution continues immediately. The device may perform DMA....",
hmPrevLink:"10_6-device-registers.html",
hmNextLink:"10_9-interrupt-signaling.html",
hmParentLink:"chapter-10---devices-and-mmio.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-10---devices-and-mmio.html\">Chapter 10 – Devices and Memory-Mapped I\/O (MMIO)<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 10 – Devices and Memory-Mapped I\/O (MMIO) > 10.8 Asynchronous Operations and DMA",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">10.8 Asynchronous Operations and DMA<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">10.8.1 Device Execution Model<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">After receiving a command via MMIO write, the device begins work asynchronously. CPU execution continues immediately. The device may perform DMA. Completion is deferred until the device signals via interrupt. The CPU never spins waiting for a device unless software explicitly polls a status register.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">10.8.2 DMA Operations<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">DMA allows devices to read from and write to GuestMemory directly, bypassing CPU caches (architecturally). DMA is subject to address translation rules, access permissions, and cache coherency management.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">DMACoherencyManager (mmio_DMACoherencyManager.h, 579 lines) manages coherency between devices and CPUs:<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>TX path (RAMToDevice) — flush CPU caches before device reads from RAM, ensuring device sees latest CPU writes<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>RX path (DeviceToRAM) — invalidate CPU caches after device writes to RAM, ensuring CPU sees device data<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>LL\/SC invalidation — invalidate reservations on DMA writes via ReservationManager::breakReservationsOnCacheLine()<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>SMP coordination — coordinate multi-CPU cache operations for DMA regions<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">DMABufferDescriptor tracks allocated DMA buffers: physical address, size, owning device UID, address mask (for 32-bit vs 64-bit devices), and coherency flag.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">DMA completion does not imply ordering unless enforced by barriers or interrupts.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: mmioLib\/mmio_DMACoherencyManager.h.<\/span><\/p>\n\r"
})
