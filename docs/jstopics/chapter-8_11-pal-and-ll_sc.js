hmLoadTopic({
hmKeywords:"",
hmTitle:"8.11 PAL and LL\/SC Reservations",
hmDescription:"LL\/SC operations must never span a privileged boundary. A reservation created in non-PAL execution cannot survive entry into PAL mode, exit from PAL mode, exception delivery,...",
hmPrevLink:"chapter-8_10-enforcing-the-pri.html",
hmNextLink:"8_12-pal-register-matrix.html",
hmParentLink:"chapter-8---pal-and-privleged-.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-8---pal-and-privleged-.html\">Chapter 8 - PAL and Privileged Boundary<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 8 - PAL and Privileged Boundary > 8.11 PAL and LL\/SC Reservations",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">8.11 PAL and LL\/SC Reservations<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">LL\/SC operations must never span a privileged boundary. A reservation created in non-PAL execution cannot survive entry into PAL mode, exit from PAL mode, exception delivery, interrupt delivery, or context switches. This is a fundamental Alpha architectural rule and is mandatory for correctness.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">8.11.1 Why Reservations Cannot Cross PAL Boundaries<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">LL\/SC relies on optimistic reservations tied to CPU execution context, memory ordering assumptions, and cache coherency state. PAL transitions break all three: execution context changes, ordering is enforced (full serialization), pipeline state is flushed, and privilege level changes. Allowing reservations to survive PAL entry would permit privileged code to commit untrusted atomic sequences, user code to observe privileged memory ordering, and stale reservations to succeed incorrectly.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">8.11.2 Clearing Rules<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">In ASA-EmulatR, LL\/SC reservations are cleared unconditionally on: CALL_PAL entry, HW_REI exit, exception delivery, interrupt delivery, context switch, and certain serialization barriers (EXCB, MB where required). This applies to all CPUs independently. Reservation tracking lives in GuestMemory (via ReservationManager), not in execution boxes, ensuring global visibility and centralized invalidation.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">8.11.3 Example Scenario<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">;&nbsp;User&nbsp;Mode:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">LDL_L&nbsp;R1,&nbsp;[X]&nbsp;;&nbsp;Reservation&nbsp;created<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">CALL_PAL&nbsp;0xNN&nbsp;;&nbsp;Enter&nbsp;PAL&nbsp;→&nbsp;reservation&nbsp;cleared<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">;&nbsp;PAL&nbsp;Mode:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">...&nbsp;;&nbsp;Privileged&nbsp;work<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">HW_REI&nbsp;;&nbsp;Return&nbsp;to&nbsp;user&nbsp;→&nbsp;reservation&nbsp;cleared&nbsp;again<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">;&nbsp;User&nbsp;Mode:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">STL_C&nbsp;R1,&nbsp;[X]&nbsp;;&nbsp;MUST&nbsp;FAIL&nbsp;(reservation&nbsp;was&nbsp;cleared)<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Even if no other CPU touched the cache line, the store-conditional must fail because the reservation was cleared on PAL entry.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: <a href=\"chapter-5_11-load-locked-_-sto.html\" class=\"topiclink\">5.11 Load-Locked \/ Store-Conditional (LL\/SC)<\/a>; <a href=\"chapter-6_12-interaction-with-.html\" class=\"topiclink\">6.12 Interaction with LL\/SC<\/a><\/span><\/p>\n\r"
})
