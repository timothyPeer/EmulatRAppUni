hmLoadTopic({
hmKeywords:"",
hmTitle:"PTE",
hmDescription:"# SMP-Coherent PTE Interface - Integration Guide  ## Overview  This interface provides **per-CPU SPAM caches** with **SMP coherence** following your established `global_xxx(cpu",
hmPrevLink:"",
hmNextLink:"",
hmParentLink:"appendix---trait-examples.html",
hmBreadCrumbs:"",
hmTitlePath:"Introduction > Appendix > Appendix I – Global Singletons",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">PTE<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\"># SMP-Coherent PTE Interface - Integration Guide<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">## Overview<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">This interface provides **per-CPU SPAM caches** with **SMP coherence** following your established `global_xxx(cpuId)` naming pattern.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Architecture<\/span><\/h2>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Per-CPU&nbsp;SPAM&nbsp;(Fast&nbsp;Path):<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">┌────────────────────────────────────────┐<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;CPU&nbsp;0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CPU&nbsp;1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CPU&nbsp;2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CPU&nbsp;3│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;┌────┐&nbsp;&nbsp;&nbsp;&nbsp;┌────┐&nbsp;&nbsp;&nbsp;&nbsp;┌────┐&nbsp;&nbsp;&nbsp;&nbsp;┌────┐&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│SPAM│&nbsp;&nbsp;&nbsp;&nbsp;│SPAM│&nbsp;&nbsp;&nbsp;&nbsp;│SPAM│&nbsp;&nbsp;&nbsp;&nbsp;│SPAM│&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│DTB&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;│DTB&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;│DTB&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;│DTB&nbsp;│&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;│ITB&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;│ITB&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;│ITB&nbsp;│&nbsp;&nbsp;&nbsp;&nbsp;│ITB&nbsp;│&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;└────┘&nbsp;&nbsp;&nbsp;&nbsp;└────┘&nbsp;&nbsp;&nbsp;&nbsp;└────┘&nbsp;&nbsp;&nbsp;&nbsp;└────┘&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">└────────────────────────────────────────┘<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;↓<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Shared&nbsp;ASN&nbsp;Epochs&nbsp;(Coherence):<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">┌────────────────────────────────────────┐<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;ASN[0]&nbsp;=&nbsp;gen&nbsp;42&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;ASN[1]&nbsp;=&nbsp;gen&nbsp;17&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">│&nbsp;&nbsp;ASN[255]&nbsp;=&nbsp;gen&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">└────────────────────────────────────────┘<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">--<\/p>\n\r<p class=\"p_Normal\"><span class=\"f_Heading2\">Naming Convention (Follows Your Standard)<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;IPR&nbsp;access&nbsp;(your&nbsp;existing&nbsp;pattern)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">globalIPRHot(cpuId)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Per-CPU&nbsp;IPR&nbsp;hot&nbsp;registers<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">globalIPRCold(cpuId)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Per-CPU&nbsp;IPR&nbsp;cold&nbsp;registers<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;PTE\/SPAM&nbsp;access&nbsp;(NEW&nbsp;-&nbsp;matches&nbsp;your&nbsp;pattern)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">globalSPAM(cpuId)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Per-CPU&nbsp;SPAM&nbsp;manager<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">globalASNEpochs()&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Shared&nbsp;ASN&nbsp;epoch&nbsp;table&nbsp;(no&nbsp;CPU&nbsp;ID&nbsp;-&nbsp;shared!)<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">## Primary Use Cases<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> 1. TLB Lookup (Fast Path - Per-CPU)<\/span><\/h3>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;In&nbsp;translation&nbsp;path&nbsp;(ev6TranslateFastVA)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">quint64&nbsp;translateVA(CPUIdType&nbsp;cpuId,&nbsp;VAType&nbsp;va,&nbsp;ASNType&nbsp;asn)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Construct&nbsp;tag<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;Ev6TLBTag&nbsp;tag;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;tag.vpn&nbsp;=&nbsp;va&nbsp;&gt;&gt;&nbsp;13;&nbsp;&nbsp;\/\/&nbsp;8KB&nbsp;pages<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;tag.realm&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;DTB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;tag.sizeClass&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;\/\/&nbsp;8KB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;tag.matchAllASNs&nbsp;=&nbsp;false;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Fast&nbsp;lookup&nbsp;in&nbsp;per-CPU&nbsp;SPAM<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;SPAMEntry&lt;Ev6PTETraits&gt;*&nbsp;entry&nbsp;=&nbsp;retrievePTE(cpuId,&nbsp;tag,&nbsp;asn);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(entry&nbsp;&amp;&amp;&nbsp;entry-&gt;isValid())&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;HIT&nbsp;-&nbsp;Fast&nbsp;path<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(entry-&gt;pfn&nbsp;&lt;&lt;&nbsp;13)&nbsp;|&nbsp;(va&nbsp;&amp;&nbsp;0x1FFF);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;MISS&nbsp;-&nbsp;Walk&nbsp;page&nbsp;table<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;walkAndRefill<\/span>(cpuId,&nbsp;va,&nbsp;asn,&nbsp;tag);<\/p>\n\r<p class=\"p_Normal\">}<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> 2. TLB Refill After Page Table Walk<\/span><\/h3>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">&nbsp;<\/span><\/h3>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">&nbsp;<\/span><\/h3>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">quint64&nbsp;walkAndRefill(CPUIdType&nbsp;cpuId,&nbsp;VAType&nbsp;va,&nbsp;ASNType&nbsp;asn,&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;Ev6TLBTag&amp;&nbsp;tag)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Walk&nbsp;page&nbsp;table&nbsp;(slow&nbsp;path)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;AlphaPTE&nbsp;pte&nbsp;=&nbsp;walkPageTable_EV6(va,&nbsp;ptbr,&nbsp;mode,&nbsp;access,&nbsp;memoryReader);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!pte.valid())&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Page&nbsp;fault<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raiseTrap(TrapCode::DTB_MISS,&nbsp;va);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Insert&nbsp;into&nbsp;per-CPU&nbsp;SPAM<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;inserted&nbsp;=&nbsp;placePTE(cpuId,&nbsp;tag,&nbsp;pte,&nbsp;asn);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!inserted)&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;SPAM&nbsp;full&nbsp;-&nbsp;evict&nbsp;something&nbsp;(handled&nbsp;internally&nbsp;by&nbsp;SPAM)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Return&nbsp;physical&nbsp;address<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(pte.pfn()&nbsp;&lt;&lt;&nbsp;13)&nbsp;|&nbsp;(va&nbsp;&amp;&nbsp;0x1FFF);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> 3. MTPR_ASN - Change ASN (With TLB Flush)<\/span><\/h3>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">void&nbsp;IBox::executeMTPR_ASN(const&nbsp;DecodedInstruction&amp;&nbsp;di)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;auto&amp;&nbsp;iprs&nbsp;=&nbsp;globalIPRHot(m_cpuId);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Read&nbsp;new&nbsp;ASN<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;quint64&nbsp;newAsn&nbsp;=&nbsp;m_ctx-&gt;readIntReg(16)&nbsp;&amp;&nbsp;0xFF;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;quint64&nbsp;oldAsn&nbsp;=&nbsp;iprs.asn;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Write&nbsp;to&nbsp;IPR<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;iprs.asn&nbsp;=&nbsp;newAsn;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(newAsn&nbsp;!=&nbsp;oldAsn)&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Increment&nbsp;ASN&nbsp;generation&nbsp;(makes&nbsp;old&nbsp;entries&nbsp;stale)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;quint32&nbsp;newGen&nbsp;=&nbsp;GlobalPTESMP::incrementASNGeneration(oldAsn);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Sweep&nbsp;dead&nbsp;entries&nbsp;on&nbsp;THIS&nbsp;CPU&nbsp;only<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;globalSPAM(m_cpuId).sweepDeadForASN(oldAsn,&nbsp;newGen);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Optional:&nbsp;Full&nbsp;TLB&nbsp;flush&nbsp;for&nbsp;safety<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;globalSPAM(m_cpuId).flushAll();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Final&nbsp;step<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;quint64&nbsp;nextPC&nbsp;=&nbsp;m_ctx-&gt;getPC()&nbsp;+&nbsp;4;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;final_stage_before_exit(nextPC);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> 4. Page Table Modification (Requires TLB Shootdown)<\/span><\/h3>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">&nbsp;<\/span><\/h3>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">&nbsp;<\/span><\/h3>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">void&nbsp;modifyPageTableEntry(VAType&nbsp;va,&nbsp;const&nbsp;AlphaPTE&amp;&nbsp;newPTE,&nbsp;ASNType&nbsp;asn)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Write&nbsp;new&nbsp;PTE&nbsp;to&nbsp;memory<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;quint64&nbsp;ptePa&nbsp;=&nbsp;calculatePTEAddress(va);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;storeMemory(ptePa,&nbsp;8,&nbsp;newPTE.raw);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;CRITICAL:&nbsp;Invalidate&nbsp;on&nbsp;ALL&nbsp;CPUs!<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Other&nbsp;CPUs&nbsp;may&nbsp;have&nbsp;cached&nbsp;the&nbsp;old&nbsp;PTE<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;Ev6TLBTag&nbsp;tag;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;tag.vpn&nbsp;=&nbsp;va&nbsp;&gt;&gt;&nbsp;13;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;tag.realm&nbsp;=&nbsp;0;&nbsp;&nbsp;\/\/&nbsp;DTB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;tag.sizeClass&nbsp;=&nbsp;0;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;tag.matchAllASNs&nbsp;=&nbsp;false;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;invalidatePTE_AllCPUs(tag,&nbsp;asn);&nbsp;&nbsp;\/\/&nbsp;TLB&nbsp;shootdown&nbsp;(expensive!)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> 5. Process Termination (Flush ASN)<\/span><\/h3>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">&nbsp;<\/span><\/h3>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">void&nbsp;terminateProcess(ASNType&nbsp;asn)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Flush&nbsp;this&nbsp;ASN&nbsp;on&nbsp;ALL&nbsp;CPUs<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;This&nbsp;is&nbsp;safe&nbsp;because&nbsp;no&nbsp;CPU&nbsp;will&nbsp;be&nbsp;running&nbsp;this&nbsp;process&nbsp;anymore<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;GlobalPTESMP::flushASNAllCPUs(asn);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Now&nbsp;ASN&nbsp;can&nbsp;be&nbsp;reassigned&nbsp;to&nbsp;a&nbsp;new&nbsp;process<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> 6. Context Switch (Simple Local Flush)<\/span><\/h3>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">void&nbsp;contextSwitch(CPUIdType&nbsp;cpuId,&nbsp;ASNType&nbsp;oldAsn,&nbsp;ASNType&nbsp;newAsn)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Update&nbsp;ASN&nbsp;in&nbsp;IPR<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;globalIPRHot(cpuId).asn&nbsp;=&nbsp;newAsn;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Option&nbsp;A:&nbsp;Sweep&nbsp;dead&nbsp;entries&nbsp;for&nbsp;old&nbsp;ASN&nbsp;(fast)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;quint32&nbsp;newGen&nbsp;=&nbsp;GlobalPTESMP::getASNGeneration(oldAsn);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;globalSPAM(cpuId).sweepDeadForASN(oldAsn,&nbsp;newGen);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Option&nbsp;B:&nbsp;Full&nbsp;local&nbsp;flush&nbsp;(safer&nbsp;but&nbsp;slower)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;GlobalPTESMP::flushCPU(cpuId);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">## Initialization<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;In&nbsp;main()&nbsp;or&nbsp;system&nbsp;initialization:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">int&nbsp;main(int&nbsp;argc,&nbsp;char**&nbsp;argv)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Initialize&nbsp;global&nbsp;PTE&nbsp;subsystem<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;int&nbsp;cpuCount&nbsp;=&nbsp;4;&nbsp;&nbsp;\/\/&nbsp;Your&nbsp;CPU&nbsp;count<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;initializeGlobalPTE(cpuCount);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;...&nbsp;rest&nbsp;of&nbsp;initialization&nbsp;...<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;At&nbsp;shutdown:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;shutdownGlobalPTE();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">## SMP Coherence Guarantees<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> 1. ASN Epoch Coherence<\/span><\/h3>\n\r<p class=\"p_Normal\">- All CPUs see same ASN generation via atomic shared table<\/p>\n\r<p class=\"p_Normal\">- When ASN generation increments, all CPUs\' cached entries become stale<\/p>\n\r<p class=\"p_Normal\">- Refill on TLB miss automatically uses new generation<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> 2. TLB Shootdown<\/span><\/h3>\n\r<p class=\"p_Normal\">- `invalidatePTE_AllCPUs()` ensures all CPUs flush the entry<\/p>\n\r<p class=\"p_Normal\">- Required when modifying page tables<\/p>\n\r<p class=\"p_Normal\">- Uses atomic operations for coordination<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> 3. Per-CPU SPAM Independence<\/span><\/h3>\n\r<p class=\"p_Normal\">- Each CPU has its own SPAM cache (no contention on fast path)<\/p>\n\r<p class=\"p_Normal\">- CPUs don\'t interfere with each other on TLB lookups<\/p>\n\r<p class=\"p_Normal\">- Only coordination points are ASN epochs and explicit shootdowns<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">## Performance Characteristics<\/span><\/h2>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">&nbsp;<\/span><\/h3>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> Fast Path (TLB Hit - Per-CPU)<\/span><\/h3>\n\r<p class=\"p_Normal\">- **No contention** - each CPU uses its own SPAM<\/p>\n\r<p class=\"p_Normal\">- **Lock-free reads** - seqlock protocol in SPAMBucket<\/p>\n\r<p class=\"p_Normal\">- **~5-10 cycles** - typical TLB hit latency<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> Slow Path (TLB Miss)<\/span><\/h3>\n\r<p class=\"p_Normal\">- **Page table walk** - ~100-200 cycles<\/p>\n\r<p class=\"p_Normal\">- **SPAM insertion** - ~10-20 cycles<\/p>\n\r<p class=\"p_Normal\">- **ASN epoch check** - atomic load (~5 cycles)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\"> TLB Shootdown (Cross-CPU)<\/span><\/h3>\n\r<p class=\"p_Normal\">- **VERY EXPENSIVE** - requires touching all CPUs<\/p>\n\r<p class=\"p_Normal\">- **~1000+ cycles** - due to inter-processor communication<\/p>\n\r<p class=\"p_Normal\">- **Minimize usage** - batch invalidations when possible<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">## Debugging Aids<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;Check&nbsp;if&nbsp;entry&nbsp;is&nbsp;still&nbsp;valid&nbsp;(ASN&nbsp;epoch&nbsp;matches)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">bool&nbsp;isEntryFresh(const&nbsp;SPAMEntry&lt;Ev6PTETraits&gt;*&nbsp;entry,&nbsp;ASNType&nbsp;asn)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!entry&nbsp;||&nbsp;!entry-&gt;isValid())&nbsp;return&nbsp;false;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(entry-&gt;flags.global)&nbsp;return&nbsp;true;&nbsp;&nbsp;\/\/&nbsp;Global&nbsp;entries&nbsp;always&nbsp;valid<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;quint32&nbsp;currentGen&nbsp;=&nbsp;GlobalPTESMP::getASNGeneration(asn);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;(entry-&gt;asn&nbsp;==&nbsp;asn&nbsp;&amp;&amp;&nbsp;entry-&gt;asnGenAtFill&nbsp;==&nbsp;currentGen);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;Dump&nbsp;SPAM&nbsp;statistics&nbsp;(for&nbsp;debugging)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">void&nbsp;dumpSPAMStats(CPUIdType&nbsp;cpuId)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;auto&amp;&nbsp;spam&nbsp;=&nbsp;globalSPAM(cpuId);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Add&nbsp;stats&nbsp;methods&nbsp;to&nbsp;Ev6SPAMShardManager<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;qDebug()&nbsp;&lt;&lt;&nbsp;&quot;CPU&quot;&nbsp;&lt;&lt;&nbsp;cpuId&nbsp;&lt;&lt;&nbsp;&quot;SPAM&nbsp;stats:&quot;;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;qDebug()&nbsp;&lt;&lt;&nbsp;&quot;&nbsp;&nbsp;Hits:&quot;&nbsp;&lt;&lt;&nbsp;spam.getHitCount();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;qDebug()&nbsp;&lt;&lt;&nbsp;&quot;&nbsp;&nbsp;Misses:&quot;&nbsp;&lt;&lt;&nbsp;spam.getMissCount();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;qDebug()&nbsp;&lt;&lt;&nbsp;&quot;&nbsp;&nbsp;Evictions:&quot;&nbsp;&lt;&lt;&nbsp;spam.getEvictionCount();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">---<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">&nbsp;<\/span><\/h2>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">## Summary<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">✅ **Per-CPU SPAM** - Each CPU has independent TLB cache<\/p>\n\r<p class=\"p_Normal\">✅ **Shared ASN Epochs** - All CPUs coordinate on ASN generations<\/p>\n\r<p class=\"p_Normal\">✅ **SMP Coherence** - TLB shootdown for page table modifications<\/p>\n\r<p class=\"p_Normal\">✅ **Naming Convention** - Follows your `global_xxx(cpuId)` pattern<\/p>\n\r<p class=\"p_Normal\">✅ **Lock-Free Fast Path** - No contention on TLB lookups<\/p>\n\r<p class=\"p_Normal\">✅ **Atomic Coordination** - Safe for SMP without locks<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">**Ready to integrate!**<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p><span style=\"font-size: 0.91rem; font-family: Arial,Helvetica,sans-serif; color: #000000;\">&nbsp;<\/span><\/p>\n\r"
})
