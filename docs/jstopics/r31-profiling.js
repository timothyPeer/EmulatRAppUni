hmLoadTopic({
hmKeywords:"",
hmTitle:"R31 Profiling",
hmDescription:"\/\/ ============================================================================",
hmPrevLink:"",
hmNextLink:"",
hmParentLink:"appendix---trait-examples.html",
hmBreadCrumbs:"",
hmTitlePath:"Introduction > Appendix > Appendix I â€“ Global Singletons",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">R31 Profiling<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;============================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;ATOMIC&nbsp;MEMORY&nbsp;STAGE&nbsp;INTEGRATION&nbsp;NOTES<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;============================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;Per&nbsp;Rule&nbsp;WB-R31-4:&nbsp;Reservation&nbsp;state&nbsp;must&nbsp;NOT&nbsp;be&nbsp;updated&nbsp;in&nbsp;stage_WB.<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;The&nbsp;ATOMIC-R31-DET&nbsp;policy&nbsp;is&nbsp;applied&nbsp;in&nbsp;the&nbsp;memory\/atomic&nbsp;stage:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;For&nbsp;LDx_L&nbsp;with&nbsp;Rc=31&nbsp;(in&nbsp;memory&nbsp;stage,&nbsp;not&nbsp;WB):<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Perform&nbsp;address&nbsp;translation&nbsp;normally&nbsp;(faults&nbsp;still&nbsp;occur)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Perform&nbsp;memory&nbsp;read&nbsp;normally&nbsp;(faults&nbsp;still&nbsp;occur)&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Do&nbsp;NOT&nbsp;create&nbsp;reservation&nbsp;(don\'t&nbsp;set&nbsp;lock_flag)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Do&nbsp;NOT&nbsp;set&nbsp;locked_physical_address<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Stage&nbsp;payLoad&nbsp;normally&nbsp;(WB&nbsp;will&nbsp;discard&nbsp;due&nbsp;to&nbsp;Rc=31)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Increment&nbsp;counter:&nbsp;AtomicLDLToR31<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;For&nbsp;STx_C&nbsp;with&nbsp;Rc=31&nbsp;(in&nbsp;memory&nbsp;stage,&nbsp;not&nbsp;WB):<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Perform&nbsp;address&nbsp;translation&nbsp;normally&nbsp;(faults&nbsp;still&nbsp;occur)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Do&nbsp;NOT&nbsp;perform&nbsp;conditional&nbsp;store&nbsp;(treat&nbsp;as&nbsp;&quot;failed&nbsp;conditional&quot;)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Invalidate&nbsp;any&nbsp;existing&nbsp;reservation&nbsp;(clear&nbsp;lock_flag)&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Stage&nbsp;payLoad&nbsp;=&nbsp;0&nbsp;(failure&nbsp;result,&nbsp;WB&nbsp;will&nbsp;discard&nbsp;due&nbsp;to&nbsp;Rc=31)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;Increment&nbsp;counter:&nbsp;AtomicSTCToR31<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;Example&nbsp;memory&nbsp;stage&nbsp;detection:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;if&nbsp;((isLoadLocked(slot.di)&nbsp;||&nbsp;isStoreConditional(slot.di))&nbsp;&amp;&amp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;destRegister(slot.di)&nbsp;==&nbsp;31)&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Apply&nbsp;ATOMIC-R31-DET&nbsp;policy<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;applyR31AtomicPolicy(slot);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;============================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;OPERAND&nbsp;CONSTRAINT&nbsp;CHECKING&nbsp;(Execute&nbsp;Stage,&nbsp;not&nbsp;WB)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;============================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;Per&nbsp;Section&nbsp;4.3:&nbsp;&quot;Must&nbsp;be&nbsp;R31&quot;&nbsp;constraints&nbsp;should&nbsp;be&nbsp;checked&nbsp;in&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;decode\/execute&nbsp;stage,&nbsp;not&nbsp;writeback&nbsp;stage.<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;Recommended&nbsp;approach&nbsp;A&nbsp;(deterministic&nbsp;faulting):<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;CTLZ\/CTPOP\/CTTZ:&nbsp;Check&nbsp;Ra&nbsp;==&nbsp;31,&nbsp;fault&nbsp;if&nbsp;not<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;SEXTx:&nbsp;Check&nbsp;Ra&nbsp;==&nbsp;31,&nbsp;fault&nbsp;if&nbsp;not&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;AMASK:&nbsp;Check&nbsp;Ra&nbsp;==&nbsp;31,&nbsp;fault&nbsp;if&nbsp;not<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;IMPLVER:&nbsp;Check&nbsp;Ra&nbsp;==&nbsp;31&nbsp;&amp;&amp;&nbsp;Rb&nbsp;==&nbsp;literal&nbsp;#1,&nbsp;fault&nbsp;if&nbsp;not<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;-&nbsp;ITOFx:&nbsp;Check&nbsp;Rb&nbsp;==&nbsp;31,&nbsp;fault&nbsp;if&nbsp;not<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;Example&nbsp;execute&nbsp;stage&nbsp;check:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;if&nbsp;(isCTLZ(slot.di)&nbsp;&amp;&amp;&nbsp;slot.di.ra&nbsp;!=&nbsp;31)&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;raiseFault(slot,&nbsp;FaultType::IllegalOperand);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;============================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;REGISTER&nbsp;FILE&nbsp;INTEGRATION<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;============================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;Per&nbsp;Rules&nbsp;INIT-R31-1,&nbsp;INIT-R31-2,&nbsp;and&nbsp;WB-R31-2:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;In&nbsp;AlphaProcessorContext&nbsp;or&nbsp;RegisterBankInteger:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;AXP_ALWAYS_INLINE&nbsp;quint64&nbsp;readIntReg(quint8&nbsp;reg)&nbsp;const&nbsp;noexcept&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(reg&nbsp;==&nbsp;31)&nbsp;return&nbsp;0;&nbsp;&nbsp;\/\/&nbsp;Rule&nbsp;R31-SRC-1:&nbsp;RAZ&nbsp;semantics<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;m_intRegs[reg];<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;AXP_ALWAYS_INLINE&nbsp;void&nbsp;writeIntReg(quint8&nbsp;reg,&nbsp;quint64&nbsp;value)&nbsp;noexcept&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(reg&nbsp;==&nbsp;31)&nbsp;return;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Rule&nbsp;R31-DST-1:&nbsp;Discard&nbsp;writes<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;m_intRegs[reg]&nbsp;=&nbsp;value;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;No&nbsp;backing&nbsp;storage&nbsp;needed&nbsp;for&nbsp;R31&nbsp;-&nbsp;it\'s&nbsp;purely&nbsp;virtual.<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;No&nbsp;scoreboard&nbsp;dependencies&nbsp;for&nbsp;R31&nbsp;reads.<\/span><\/p>\n\r"
})
