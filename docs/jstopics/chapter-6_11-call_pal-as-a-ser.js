hmLoadTopic({
hmKeywords:"",
hmTitle:"6.11 CALL_PAL as a Serialization Point",
hmDescription:"6.11.1 PAL Transition Semantics  CALL_PAL transitions execution into privileged PAL mode. This transition must be serialized to prevent speculative execution across privilege...",
hmPrevLink:"chapter-6_10---trapb---trap-ba.html",
hmNextLink:"chapter-6_12-interaction-with-.html",
hmParentLink:"chapter-6---serialization-and-.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-6---serialization-and-.html\">Chapter 6 - Serialization and Stall Model<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 6 - Serialization and Stall Model > 6.11 CALL_PAL as a Serialization Point",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">6.11 CALL_PAL as a Serialization Point<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">6.11.1 PAL Transition Semantics<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">CALL_PAL transitions execution into privileged PAL mode. This transition must be serialized to prevent speculative execution across privilege boundaries, inconsistent IPR state, and unsafe MMIO access.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">6.11.2 Required Behavior<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">CALL_PAL behaves as the strongest serialization point (MemoryBarrierKind::PAL = 0xFFFF). It requires:<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>All prior instructions complete<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Pipeline is flushed or drained<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>LL\/SC reservations are cleared<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Write buffers are drained<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Interrupts are masked during the transition<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">6.11.3 SMP Coordination<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">In SMP configurations, CBox::issueMemoryBarrier() checks the active CPU count. If more than one CPU is active and the barrier kind is PAL, the MemoryBarrierCoordinator initiates a global barrier and waits for all CPUs to acknowledge before the PAL transition completes:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;CBox::issueMemoryBarrier()<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">drainWriteBuffers();&nbsp;\/\/&nbsp;Step&nbsp;1:&nbsp;local&nbsp;drain<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">if&nbsp;(activeCpuCount&nbsp;&gt;&nbsp;1&nbsp;&amp;&amp;&nbsp;kind&nbsp;==&nbsp;MemoryBarrierKind::PAL)&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;m_barrierCoordinator-&gt;initiateGlobalMemoryBarrier(m_cpuId,&nbsp;activeCpuCount);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;m_barrierCoordinator-&gt;waitForBarrierAcknowledge(m_cpuId);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">m_state&nbsp;=&nbsp;CBoxState::RUNNING;<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: <a href=\"chapter-4_9-palbox---privilege.html\" class=\"topiclink\">4.9 PalBox - Privileged Architecture Library Box<\/a>; CBoxLib\/CBoxBase.h (issueMemoryBarrier).<\/span><\/p>\n\r"
})
