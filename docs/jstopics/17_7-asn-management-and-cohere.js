hmLoadTopic({
hmKeywords:"",
hmTitle:"17.7 ASN Management and Coherence",
hmDescription:"17.7.1 Address Space Numbers  The Alpha architecture tags TLB entries with an Address Space Number (ASN) to avoid full TLB flushes on context switches. When the OS switches to a",
hmPrevLink:"17_6-replacement-policies.html",
hmNextLink:"17_8-tlb-invalidation-and-shoo.html",
hmParentLink:"chapter-17---tlb_-pte_-and-add.html",
hmBreadCrumbs:"<a href=\"license-_-attributions.html\">ASA-EMulatR Reference Guide<\/a> &gt; <a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-17---tlb_-pte_-and-add.html\">Chapter 17 – Address Translation, TLB, and PTE<\/a>",
hmTitlePath:"ASA-EMulatR Reference Guide > Introduction > Architecture Overview > Chapter 17 – Address Translation, TLB, and PTE > 17.7 ASN Management and Coherence",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">17.7 ASN Management and Coherence<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">17.7.1 Address Space Numbers<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The Alpha architecture tags TLB entries with an Address Space Number (ASN) to avoid full TLB flushes on context switches. When the OS switches to a process with a different ASN, only the TLB entries tagged with the old ASN become stale — entries tagged with the new ASN or marked as global (ASM bit set) remain valid.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">ASN width is generation-dependent. The EV6 supports up to 8-bit ASNs (256 address spaces). When ASN space is exhausted, the OS performs an ASN wraparound: it allocates a new ASN generation and invalidates all non-global entries. The <span class=\"f_CodeExample\">SPAMShardManager<\/span> supports this via <span class=\"f_CodeExample\">invalidateASN()<\/span> and the <span class=\"f_CodeExample\">maintenanceTick()<\/span> sweep.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">17.7.2 Shared ASN Epochs<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">SMP coherence for ASN invalidation uses a shared ASN epoch table, accessed via <span class=\"f_CodeExample\">globalASNEpochs()<\/span> (no CPU ID — this is shared state). Each ASN has an epoch counter. When the OS invalidates an ASN, the epoch counter is incremented. Per-CPU SPAM entries are tagged with the epoch at insertion time; on lookup, a stale epoch (entry epoch &lt; current epoch) indicates the entry is invalid without requiring an explicit per-entry flush.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">This lazy invalidation approach avoids the cost of scanning all buckets across all CPUs when an ASN is recycled. The actual eviction happens naturally when the stale entry is encountered during lookup or when a replacement policy selects it as a victim.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">17.7.3 Global (ASM) Entries<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">PTE entries with the ASM (Address Space Match) bit set are global — they match all ASNs and are not invalidated by ASN-scoped operations (TBIAP). Only TBIA (invalidate all) or TBIS (invalidate single VA) can remove global entries. Global entries are used for kernel text and data mappings that are shared across all processes.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The <span class=\"f_CodeExample\">Ev6TLBTag<\/span> includes a <span class=\"f_CodeExample\">matchAllASNs<\/span> flag that controls whether the entry participates in ASN matching during lookup.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: <a href=\"chapter-8_3-privilege-levels-i.html\" class=\"topiclink\">8.3 Privilege Levels<\/a> (kernel\/user mode context); <a href=\"chapter-9_4-per-cpu-vs-shared-.html\" class=\"topiclink\">9.4 Per-CPU vs Shared State<\/a> (ASN epochs as shared state).<\/span><\/p>\n\r"
})
