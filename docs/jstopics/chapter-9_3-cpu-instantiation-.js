hmLoadTopic({
hmKeywords:"",
hmTitle:"9.3 CPU Instantiation and Identity",
hmDescription:"9.3.1 ExecutionCoordinator  CPUs are created and managed by the ExecutionCoordinator (ExecutionCoordinator.h, 416 lines). This is the central SMP management class, responsible...",
hmPrevLink:"chapter-9_2-smp-design-philoso.html",
hmNextLink:"chapter-9_4-per-cpu-vs-shared-.html",
hmParentLink:"chapter9-smparchitecture.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter9-smparchitecture.html\">Chapter 9 - SMP Architecture<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 9 - SMP Architecture > 9.3 CPU Instantiation and Identity",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">9.3 CPU Instantiation and Identity<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">9.3.1 ExecutionCoordinator<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">CPUs are created and managed by the ExecutionCoordinator (ExecutionCoordinator.h, 416 lines). This is the central SMP management class, responsible for instantiating AlphaCPU objects, assigning CPU identifiers, starting and stopping per-CPU run loops via QThread workers, and coordinating shutdown, reset, and global barriers.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The ExecutionCoordinator owns or provides access to all SMP subsystems:<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>m_cpuCount (quint16) — runtime-configured CPU count<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>m_cboxes (array&lt;unique_ptr&lt;CBox&gt;, MAX_CPUS&gt;) — per-CPU CBox instances (sparse array)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>m_workers (array&lt;CPUWorker, MAX_CPUS&gt;) — per-CPU thread + AlphaCPU pairs<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>m_cpuStateManager (CPUStateManager) — per-CPU execution state tracking<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>m_reservationManager (ReservationManager) — global LL\/SC reservation tracking<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>global_IPIManager() — IPI message routing (singleton)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>global_MemoryBarrierCoordinator() — global barrier synchronization (singleton)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The maximum CPU count is statically bounded at MAX_CPUS (64). The active CPU count is runtime-configured and tracked via getActiveCPUCount(), which counts non-halted CPUs.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">9.3.2 CPUWorker and Threading Model<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Each CPU runs in its own QThread. The CPUWorker struct pairs a thread with its AlphaCPU instance:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">struct&nbsp;CPUWorker&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;std::unique_ptr&lt;QThread&gt;&nbsp;thread;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;std::unique_ptr&lt;AlphaCPU&gt;&nbsp;alphaCPU;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">};<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The ExecutionCoordinator manages the lifecycle: createWorkers() instantiates threads, start()\/pause()\/stop()\/reset() control system-wide execution, and per-CPU control is available via pauseCPU()\/resumeCPU()\/stopCPU(). Qt signals (systemStarted, systemPaused, systemStopped, cpuHalted, cpuError) provide event notification.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">9.3.3 CPU Identity<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Each CPU has a unique CPUIdType identifier (quint16), assigned at creation and carried through all subsystems. CPU identity is never inferred — it is explicit in every API call (CBox::m_cpuId, FaultDispatcher(cpuId), ReservationManager::setReservation(cpuId, ...), etc.). Each CPU has independent pipeline state, register files (integer + FP), TLBs (ITB\/DTB), write buffers, LL\/SC reservation slot, FaultDispatcher, and processor status (PS, IPL, CM, PAL mode flag).<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">9.3.4 CPUStateManager<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The CPUStateManager tracks each CPU\'s execution state:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">enum&nbsp;class&nbsp;CPUState&nbsp;:&nbsp;quint8&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;Running,&nbsp;\/\/&nbsp;Normal&nbsp;execution<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;Halted,&nbsp;\/\/&nbsp;CPU&nbsp;halted&nbsp;(HALT&nbsp;instruction)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;Waiting,&nbsp;\/\/&nbsp;CPU&nbsp;in&nbsp;wait&nbsp;state<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;Quiesced,&nbsp;\/\/&nbsp;CPU&nbsp;memory&nbsp;operations&nbsp;drained<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;Reset&nbsp;\/\/&nbsp;CPU&nbsp;being&nbsp;reset<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">};<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">isCPUHalted() is used by getActiveCPUCount() to determine how many CPUs participate in barrier coordination. The Quiesced state indicates a CPU whose write buffers have been drained — a prerequisite for certain global operations.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: emulatrLib\/ExecutionCoordinator.h; emulatrLib\/CPUStateManager.h.<\/span><\/p>\n\r"
})
