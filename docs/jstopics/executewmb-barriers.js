hmLoadTopic({
hmKeywords:"",
hmTitle:"executeMB_WMB",
hmDescription:"\/\/ ============================================================================",
hmPrevLink:"",
hmNextLink:"",
hmParentLink:"appendix---trait-examples.html",
hmBreadCrumbs:"",
hmTitlePath:"Introduction > Appendix > Appendix I – Global Singletons",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">executeMB_WMB<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">\/\/ WMB (Write Memory Barrier) - Complete Documentation with Alpha Assembly<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">\/\/ SerializationType::Barrier_WRITE<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">PURPOSE:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WMB is a WRITE-ONLY memory barrier that enforces ordering of STORE operations.<\/p>\n\r<p class=\"p_Normal\">Loads can bypass WMB, but stores cannot. This provides ordering guarantees for writes while allowing reads to proceed, improving performance vs full MB.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">ALPHA ARCHITECTURE:<\/p>\n\r<p class=\"p_Normal\">===================<\/p>\n\r<p class=\"p_Normal\">&quot;WMB guarantees that all store operations before the WMB are performed before any store operations after the WMB&quot; - Alpha Architecture Handbook<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WMB orders:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;✓ Store → Store &nbsp;(write after write)<\/p>\n\r<p class=\"p_Normal\"> &nbsp;✗ Load &nbsp;→ Load &nbsp; (reads can reorder - NOT ordered by WMB)<\/p>\n\r<p class=\"p_Normal\"> &nbsp;✗ Load &nbsp;→ Store &nbsp;(NOT ordered by WMB)<\/p>\n\r<p class=\"p_Normal\"> &nbsp;✗ Store → Load &nbsp; (reads can bypass - NOT ordered by WMB)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WHEN TO USE:<\/p>\n\r<p class=\"p_Normal\">============<\/p>\n\r<p class=\"p_Normal\">1. Write buffer flushing<\/p>\n\r<p class=\"p_Normal\">2. Multiple stores that must complete in order<\/p>\n\r<p class=\"p_Normal\">3. Write-only synchronization (producer updating shared data)<\/p>\n\r<p class=\"p_Normal\">4. Performance optimization when reads don\'t need ordering<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">\/\/ EXAMPLE 1: Lock Implementation (Critical Use Case)<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">SCENARIO: Spinlock acquisition in SMP system<\/p>\n\r<p class=\"p_Normal\">=============================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Without MB, the CPU might reorder memory operations, breaking the lock!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Alpha Assembly Code (CORRECT with MB):<\/p>\n\r<p class=\"p_Normal\">---------------------------------------<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">acquire_lock:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x1000:&nbsp;&nbsp;LDQ_L&nbsp;&nbsp;R1,&nbsp;lock_var&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Load-locked&nbsp;the&nbsp;lock<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x1004:&nbsp;&nbsp;BNE&nbsp;&nbsp;&nbsp;&nbsp;R1,&nbsp;acquire_lock&nbsp;;&nbsp;If&nbsp;locked,&nbsp;retry<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x1008:&nbsp;&nbsp;MOV&nbsp;&nbsp;&nbsp;&nbsp;1,&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Value&nbsp;to&nbsp;store&nbsp;(locked=1)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x100C:&nbsp;&nbsp;STQ_C&nbsp;&nbsp;R2,&nbsp;lock_var&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Store-conditional&nbsp;(acquire&nbsp;lock)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x1010:&nbsp;&nbsp;BEQ&nbsp;&nbsp;&nbsp;&nbsp;R2,&nbsp;acquire_lock&nbsp;;&nbsp;If&nbsp;failed,&nbsp;retry<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x1014:&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;MEMORY&nbsp;BARRIER&nbsp;-&nbsp;Critical!<\/span><\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;&nbsp;<span class=\"f_CodeExample\">&nbsp;&nbsp;;&nbsp;Now&nbsp;safe&nbsp;to&nbsp;access&nbsp;protected&nbsp;data:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x1018:&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;&nbsp;R3,&nbsp;shared_data&nbsp;&nbsp;;&nbsp;Read&nbsp;protected&nbsp;data<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x101C:&nbsp;&nbsp;ADDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;1,&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Modify&nbsp;it<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x1020:&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;&nbsp;R3,&nbsp;shared_data&nbsp;&nbsp;;&nbsp;Write&nbsp;it&nbsp;back<\/span><\/p>\n\r<p class=\"p_Normal\"> &nbsp; &nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">release_lock:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x1024:&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;MEMORY&nbsp;BARRIER&nbsp;before&nbsp;release<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;0x1028:&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;&nbsp;R31,&nbsp;lock_var&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Release&nbsp;lock&nbsp;(store&nbsp;0)<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WHY MB IS CRITICAL:<\/p>\n\r<p class=\"p_Normal\">===================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WITHOUT MB after lock acquisition:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;CPU might reorder: &quot;LDQ R3, shared_data&quot; BEFORE &quot;STQ_C R2, lock_var&quot;<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Result: Reading shared_data BEFORE actually acquiring the lock!<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Race condition: Two CPUs might read\/modify simultaneously!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WITHOUT MB before lock release:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;CPU might reorder: &quot;STQ R31, lock_var&quot; BEFORE &quot;STQ R3, shared_data&quot;<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Result: Releasing lock BEFORE finishing write to shared_data!<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Race condition: Another CPU might see partial update!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WITH MB:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Lock acquisition completes → MB → Memory accesses in protected region<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Memory accesses complete → MB → Lock release<\/p>\n\r<p class=\"p_Normal\"> &nbsp;GUARANTEED correct synchronization!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">\/\/ CYCLE-BY-CYCLE PIPELINE FLOW FOR MB<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Scenario: Lock acquisition followed by protected memory access<\/p>\n\r<p class=\"p_Normal\">===============================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Alpha Assembly:<\/p>\n\r<p class=\"p_Normal\">---------------<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">0x100C:&nbsp;&nbsp;STQ_C&nbsp;&nbsp;R2,&nbsp;lock_var&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Acquire&nbsp;lock&nbsp;(store-conditional)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">0x1010:&nbsp;&nbsp;BEQ&nbsp;&nbsp;&nbsp;&nbsp;R2,&nbsp;acquire_lock&nbsp;;&nbsp;Check&nbsp;if&nbsp;succeeded<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">0x1014:&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Memory&nbsp;barrier<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">0x1018:&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;&nbsp;R3,&nbsp;shared_data&nbsp;&nbsp;;&nbsp;Load&nbsp;protected&nbsp;data<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">0x101C:&nbsp;&nbsp;ADDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;1,&nbsp;R4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Increment<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">0x1020:&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;&nbsp;R4,&nbsp;shared_data&nbsp;&nbsp;;&nbsp;Store&nbsp;back<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">CYCLE&nbsp;0-3:&nbsp;Pipeline&nbsp;Filling&nbsp;(STQ_C&nbsp;enters)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">CYCLE&nbsp;3:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">-------|-----------|-----------|-----------|-----------|-----------|----------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Inst:&nbsp;&nbsp;|&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;STQ_C&nbsp;R2&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x1010)&nbsp;&nbsp;|&nbsp;(0x100C)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">CYCLE&nbsp;4:&nbsp;STQ_C&nbsp;executes,&nbsp;MB&nbsp;enters&nbsp;Decode<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">-------|-----------|-----------|-----------|-----------|-----------|----------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Inst:&nbsp;&nbsp;|&nbsp;LDQ&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;STQ_C&nbsp;R2&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1018)&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x1010)&nbsp;&nbsp;|&nbsp;(0x100C)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;^^^^^^^^^&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Store&nbsp;executes&nbsp;-&nbsp;begins&nbsp;write<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">CYCLE&nbsp;5:&nbsp;MB&nbsp;reaches&nbsp;Execute&nbsp;stage&nbsp;-&nbsp;SETS&nbsp;BARRIER&nbsp;FLAGS<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">-------|-----------|-----------|-----------|-----------|-----------|----------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Inst:&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3&nbsp;&nbsp;&nbsp;|&nbsp;LDQ&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;STQ_C&nbsp;R2&nbsp;&nbsp;|&nbsp;[empty]<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x101C)&nbsp;&nbsp;|&nbsp;(0x1018)&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x1010)&nbsp;&nbsp;|&nbsp;(0x100C)&nbsp;&nbsp;|<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;^^^^^^^^^&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;^^^^^^^^^&nbsp;|<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;EXECUTES:&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Writing&nbsp;to&nbsp;memory<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;stalled=true<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;serializeType=Barrier_MB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;MB&nbsp;sets&nbsp;stall&nbsp;-&nbsp;pipeline&nbsp;STOPS&nbsp;FETCHING<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;isFrontendStalled()&nbsp;=&nbsp;TRUE<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">CYCLE&nbsp;6:&nbsp;Pipeline&nbsp;draining&nbsp;-&nbsp;MB&nbsp;stalled,&nbsp;waiting&nbsp;for&nbsp;STQ_C&nbsp;to&nbsp;complete<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">-------|-----------|-----------|-----------|-----------|-----------|----------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Inst:&nbsp;&nbsp;|&nbsp;[STALL]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3&nbsp;&nbsp;&nbsp;|&nbsp;MB*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;STQ_C&nbsp;R2<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x101C)&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x1010)&nbsp;&nbsp;|&nbsp;(0x100C)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(STALLED)&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;^^^^^^^^<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Completing&nbsp;write<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;checkBarrierRelease(slot)&nbsp;checks:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;Prior&nbsp;stages&nbsp;(0-2):&nbsp;ADDQ&nbsp;is&nbsp;in&nbsp;Issue&nbsp;stage&nbsp;(stage&nbsp;2)&nbsp;-&nbsp;NOT&nbsp;CLEAR<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;Write&nbsp;buffers:&nbsp;STQ_C&nbsp;still&nbsp;completing&nbsp;-&nbsp;NOT&nbsp;DRAINED<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;→&nbsp;STAY&nbsp;STALLED<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">CYCLE&nbsp;7:&nbsp;Still&nbsp;draining&nbsp;-&nbsp;waiting&nbsp;for&nbsp;write&nbsp;to&nbsp;complete<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">-------|-----------|-----------|-----------|-----------|-----------|----------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Inst:&nbsp;&nbsp;|&nbsp;[STALL]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;MB*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x101C)&nbsp;&nbsp;|&nbsp;(0x1010)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(STALLED)&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;checkBarrierRelease(slot)&nbsp;checks:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;Prior&nbsp;stages&nbsp;(0-2):&nbsp;All&nbsp;empty&nbsp;now&nbsp;-&nbsp;CLEAR&nbsp;✓<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;Write&nbsp;buffers:&nbsp;Checking&nbsp;CBox&nbsp;write&nbsp;buffer&nbsp;status<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;hasPendingMMIO():&nbsp;STQ_C&nbsp;write&nbsp;still&nbsp;buffered&nbsp;-&nbsp;NOT&nbsp;DRAINED<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;→&nbsp;STAY&nbsp;STALLED<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">CYCLE&nbsp;8:&nbsp;Write&nbsp;buffer&nbsp;drained&nbsp;-&nbsp;MB&nbsp;can&nbsp;release<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">-------|-----------|-----------|-----------|-----------|-----------|----------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Inst:&nbsp;&nbsp;|&nbsp;[STALL]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;MB*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x101C)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(STALLED)&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;checkBarrierRelease(slot)&nbsp;checks:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;✓&nbsp;Prior&nbsp;stages&nbsp;(0-2):&nbsp;All&nbsp;empty&nbsp;-&nbsp;CLEAR<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;✓&nbsp;Write&nbsp;buffers:&nbsp;STQ_C&nbsp;write&nbsp;committed&nbsp;to&nbsp;memory&nbsp;-&nbsp;DRAINED<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;✓&nbsp;Memory&nbsp;quiescent:&nbsp;No&nbsp;pending&nbsp;memory&nbsp;ops<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;&nbsp;&nbsp;→&nbsp;RELEASE:&nbsp;stalled&nbsp;=&nbsp;false<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">CYCLE&nbsp;9:&nbsp;MB&nbsp;released&nbsp;-&nbsp;advances&nbsp;to&nbsp;MEM,&nbsp;fetch&nbsp;resumes<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">================================================================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">-------|-----------|-----------|-----------|-----------|-----------|----------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Inst:&nbsp;&nbsp;|&nbsp;LDQ&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[empty]<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1018)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;MB&nbsp;advances&nbsp;to&nbsp;MEM&nbsp;(no-op&nbsp;for&nbsp;MB)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;isFrontendStalled()&nbsp;=&nbsp;FALSE<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">\/\/&nbsp;Fetch&nbsp;resumes&nbsp;-&nbsp;LDQ&nbsp;R3&nbsp;(protected&nbsp;data&nbsp;read)&nbsp;is&nbsp;fetched<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">CRITICAL GUARANTEE:<\/p>\n\r<p class=\"p_Normal\">===================<\/p>\n\r<p class=\"p_Normal\">LDQ R3 (reading shared_data) CANNOT execute until AFTER STQ_C (lock acquisition)<\/p>\n\r<p class=\"p_Normal\">completes and its write is globally visible. This ensures correct synchronization!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">================================================================================<\/p>\n\r<p class=\"p_Normal\">CYCLE 10: MB completes, protected data read begins<\/p>\n\r<p class=\"p_Normal\">================================================================================<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">-------|-----------|-----------|-----------|-----------|-----------|----------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Inst:&nbsp;&nbsp;|&nbsp;STQ&nbsp;R4&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3&nbsp;&nbsp;&nbsp;|&nbsp;LDQ&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;MB<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1020)&nbsp;&nbsp;|&nbsp;(0x101C)&nbsp;&nbsp;|&nbsp;(0x1018)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ MB completes writeback<\/p>\n\r<p class=\"p_Normal\">\/\/ LDQ R3 proceeds normally - lock is guaranteed acquired<\/p>\n\r<p class=\"p_Normal\">\/\/ All memory operations properly ordered!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">\/\/ EXAMPLE 2: Producer-Consumer Queue (Classic Use Case)<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">SCENARIO: Thread-safe message passing between CPUs<\/p>\n\r<p class=\"p_Normal\">===================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Producer&nbsp;CPU&nbsp;writes&nbsp;data,&nbsp;then&nbsp;sets&nbsp;flag:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">------------------------------------------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R1,&nbsp;data_buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Write&nbsp;data<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Ensure&nbsp;data&nbsp;written<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R31,&nbsp;ready_flag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Set&nbsp;flag&nbsp;(data&nbsp;ready)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Consumer&nbsp;CPU&nbsp;checks&nbsp;flag,&nbsp;then&nbsp;reads&nbsp;data:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">-------------------------------------------<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">spin_wait:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R2,&nbsp;ready_flag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Check&nbsp;flag<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;BEQ&nbsp;&nbsp;&nbsp;R2,&nbsp;spin_wait&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Wait&nbsp;until&nbsp;ready<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Ensure&nbsp;flag&nbsp;read<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;data_buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Read&nbsp;data&nbsp;(now&nbsp;safe!)<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WHY MB IS CRITICAL:<\/p>\n\r<p class=\"p_Normal\">===================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WITHOUT MB in producer:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;CPU might reorder: &quot;STQ R31, ready_flag&quot; BEFORE &quot;STQ R1, data_buffer&quot;<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Consumer sees flag set, reads data_buffer before it\'s written!<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Result: GARBAGE DATA!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WITHOUT MB in consumer:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;CPU might reorder: &quot;LDQ R3, data_buffer&quot; BEFORE &quot;LDQ R2, ready_flag&quot;<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Reads old data before producer updates it!<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Result: STALE DATA!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WITH MB:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Producer: Data write completes → MB → Flag set<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Consumer: Flag read completes → MB → Data read<\/p>\n\r<p class=\"p_Normal\"> &nbsp;GUARANTEED: Consumer never reads data before producer writes it!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">\/\/ EXAMPLE 3: Memory-Mapped I\/O (Device Registers)<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">SCENARIO:&nbsp;Writing&nbsp;to&nbsp;DMA&nbsp;controller&nbsp;registers<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">==============================================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R1,&nbsp;dma_addr_reg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Set&nbsp;DMA&nbsp;source&nbsp;address<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R2,&nbsp;dma_count_reg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Set&nbsp;transfer&nbsp;count<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Ensure&nbsp;registers&nbsp;written&nbsp;IN&nbsp;ORDER<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R3,&nbsp;dma_start_reg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Start&nbsp;DMA&nbsp;(must&nbsp;be&nbsp;last!)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_Normal\">WHY MB IS CRITICAL:<\/p>\n\r<p class=\"p_Normal\">===================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WITHOUT MB:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;CPU might reorder stores to MMIO registers<\/p>\n\r<p class=\"p_Normal\"> &nbsp;dma_start_reg might be written BEFORE dma_addr_reg\/dma_count_reg<\/p>\n\r<p class=\"p_Normal\"> &nbsp;DMA starts with GARBAGE address\/count!<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Result: System crash, data corruption, hardware damage!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">WITH MB:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;Address\/count registers written first → MB → Start register written last<\/p>\n\r<p class=\"p_Normal\"> &nbsp;GUARANTEED: DMA gets correct parameters before starting!<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">\/\/ MB vs WMB Comparison<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">MB (Memory Barrier):<\/p>\n\r<p class=\"p_Normal\">====================<\/p>\n\r<p class=\"p_Normal\">Orders: &nbsp;ALL memory operations (loads AND stores)<\/p>\n\r<p class=\"p_Normal\">Waits: &nbsp; All prior loads AND stores complete<\/p>\n\r<p class=\"p_Normal\">Allows: &nbsp;Nothing to bypass (full fence)<\/p>\n\r<p class=\"p_Normal\">Use: &nbsp; &nbsp; Synchronization, locks, MMIO sequences<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Example:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R1,&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Load<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R2,&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Store<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Both&nbsp;load&nbsp;AND&nbsp;store&nbsp;must&nbsp;complete<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;load&nbsp;waits&nbsp;for&nbsp;both&nbsp;above<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R4,&nbsp;w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;store&nbsp;waits&nbsp;for&nbsp;both&nbsp;above<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">WMB&nbsp;(Write&nbsp;Memory&nbsp;Barrier):<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">===========================<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Orders:&nbsp;&nbsp;Only&nbsp;STORES&nbsp;(loads&nbsp;can&nbsp;bypass)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Waits:&nbsp;&nbsp;&nbsp;All&nbsp;prior&nbsp;stores&nbsp;complete<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Allows:&nbsp;&nbsp;Loads&nbsp;to&nbsp;bypass&nbsp;(performance&nbsp;optimization)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">Use:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-only&nbsp;synchronization,&nbsp;write&nbsp;buffers<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_Normal\">Example:<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;&nbsp;<span class=\"f_CodeExample\">&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R1,&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Store&nbsp;1<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R2,&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Store&nbsp;2<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;WMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Both&nbsp;stores&nbsp;must&nbsp;complete<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;load&nbsp;can&nbsp;START&nbsp;before&nbsp;WMB&nbsp;completes!<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R4,&nbsp;w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;store&nbsp;waits&nbsp;for&nbsp;stores&nbsp;above<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">KEY DIFFERENCE:<\/p>\n\r<p class=\"p_Normal\">===============<\/p>\n\r<p class=\"p_Normal\">MB: &nbsp;Stalls EVERYTHING (loads + stores)<\/p>\n\r<p class=\"p_Normal\">WMB: Stalls only stores (loads can proceed)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">USE MB when: &nbsp;Synchronizing both reads and writes<\/p>\n\r<p class=\"p_Normal\">USE WMB when: Only need to order writes (performance win!)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">\/\/ Release Conditions for MB<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">MB can be released when ALL of these are true:<\/p>\n\r<p class=\"p_Normal\">===============================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">1. All PRIOR pipeline stages are empty\/invalid<\/p>\n\r<p class=\"p_Normal\"> &nbsp; → No instructions before MB are in-flight<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">2. All write buffers are drained<\/p>\n\r<p class=\"p_Normal\"> &nbsp; → hasPendingMMIO() returns false<\/p>\n\r<p class=\"p_Normal\"> &nbsp; → All buffered stores committed to memory<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">3. All pending memory operations complete<\/p>\n\r<p class=\"p_Normal\"> &nbsp; → No loads\/stores in MEM stage before MB<\/p>\n\r<p class=\"p_Normal\"> &nbsp; → Memory subsystem quiescent<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">4. For SMP systems: Global memory barrier acknowledged<\/p>\n\r<p class=\"p_Normal\"> &nbsp; → Other CPUs have reached synchronization point<\/p>\n\r<p class=\"p_Normal\"> &nbsp; → Memory order visible across all CPUs<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Stall Duration:<\/p>\n\r<p class=\"p_Normal\">===============<\/p>\n\r<p class=\"p_Normal\">Minimum: ~3-5 cycles (pipeline drain time)<\/p>\n\r<p class=\"p_Normal\">Typical: ~5-10 cycles (including write buffer drain)<\/p>\n\r<p class=\"p_Normal\">Maximum: Varies (depends on memory latency, SMP coordination)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">For lock acquisition:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;~5-8 cycles typical (local memory)<\/p>\n\r<p class=\"p_Normal\"> &nbsp;~20-50 cycles if waiting for remote CPU caches (SMP)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">For MMIO:<\/p>\n\r<p class=\"p_Normal\"> &nbsp;~10-100 cycles (depends on device response time)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">\/\/ Implementation Summary for MB<\/p>\n\r<p class=\"p_Normal\">\/\/ ============================================================================<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">In CBox::executeMB(PipelineSlot&amp; slot):<\/p>\n\r<p class=\"p_Normal\">=======================================<\/p>\n\r<p class=\"p_Normal\">1. Drain write buffers<\/p>\n\r<p class=\"p_Normal\">2. Execute platform memory barrier<\/p>\n\r<p class=\"p_Normal\">3. SMP coordination (if multiprocessor)<\/p>\n\r<p class=\"p_Normal\">4. Set: stalled=true, serializeType=Barrier_MB<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">In AlphaPipeline::checkBarrierRelease(slot):<\/p>\n\r<p class=\"p_Normal\">=============================================<\/p>\n\r<p class=\"p_Normal\">1. Check prior stages clear<\/p>\n\r<p class=\"p_Normal\">2. Check write buffers drained<\/p>\n\r<p class=\"p_Normal\">3. Check memory operations complete<\/p>\n\r<p class=\"p_Normal\">4. If all true → stalled=false<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Result:<\/p>\n\r<p class=\"p_Normal\">=======<\/p>\n\r<p class=\"p_Normal\">Lock acquisition works correctly<\/p>\n\r<p class=\"p_Normal\">Producer-consumer queues work correctly<\/p>\n\r<p class=\"p_Normal\">MMIO sequences execute in order<\/p>\n\r<p class=\"p_Normal\">SMP synchronization is guaranteed<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r"
})
