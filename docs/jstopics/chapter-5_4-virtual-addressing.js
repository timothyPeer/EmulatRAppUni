hmLoadTopic({
hmKeywords:"",
hmTitle:"5.4 Virtual Addressing and Translation",
hmDescription:"5.4.1 Virtual Address Space  All instructions operate on virtual addresses. The emulator models per-CPU ITB (Instruction TLB) and DTB (Data TLB) with ASN (Address Space Number)...",
hmPrevLink:"chapter-5_3-memory-layers-over.html",
hmNextLink:"alpha-va-format-contract.html",
hmParentLink:"chapter-5---memory-system-arch.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-5---memory-system-arch.html\">Chapter 5 - Memory System Architecture<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 5 - Memory System Architecture > 5.4 Virtual Addressing and Translation",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">5.4 Virtual Addressing and Translation<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">5.4.1 Virtual Address Space<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">All instructions operate on virtual addresses. The emulator models per-CPU ITB (Instruction TLB) and DTB (Data TLB) with ASN (Address Space Number) tagging and page-level permissions.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">5.4.2 Translation Responsibility<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Address translation occurs in MBox during the EX stage. The Ev6Translator (ev6Translation_struct.h, 1,336 lines) provides the translation engine. Translation responsibilities include: VA→PA conversion, ITB\/DTB miss detection, access violation detection, alignment fault detection, and precise translation fault raising.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Translation never occurs in fetch (IBox translates instruction addresses separately), decode, or writeback.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The translator supports two paths:<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>ev6TranslateFastVA() — checks canonical address, tries KSEG fast-path (kernel segment direct mapping), then TLB lookup. Returns TranslationResult on miss without walking.<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>ev6TranslateFullVA() — same checks plus full page table walk on TLB miss, using the three-level Alpha page table structure (L1\/L2\/L3).<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">TranslationResult values: Success, TlbMiss, NonCanonical, PageNotPresent, FaultOnWrite, FaultOnRead, FaultOnExecute, AccessViolation, BusError.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">5.4.3 Alpha VA Format<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The Alpha AXP virtual address format is implementation-dependent, selected at CPU\/board bring-up, not inferred from VA bits. The format is determined by page size (pageShift) and implemented VA width (vaBits):<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">8K pages — pageShift=13, levelBits=10, vaBits=43. Fields: SEG[42:41], L1[40:33] (8 bits), L2[32:23] (10 bits), L3[22:13] (10 bits), OFFSET[12:0] (13 bits)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">16K pages — pageShift=14, levelBits=11, vaBits=43..47<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">32K pages — pageShift=15, levelBits=12, vaBits=43..51<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">64K pages — pageShift=16, levelBits=13, vaBits=46..55 (minimum vaBits=46 to satisfy L1 ≥ 2 bits)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">In all cases, bits above (vaBits-1) must be a sign-extension of bit (vaBits-1) for the address to be canonical. The segment field (2 bits) selects the address space quadrant. The three-level page table uses L1, L2, and L3 fields to index into page table entries, with the offset field providing the byte-within-page address.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Implementation note: The VA option is selected once at configuration time. The TLB lookup uses VPN = VA &gt;&gt; pageShift plus ASN\/global\/mode checks. Mixed page sizes are handled as TLB entry attributes (pageMask), not by reinterpreting VA fields.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: pteLib\/ev6Translation_struct.h; Alpha Architecture Reference Manual v6, Memory Management chapter; <a href=\"alpha-va-format-contract.html\" class=\"topiclink\">5.4.4 Alpha VA Field Boundary Reference<\/a>.<\/span><\/p>\n\r"
})
