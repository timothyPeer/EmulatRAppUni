hmLoadTopic({
hmKeywords:"AddressSpaceMatch,alpha_pte_core,alpha_pte_traits,alpha_pte_traits_ev6_dtb,alpha_pte_traits_ev6_itb,alpha_pte_view,AlphaPTE,ASN (Address Space Number),CanonicalPTE,ClockPolicy,CPUFamily,CPUStateIPRInterface,CurrentASN,DataTLB,decodeVAFromTag,DefaultInvalidationStrategy,DTB_PTE0,DTB_PTE1,DTB_TAG0,DTB_TAG1,DualDTBManagerInterface,EBoxVAState,Ev6_DtbPteTraits,FaultOnExecute,FaultOnRead,FaultOnWrite,fromDtbPteWrite,fromItbPteWrite,getAsm,GranularityHint,insertDTB,insertITB,InstructionTLB,invalidateAllDTB,invalidateAllITB,invalidateASN,IPR (Internal Processor Register),IPRStorage,isGlobal,isValid,ITB_PTE,ITB_TAG,KernelReadEnable,KernelWriteEnable,lookupDTB,lookupITB,maintenanceTick,MMU (Memory Management Unit),PageTableEntry,Permissions,PermMask,permMask,pfn,PFN (Page Frame Number),pipelineDelay,PTECache,PTETraits,PTETraits<CPUFamily>,PTEView,RandomPolicy,Realm,ReplacementPolicyEnum,Set Prediction and Access Memory,SPAMBucket,SPAMShardManager,SRRIPPolicy,stageDTB0PTE,stageDTB1PTE,stageDTBCommon,stageITBPTE,TBIA,TBIAP,TBIS,TemplatePolicyBase,TLB (Translation Lookaside Buffer),TLBFlush,tlbInsert,TLBInvalidate,tlbLookup,tlbTBIS,toDtbPteRead,toItbPteRead,TranslationBuffer,UserReadEnable,UserWriteEnable,VA (Virtual Address)",
hmTitle:"Alpha PTE Traits Usage Guide",
hmDescription:"Overview -------- The Alpha PTE subsystem uses *traits* to adapt the canonical AlphaPTE format to the specific page table layouts and access patterns of each Alpha CPU generatio",
hmPrevLink:"",
hmNextLink:"",
hmParentLink:"appendix---trait-examples.html",
hmBreadCrumbs:"",
hmTitlePath:"Introduction > Appendix > Appendix I – Global Singletons",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">Alpha PTE Traits Usage Guide<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">Overview<\/span><\/h2>\n\r<p class=\"p_Normal\">--------<\/p>\n\r<p class=\"p_Normal\">The Alpha PTE subsystem uses *traits* to adapt the canonical AlphaPTE format to the<\/p>\n\r<p class=\"p_Normal\">specific page table layouts and access patterns of each Alpha CPU generation (EV4, EV5, EV6).<\/p>\n\r<p class=\"p_Normal\">Traits provide static helpers for decoding, encoding, and extracting VA and permission info<\/p>\n\r<p class=\"p_Normal\">from hardware-format PTEs and tags.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span style=\"font-weight: bold;\">This guide explains:<\/span><\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>How to select and use PTETraits specializations<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>How to convert between raw IPR (hardware) PTEs and canonical AlphaPTEs<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>How to use these traits with the SPAMShardManager (PTE cache\/TLB manager)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>How to connect these in your CPUStateIPRInterface and page table handling code<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span style=\"font-weight: bold;\">Key Types<\/span><\/p>\n\r<p class=\"p_Normal\">---------<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>AlphaPTE &nbsp; &nbsp; &nbsp; &nbsp; : Canonical struct for all Alpha PTEs (see alpha_pte_core.h)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>PTETraits &nbsp; &nbsp; &nbsp; &nbsp;: Template providing static decode\/encode methods for a CPU gen\/layout<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>SPAMShardManager : TLB\/PTE cache template (uses traits for all encoding\/decoding)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>CPUStateIPRInterface : Your CPU\/SoC context interface for IPR and TLB operations<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">Selecting the Right Traits<\/span><\/h3>\n\r<p class=\"p_Normal\">--------------------------<\/p>\n\r<p class=\"p_Normal\">Choose the appropriate traits specialization for your target. Example for EV6 ITB and DTB:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;<span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;\/\/&nbsp;EV6&nbsp;ITB&nbsp;traits&nbsp;(Instruction&nbsp;TLB)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;ItbTraits&nbsp;=&nbsp;PTETraits&lt;CPUFamily::EV6,&nbsp;44U&gt;;&nbsp;\/\/&nbsp;44-bit&nbsp;VA<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;EV6&nbsp;DTB&nbsp;traits&nbsp;(Data&nbsp;TLB)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;DtbTraits&nbsp;=&nbsp;Ev6_DtbPteTraits&lt;CPUFamily::EV6,&nbsp;44U&gt;;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See: alpha_pte_traits_ev6_itb.h and alpha_pte_traits_ev6_dtb.h<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span style=\"font-weight: bold;\">Example: Decoding a PTE from a raw ITB_PTE register value<\/span><\/p>\n\r<p class=\"p_Normal\">---------------------------------------------------------<\/p>\n\r<p class=\"p_Normal\">Suppose you have just written to the ITB_PTE register (e.g., via MTPR). You want to canonicalize this hardware-format PTE using the trait:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;&nbsp;<span class=\"f_CodeExample\">&nbsp;&nbsp;quint64&nbsp;rawItbPte&nbsp;=&nbsp;\/*&nbsp;value&nbsp;from&nbsp;IPR&nbsp;write&nbsp;*\/;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;AlphaPTE&nbsp;canonicalPte&nbsp;=&nbsp;ItbTraits::fromItbPteWrite(rawItbPte);<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">Example: Decoding VA from an ITB_TAG register<\/span><\/p>\n\r<p class=\"p_Normal\">---------------------------------------------<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;<span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;quint64&nbsp;rawItbTag&nbsp;=&nbsp;\/*&nbsp;value&nbsp;from&nbsp;IPR&nbsp;ITB_TAG&nbsp;*\/;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;quint64&nbsp;va&nbsp;=&nbsp;ItbTraits::decodeVAFromTag(rawItbTag);<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span style=\"font-weight: bold;\">Example: Inserting a PTE into the TLB using Traits and SPAMShardManager<\/span><\/p>\n\r<p class=\"p_Normal\">----------------------------------------------------------------------<\/p>\n\r<p class=\"p_Normal\">This is the core of your stageITBPTE helper<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;&nbsp;&nbsp;<span class=\"f_CodeExample\">&nbsp;\/\/&nbsp;1.&nbsp;Canonicalize&nbsp;hardware-format&nbsp;PTE<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;AlphaPTE&nbsp;canonicalPte&nbsp;=&nbsp;ItbTraits::fromItbPteWrite(rawPteWriteFormat);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;2.&nbsp;Recover&nbsp;VA&nbsp;from&nbsp;staged&nbsp;ITB_TAG<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;quint64&nbsp;va&nbsp;=&nbsp;ItbTraits::decodeVAFromTag(stagedItbTag);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;3.&nbsp;Obtain&nbsp;current&nbsp;ASN&nbsp;from&nbsp;the&nbsp;CPU&nbsp;or&nbsp;IPR<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;quint8&nbsp;asn&nbsp;=&nbsp;getCurrentASN();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;4.&nbsp;Determine&nbsp;global&nbsp;mapping&nbsp;(ASM&nbsp;==&nbsp;0&nbsp;is&nbsp;global)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;isGlobal&nbsp;=&nbsp;!canonicalPte.getAsm();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;5.&nbsp;Insert&nbsp;into&nbsp;TLB\/SPAM<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;itbManager-&gt;tlbInsert(cpuId,&nbsp;Realm::I,&nbsp;0,&nbsp;va,&nbsp;asn,&nbsp;isGlobal,&nbsp;canonicalPte);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_Normal\"><span style=\"font-weight: bold;\">Example: Full DTB Bank Handling Using Traits (stageDTB0PTE)<\/span><\/p>\n\r<p class=\"p_Normal\">-----------------------------------------------------------<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;<span class=\"f_CodeExample\">\/\/&nbsp;1.&nbsp;Canonicalize&nbsp;hardware-format&nbsp;PTE<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;AlphaPTE&nbsp;canonicalPte&nbsp;=&nbsp;DtbTraits::fromDtbPteWrite(rawDtbPte);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;2.&nbsp;Recover&nbsp;VA&nbsp;from&nbsp;staged&nbsp;DTB_TAG0<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;quint64&nbsp;va&nbsp;=&nbsp;DtbTraits::decodeVAFromTag(stagedDtbTag0);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;3.&nbsp;Get&nbsp;ASN<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;quint8&nbsp;asn&nbsp;=&nbsp;getCurrentASN();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;4.&nbsp;Determine&nbsp;global&nbsp;mapping<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;isGlobal&nbsp;=&nbsp;!canonicalPte.getAsm();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;5.&nbsp;Insert&nbsp;into&nbsp;D-stream&nbsp;TLB\/SPAM<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;dtbManager-&gt;tlbInsert(cpuId,&nbsp;Realm::D,&nbsp;0,&nbsp;va,&nbsp;asn,&nbsp;isGlobal,&nbsp;canonicalPte);<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span style=\"font-weight: bold;\">Working with PTEView and Trait-Based Abstraction<\/span><\/p>\n\r<p class=\"p_Normal\">------------------------------------------------<\/p>\n\r<p class=\"p_Normal\">If you want a view object that wraps a canonical PTE and provides trait-based access:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;&nbsp;&nbsp;<span class=\"f_CodeExample\">&nbsp;PTEView&lt;ItbTraits&gt;&nbsp;pteView(canonicalPte);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Access&nbsp;validity,&nbsp;PFN,&nbsp;permission,&nbsp;etc.:<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;valid&nbsp;=&nbsp;pteView.isValid();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;quint32&nbsp;pfn&nbsp;=&nbsp;pteView.pfn();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;PermMask&nbsp;pmask&nbsp;=&nbsp;pteView.permMask();<\/span><\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">&nbsp;<\/span><\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See: alpha_pte_view.h<\/span><\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">&nbsp;<\/span><\/h3>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">Usage Pattern in CPUStateIPRInterface<\/span><\/h3>\n\r<p class=\"p_Normal\">-------------------------------------<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Use traits to canonicalize or decode hardware-format PTEs and tags (see stageITBPTE, stageDTB0PTE).<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Use SPAMShardManager\'s tlbInsert, tlbLookup, tlbTBIS, and invalidateASN to manage the TLB\/cache.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span style=\"font-weight: bold;\">Example: Integrating Traits with TLB Insert (from your interface)<\/span><\/p>\n\r<p class=\"p_Normal\">-----------------------------------------------------------------<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;&nbsp;<span class=\"f_CodeExample\">&nbsp;&nbsp;\/\/&nbsp;Insert&nbsp;ITB&nbsp;entry&nbsp;(instruction&nbsp;translation)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;CPUStateIPRInterface::insertITB(quint64&nbsp;va,&nbsp;quint8&nbsp;asn,&nbsp;const&nbsp;AlphaPTE&amp;&nbsp;pte,&nbsp;bool&nbsp;global)&nbsp;noexcept&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;itbManager-&gt;tlbInsert(cpuId,&nbsp;Realm::I,&nbsp;0,&nbsp;va,&nbsp;asn,&nbsp;global,&nbsp;pte);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Lookup&nbsp;DTB&nbsp;entry&nbsp;(data&nbsp;translation)<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;CPUStateIPRInterface::lookupDTB(quint64&nbsp;va,&nbsp;quint8&nbsp;asn,&nbsp;quint32&amp;&nbsp;outPfn,&nbsp;PermMask&amp;&nbsp;outPermMask)&nbsp;const&nbsp;noexcept&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;dtbManager-&gt;tlbLookup(cpuId,&nbsp;Realm::D,&nbsp;0,&nbsp;va,&nbsp;asn,&nbsp;outPfn,&nbsp;outPermMask);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_Normal\"><span style=\"font-weight: bold;\">Advanced Example: Specializing for EV6\/EV5\/EV4 at Compile Time<\/span><\/p>\n\r<p class=\"p_Normal\">--------------------------------------------------------------<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;&nbsp;&nbsp;<span class=\"f_CodeExample\">&nbsp;#if&nbsp;TARGET_CPU&nbsp;==&nbsp;CPUFamily::EV6<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;ItbTraits&nbsp;=&nbsp;PTETraits&lt;CPUFamily::EV6,&nbsp;44U&gt;;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;DtbTraits&nbsp;=&nbsp;Ev6_DtbPteTraits&lt;CPUFamily::EV6,&nbsp;44U&gt;;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;#elif&nbsp;TARGET_CPU&nbsp;==&nbsp;CPUFamily::EV5<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;ItbTraits&nbsp;=&nbsp;PTETraits&lt;CPUFamily::EV5,&nbsp;43U&gt;;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;DtbTraits&nbsp;=&nbsp;PTETraits&lt;CPUFamily::EV5,&nbsp;43U&gt;;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;#else<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;ItbTraits&nbsp;=&nbsp;PTETraits&lt;CPUFamily::EV4,&nbsp;32U&gt;;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;DtbTraits&nbsp;=&nbsp;PTETraits&lt;CPUFamily::EV4,&nbsp;32U&gt;;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;#endif<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Now all your decode\/encode logic is handled through the chosen traits type.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">Trait-Driven TLB Insert (SPAMShardManager::tlbInsert)<\/span><\/h3>\n\r<p class=\"p_Normal\">-----------------------------------------------------<\/p>\n\r<p class=\"p_CodeExample\">&nbsp;<span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;bool&nbsp;tlbInsert(quint16&nbsp;cpuId,<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Realm&nbsp;realm,<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quint8&nbsp;sizeClass,<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quint64&nbsp;va,<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;quint8&nbsp;asn,<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;isGlobal,<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;AlphaPTE&amp;&nbsp;pteRaw)&nbsp;noexcept<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;using&nbsp;T&nbsp;=&nbsp;Traits;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\/\/&nbsp;Prepare&nbsp;tag<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;auto&nbsp;tag&nbsp;=&nbsp;makeTag(va,&nbsp;realm,&nbsp;sizeClassFor(sizeClass));<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Entry&nbsp;e{};<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.tag&nbsp;=&nbsp;tag;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.asn&nbsp;=&nbsp;asn;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.flags.global&nbsp;=&nbsp;isGlobal;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.flags.transitioning&nbsp;=&nbsp;false;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.asnGenAtFill&nbsp;=&nbsp;m_asnEpochs[cpuId][asn].loadRelaxed();<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.pfn&nbsp;=&nbsp;static_cast&lt;quint32&gt;(T::pfn(pteRaw));<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.permMask&nbsp;=&nbsp;T::permMask(pteRaw);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;e.pteRaw&nbsp;=&nbsp;pteRaw;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auto&amp;&nbsp;buck&nbsp;=&nbsp;bucket(cpuId,&nbsp;realm,&nbsp;sizeClass,&nbsp;bucketIndex(tag));<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;buck.insert(e);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;&nbsp;&nbsp;&nbsp;}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See: alpha_spam_manager.h<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">References<\/span><\/h3>\n\r<p class=\"p_Normal\">----------<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>alpha_pte_traits.h, alpha_pte_traits_ev6_itb.h, alpha_pte_traits_ev6_dtb.h<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>alpha_pte_core.h (AlphaPTE definition)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>alpha_pte_view.h (PTEView class)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>alpha_spam_manager.h (SPAMShardManager)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>CPUStateIPRInterface.h\/.cpp (your interface)<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h3 class=\"p_Heading3\" style=\"page-break-after: avoid;\"><span class=\"f_Heading3\">Best Practices<\/span><\/h3>\n\r<p class=\"p_Normal\">--------------<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Always decode hardware-format PTEs and tags using the correct traits.<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Never assume a specific layout—always use traits helpers for cross-generation support.<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Use PTEView when you need safe, readable field access for generic code.<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Use SPAMShardManager for all translation buffer (TLB\/PTE cache) management.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Generated for ASA-EmulatR Project - 2025-11-14.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r"
})
