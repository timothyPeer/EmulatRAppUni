hmLoadTopic({
hmKeywords:"",
hmTitle:"20.1 PalBox Execution Domain",
hmDescription:"20.1.1 Role and Design  The PalBox is an EmulatR-specific execution domain that has no direct hardware counterpart on the 21264 die. On real Alpha silicon, PALcode executed as...",
hmPrevLink:"chapter-20---boot-sequence_-pa.html",
hmNextLink:"20_2-palservice-delegation.html",
hmParentLink:"chapter-20---boot-sequence_-pa.html",
hmBreadCrumbs:"<a href=\"license-_-attributions.html\">ASA-EMulatR Reference Guide<\/a> &gt; <a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-20---boot-sequence_-pa.html\">Chapter 20 – Boot Sequence, PAL, and SRM Integration<\/a>",
hmTitlePath:"ASA-EMulatR Reference Guide > Introduction > Architecture Overview > Chapter 20 – Boot Sequence, PAL, and SRM Integration > 20.1 PalBox Execution Domain",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">20.1 PalBox Execution Domain<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">20.1.1 Role and Design<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">The PalBox is an EmulatR-specific execution domain that has no direct hardware counterpart on the 21264 die. On real Alpha silicon, PALcode executed as privileged Alpha instructions with access to hardware-internal processor registers through HW_MFPR and HW_MTPR opcodes. In EmulatR, the PalBox encapsulates all PAL mode entry\/exit logic, CALL_PAL dispatch, IPR access, shadow register management, and system service routing.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Implementation: <span class=\"f_CodeExample\">PalBoxLib\/PalBoxBase.h<\/span>, ~2,122 lines, 175 execute methods. PalBox supports the full Tru64 UNIX PAL call set as defined in the Alpha Architecture Reference Manual.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">20.1.2 Responsibilities<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">CALL_PAL dispatch:<\/strong> <span class=\"f_CodeExample\">executeCALL_PAL()<\/span> extracts the PAL function code from instruction bits [7:0] and routes to the appropriate PalService handler.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">PAL mode entry and exit:<\/strong> <span class=\"f_CodeExample\">enterPal(reason, vector, faultPC)<\/span> sets PAL mode and redirects execution to the exception\/interrupt handler. Only HW_REI may exit PAL mode.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Privileged register access:<\/strong> HW_MFPR (opcode 0x19) reads IPRs; HW_MTPR (opcode 0x1D) writes IPRs. Both are PAL-mode-only.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Hardware load\/store:<\/strong> HW_LD (opcode 0x1B) and HW_ST (opcode 0x1F) provide PAL-mode physical memory access bypassing normal VA→PA translation.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Exception vectoring:<\/strong> Computes PAL entry vectors from PAL_BASE + offset for exception and interrupt delivery.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Shadow register management:<\/strong> Activates and deactivates the PAL shadow register bank during PAL mode transitions.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">Low-level OS services:<\/strong> Implements privileged PAL calls including HALT, RESTART, DRAINA, SWPCTX (context switch), DI\/EI (disable\/enable interrupts), IMB (instruction memory barrier), CHMK\/CHMS\/CHME\/CHMU (change mode), CALLSYS, BPT, BUGCHK, GENTRAP, and the interlocked queue operations (INSQHIL, INSQTIL, REMQHIL, REMQTIL, etc.).<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><strong style=\"font-weight: bold;\">BoxResult mapping:<\/strong> <span class=\"f_CodeExample\">applyBoxResult()<\/span> unpacks BoxResult flags (flush, enter PAL mode, fault info) into PipelineSlot fields for pipeline consumption.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: PalBoxLib\/PalBoxBase.h (~2,122 lines, 175 execute methods); <a href=\"14_6-palbox---privileged-archi.html\" class=\"topiclink\">14.6 PalBox – Privileged Architecture Library Execution Box<\/a>.<\/span><\/p>\n\r"
})
