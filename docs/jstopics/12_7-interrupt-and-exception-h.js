hmLoadTopic({
hmKeywords:"",
hmTitle:"12.7 Interrupt and Exception Handling",
hmDescription:"12.7.1 Interrupt Handling  AlphaCPU checks for interrupts at the start of every cycle (before fetch). The handleInterrupt() method:  void handleInterrupt() {  if (!m_pending->",
hmPrevLink:"12_6-pipeline-integration.html",
hmNextLink:"12_8-pal-integration.html",
hmParentLink:"alphacpu-core.html",
hmBreadCrumbs:"<a href=\"license-_-attributions.html\">ASA-EMulatR Reference Guide<\/a> &gt; <a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"alphacpu-core.html\">Chapter 12 – AlphaCPU Core<\/a>",
hmTitlePath:"ASA-EMulatR Reference Guide > Introduction > Architecture Overview > Chapter 12 – AlphaCPU Core > 12.7 Interrupt and Exception Handling",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">12.7 Interrupt and Exception Handling<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">12.7.1 Interrupt Handling<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">AlphaCPU checks for interrupts at the start of every cycle (before fetch). The handleInterrupt() method:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">void&nbsp;handleInterrupt()&nbsp;{<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;if&nbsp;(!m_pending-&gt;hasDeliverable(currentIPL))&nbsp;return;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;ClaimedInterrupt&nbsp;claimed&nbsp;=&nbsp;m_pending-&gt;claimNext(currentIPL);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;if&nbsp;(!claimed.valid)&nbsp;return;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;m_pBox-&gt;palService()-&gt;clearSisrIfSoftware(claimed);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;m_reservationManager-&gt;breakReservation(m_cpuId);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;m_pBox-&gt;palService()-&gt;deliverInterrupt(claimed);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">&nbsp;m_alphaPipeline-&gt;flush(&quot;flush::interruptDelivery&quot;);<\/span><\/p>\n\r<p class=\"p_CodeExample\"><span class=\"f_CodeExample\">}<\/span><\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Key sequence: claim highest-priority deliverable interrupt, clear SISR bit if software interrupt, break LL\/SC reservation, deliver through PalService (enters PAL), flush pipeline. Interrupts never interrupt instruction execution mid-cycle — they are checked before the next fetch.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">12.7.2 Exception Handling via BoxResult<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Faults detected during execution return via BoxResult flags from the pipeline tick. AlphaCPU handles them in runOneInstruction() only when boxResult.faultWasDispatched() is true (fault reached WB retirement). The handling sequence: flush pipeline, enter PAL via m_pBox→enterPal() with the appropriate PalEntryReason and vector, drain write buffers if needed, issue memory barrier if needed.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">12.7.3 Redirect Handling<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">handleRedirect(reason, metadata1, metadata2) provides a unified dispatch for all control flow changes. The RedirectReason enum classifies redirects:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">None — no redirect. BranchMisprediction, BranchTaken, Jump, JumpSubroutine, Return, Coroutine — set PC to target, flush pipeline if misprediction. PALEntry — compute CALL_PAL entry vector, enter PAL. PALReturn — restore context via restoreContext(). Trap — compute trap vector, enter PAL. Interrupt — compute interrupt vector, enter PAL. MachineCheck — compute MCHK vector, enter PAL.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: <a href=\"chapter-7---interrupt-and-ipi-.html\" class=\"topiclink\">Chapter 7 - Exceptions, Faults, and Interrupts<\/a>; cpuCoreLib\/RedirectReason.h.<\/span><\/p>\n\r"
})
