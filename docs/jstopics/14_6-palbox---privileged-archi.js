hmLoadTopic({
hmKeywords:"",
hmTitle:"14.6 PalBox – Privileged Architecture Library Execution Box",
hmDescription:"The PalBox is an EmulatR-specific execution domain that has no direct hardware counterpart on the 21264 die. On real Alpha silicon, PALcode executed as privileged Alpha...",
hmPrevLink:"14_5-cbox---cache-_-control-bo.html",
hmNextLink:"14_7-box-interaction-model.html",
hmParentLink:"chapter-14---execution-domains.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-14---execution-domains.html\">Chapter 14 – Execution Domains (“Boxes”)<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 14 – Execution Domains (“Boxes”) > 14.6 PalBox – Privileged Architecture Library Execution Box",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">14.6 PalBox – Privileged Architecture Library Execution Box<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">The PalBox is an EmulatR-specific execution domain that has no direct hardware counterpart on the 21264 die. On real Alpha silicon, PALcode executed as privileged Alpha instructions with access to hardware-internal processor registers (IPRs) through HW_MFPR and HW_MTPR opcodes. In EmulatR, the PalBox encapsulates all PAL mode entry\/exit logic, CALL_PAL dispatch, IPR access, shadow register management, and system service routing. It delegates the actual PAL service implementations to <span class=\"f_CodeExample\">PalService<\/span> (palLib_EV6\/).<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">14.6.1 Responsibilities<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>CALL_PAL dispatch: decode the 8-bit function code from instruction bits [7:0] and route to the appropriate PAL service handler<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Privileged PAL calls: HALT, CFLUSH, DRAINA, CSERVE, IMB, INITPAL, and various DTB\/ITB management<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Unprivileged PAL calls: BPT, BUGCHK, CALLSYS, GENTRAP, KBPT, and the CHMx (Change Mode) family – CHME, CHMK, CHMS, CHMU<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Queue manipulation: INSQHIL, INSQHILR, INSQHIQ, INSQHIQR, INSQTIL, INSQTILR, INSQTIQ, INSQTIQR, INSQUEL, INSQUEQ<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>HW_MFPR \/ HW_MTPR: read and write internal processor registers (ASN, ASTEN, ASTSR, ESP, FEN, IPL, SSP, USP, etc.)<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>PAL mode entry (<span class=\"f_CodeExample\">enterPal<\/span>): save context, activate shadow registers, compute entry PC from PalVectorTable, set PAL mode flag<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>PAL mode exit (RTI – Return from Interrupt): restore context, deactivate shadow registers, return to interrupted PC<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Exception handling: route machine checks, arithmetic traps, memory faults, and alignment faults to the appropriate PAL vector<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span>Shadow register management: activate\/deactivate the PAL shadow register bank for R0–R7 during PAL mode transitions<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">14.6.2 PAL Entry Flow<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">When a CALL_PAL instruction is decoded by the IBox or an exception is raised by any box, the PalBox\'s <span class=\"f_CodeExample\">enterPal()<\/span> method is invoked with a <span class=\"f_CodeExample\">PalEntryReason<\/span>, a vector or selector, and the faulting PC. The method saves the current context (PC, processor status), activates PAL shadow registers, looks up the entry point from the <span class=\"f_CodeExample\">PalVectorTable<\/span>, and transfers control. The actual PAL service logic then executes within <span class=\"f_CodeExample\">PalService<\/span>, which may perform HW_MFPR\/HW_MTPR operations, queue manipulations, or TLB management before returning a <span class=\"f_CodeExample\">BoxResult<\/span> that indicates how execution should resume.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">14.6.3 Source Files<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<div style=\"text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;\"><table style=\"border:none; border-spacing:0; border-collapse:collapse;\">\n\r<thead>\n\r<tr>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><span style=\"font-weight: bold;\">File<\/span><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><span style=\"font-weight: bold;\">Lines (approx)<\/span><\/p>\n\r<\/th>\n\r<th style=\"vertical-align:top; background-color:#00FFFF; padding:0; border:solid thin #000000;\" scope=\"col\"><p class=\"p_Normal\"><span style=\"font-weight: bold;\">Content<\/span><\/p>\n\r<\/th>\n\r<\/tr>\n\r<\/thead>\n\r<tbody>\n\r<tr>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">PalBoxLib\/PalBoxBase.h<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">~2,122<\/p>\n\r<\/td>\n\r<td style=\"vertical-align:top; padding:0; border:solid thin #000000;\"><p class=\"p_Normal\">PalBox class: CALL_PAL dispatch, HW_MFPR\/HW_MTPR, enterPal, RTI, exception routing<\/p>\n\r<\/td>\n\r<\/tr>\n\r<\/tbody>\n\r<\/table>\n\r<\/div>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: palLib_EV6\/PalVectorTable_final.h – PAL vector table definitions; palLib_EV6\/Pal_Service.h – PalService class (actual PAL operation implementations); palLib_EV6\/Pal_core_inl.h – PAL core inline helpers; palLib_EV6\/PAL_core.h – PAL constants and entry reason enumeration.<\/span><\/p>\n\r"
})
