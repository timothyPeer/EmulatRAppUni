hmLoadTopic({
hmKeywords:"",
hmTitle:"18.9 Barrier Interaction",
hmDescription:"Exceptions interact with the serialization and reservation systems through several mechanisms that ensure exception safety:",
hmPrevLink:"18_8-precise-exception-guarant.html",
hmNextLink:"18_10-architectural-invariants.html",
hmParentLink:"chapter-18---fault-dispatcher-.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-18---fault-dispatcher-.html\">Chapter 18 – Fault Dispatcher &amp; Precise Exceptions<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 18 – Fault Dispatcher & Precise Exceptions > 18.9 Barrier Interaction",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">18.9 Barrier Interaction<\/span><\/h1>\n\r",
hmBody:"<p class=\"p_Normal\">Exceptions interact with the serialization and reservation systems through several mechanisms that ensure exception safety:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">18.9.1 EXCB – Exception Barrier<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span class=\"f_CodeExample\">EXCB<\/span> enforces exception precision — it cannot release until <span class=\"f_CodeExample\">FaultDispatcher::eventPending()<\/span> returns false. This guarantees that all exceptions from prior instructions have been delivered before instructions after the EXCB execute. EXCB is the strongest exception synchronization point available to user-mode code.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">18.9.2 TRAPB – Trap Barrier<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span class=\"f_CodeExample\">TRAPB<\/span> enforces arithmetic trap ordering — it cannot release until <span class=\"f_CodeExample\">FaultDispatcher::hasPendingArithmeticTraps()<\/span> returns false. This ensures that all prior arithmetic traps have been delivered and cleared before later instructions execute. The <span class=\"f_CodeExample\">TRAPB<\/span> → FaultDispatcher interaction: when TRAPB stalls in the pipeline (via <span class=\"f_CodeExample\">CBox::executeTRAPB<\/span> with <span class=\"f_CodeExample\">slot.mustComplete = true<\/span>), it checks the FLAG_ARITHMETIC_TRAP bit each cycle and releases only when that bit is clear.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">18.9.3 CALL_PAL Serialization<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span class=\"f_CodeExample\">CALL_PAL<\/span> implies full serialization — it acts as the strongest barrier. On CALL_PAL execution, the pipeline is fully drained, all pending events are resolved, and <span class=\"f_CodeExample\">enterPalMode()<\/span> is called with <span class=\"f_CodeExample\">PalEntryReason::CALL_PAL_INSTRUCTION<\/span>. Shadow registers are activated for PAL-mode register access.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">18.9.4 LL\/SC Reservation Clearing<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Reservations are cleared on: exception delivery, PAL mode entry, certain barrier execution, context switches, and pipeline flush. This prevents stale atomic state from persisting across exception boundaries. A <span class=\"f_CodeExample\">STx_C<\/span> that follows an exception delivery will always fail (reservation broken), which is correct — the atomic sequence was interrupted.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: <a href=\"chapter-6_10---trapb---trap-ba.html\" class=\"topiclink\">6.10 TRAPB - Trap Barrier<\/a>; <a href=\"chapter-6_12-interaction-with-.html\" class=\"topiclink\">6.12 Interaction with LL\/SC<\/a>; <a href=\"chapter-7_10-traps-and-trapb.html\" class=\"topiclink\">7.11 Traps and TRAPB<\/a>.<\/span><\/p>\n\r"
})
