hmLoadTopic({
hmKeywords:"",
hmTitle:"16.10 Device Registration and Template System",
hmDescription:"16.10.1 DeviceCatalog  DeviceCatalog (mmio_DeviceCatalog.h, ~130 lines) is the template database for all device types. It stores DeviceTemplate instances keyed by template ID...",
hmPrevLink:"16_9-dma-implementation.html",
hmNextLink:"16_11-architectural-invariants.html",
hmParentLink:"chapter-16---device-model--dma.html",
hmBreadCrumbs:"<a href=\"index.html\">Introduction<\/a> &gt; <a href=\"architecture-overview.html\">Architecture Overview<\/a> &gt; <a href=\"chapter-16---device-model--dma.html\">Chapter 16 – Device Model &amp; DMA<\/a>",
hmTitlePath:"Introduction > Architecture Overview > Chapter 16 – Device Model & DMA > 16.10 Device Registration and Template System",
hmHeader:"<h1 class=\"p_Heading1\" style=\"page-break-after: avoid;\"><span class=\"f_Heading1\">16.10 Device Registration and Template System<\/span><\/h1>\n\r",
hmBody:"<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">16.10.1 DeviceCatalog<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span class=\"f_CodeExample\">DeviceCatalog<\/span> (<span class=\"f_CodeExample\">mmio_DeviceCatalog.h<\/span>, ~130 lines) is the template database for all device types. It stores <span class=\"f_CodeExample\">DeviceTemplate<\/span> instances keyed by template ID (e.g., <span class=\"f_CodeExample\">&quot;qlogic_isp1020&quot;<\/span>), PCI vendor:device ID, or device class. Built-in templates are registered during initialization via <span class=\"f_CodeExample\">initializeBuiltins()<\/span>, which populates templates for SCSI controllers, NICs, UARTs, IDE controllers, bridge devices, and class defaults.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Lookup methods: <span class=\"f_CodeExample\">getTemplate(key)<\/span> for template-ID lookup, <span class=\"f_CodeExample\">lookupByPciId(vendorId, deviceId)<\/span> for PCI enumeration, <span class=\"f_CodeExample\">lookupByPciSubsystemId()<\/span> for subsystem-specific matching, and <span class=\"f_CodeExample\">lookupByClass(cls)<\/span> for device-class defaults. Custom templates can be added via <span class=\"f_CodeExample\">addTemplate()<\/span> for user-configured devices.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">16.10.2 DeviceTemplate<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\"><span class=\"f_CodeExample\">DeviceTemplate<\/span> (<span class=\"f_CodeExample\">mmio_deviceTemplate.h<\/span>, ~208 lines) is the complete specification for a device type. It contains:<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span><span style=\"font-weight: bold;\">Identity and metadata:<\/span> displayName, vendorName, templateId, mmio_DeviceClass, PCI vendorId\/deviceId\/revision\/classCode<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span><span style=\"font-weight: bold;\">Resource requirements:<\/span> <span class=\"f_CodeExample\">QVector&lt;BarTemplate&gt;<\/span> for MMIO windows (base address, size, access attributes), <span class=\"f_CodeExample\">QVector&lt;IrqTemplate&gt;<\/span> for interrupt lines<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span><span style=\"font-weight: bold;\">DMA capabilities:<\/span> dmaMask (32-bit or 64-bit addressing), DMA support flags<\/p>\n\r<p class=\"p_Normal\" style=\"text-indent: 0; padding-left: 0.8125rem; margin-left: 0;\"><span class=\"f_Normal\" style=\"font-family: Arial,\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\';display:inline-block;width:0.8125rem;margin-left:-0.8125rem\">&#8226;<\/span><span style=\"font-weight: bold;\">Defaults:<\/span> IPL level, MSI support, trigger mode (Edge\/Level), routing policy<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Each <span class=\"f_CodeExample\">IrqTemplate<\/span> specifies: IPL level, SCB vector index, trigger mode, routing policy (FixedCPU, RoundRobin, LowestIPL), and affinity CPU. This allows device interrupt behavior to be fully declarative — new devices can be added to the catalog without modifying any interrupt delivery code.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<hr style=\"height:1px; color:#000000; border-width:0; background-color:#000000;\" \/><p class=\"p_Normal\">&nbsp;<\/p>\n\r<h2 class=\"p_Heading2\" style=\"page-break-after: avoid;\"><span class=\"f_Heading2\">16.10.3 Device Attachment Flow<\/span><\/h2>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Device attachment during system initialization follows a four-phase sequence: template lookup from <span class=\"f_CodeExample\">DeviceCatalog<\/span> based on configuration, MMIO region allocation and registration with <span class=\"f_CodeExample\">MMIOManager<\/span> (assigns PA range, sets access policy per <span class=\"f_CodeExample\">BarTemplate<\/span>), IRQ vector registration with the <span class=\"f_CodeExample\">coreLib\/<\/span> IRQ system (assigns vector, IPL, routing policy per <span class=\"f_CodeExample\">IrqTemplate<\/span>), and device <span class=\"f_CodeExample\">initialize()<\/span> call with allocated resources (hoseId, basePA, irqVector, ipl).<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_Normal\">Devices that fail initialization or resource allocation are recorded as degraded via <span class=\"f_CodeExample\">DegradedDeviceEntry<\/span> — the system boots with reduced functionality rather than aborting. This allows partial device configurations to be tested incrementally.<\/p>\n\r<p class=\"p_Normal\">&nbsp;<\/p>\n\r<p class=\"p_SeeAlso\" style=\"page-break-after: avoid;\"><span class=\"f_SeeAlso\">See Also: mmioLib\/mmio_DeviceCatalog.h (~130 lines); mmioLib\/mmio_deviceTemplate.h (~208 lines); coreLib\/mmio_core.h – DegradedDeviceEntry, DegradedDeviceInfo.<\/span><\/p>\n\r"
})
