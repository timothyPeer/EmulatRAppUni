<!DOCTYPE html>
<html>
<head>
   <title>Introduction &gt; Architecture Overview &gt; Chapter 16 – Device Model &amp; DMA &gt; 16.7 Network and Fibre Channel Devices</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta name="description" content="16.7.1 Network Adapter Emulation &nbsp;Network interface emulation presents a PCI NIC to the guest OS with standard MMIO-mapped control registers, a DMA-based packet transmit/receive" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link type="text/css" href="custom.css" rel="stylesheet" />

   <style TYPE="text/css" media="screen"> 
      html, body { margin:0; 
        padding:0; 
        background: #ffffff; 
      } 
      div#printheader { display: none; }
      #idheader { 
        width:100%; 
        min-height: 60px; 
        padding: 0; 
        margin: 0;
        position: fixed;
        top: 0;
        background: #F0F0F0;
        z-index: 2;
      } 
      /* The "min-height" for "#idheader table" ensures that the (blue) header of the topic
         has at least the same height as the header of the navigation panel left of it */
      #idheader table { min-height: 59px;}             
      #idheader h1 span { color: #000000 }     
      #idnav {
        text-align: right;
        width: 126px;
        vertical-align: middle;        
      } 
      #idnav a { text-decoration: none }
      #idnav span {
        display: inline-block;
        width: 24px;
        height: 24px;
        margin-left: 4px;
        background:url('hm_webhelp_buttons_white.png') top left no-repeat;
      } 
      #idnav a span {
        background-image:url('hm_webhelp_buttons_grey.png');
      } 
      #idnav a span:hover {
        background-image:url('hm_webhelp_buttons_yellow.png');
      } 
      #idnav span.hmbtnprev { background-position: 0 -32px }
      #idnav span.hmbtnnext { background-position: -24px -32px }
      #idnav span.hmbtntop  { background-position: -48px -32px }
      #idnav span.hmbtntoggle  { width: 20px; background-position: -70px -32px }
      #idnav span.hmbtnprint  { background-position: -88px -32px }

      #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
      #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
      #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
      #callout-table a {text-decoration: none; color: blue;}
      #callout-table a:visited {text-decoration: none; color: blue;}
      #overview-table a {text-decoration: none; color: black;}
      #overview-table a:visited {text-decoration: none; color: black;}
      #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}       
      p.help-url { margin: 20px 0 5px 0; text-align: center; }
	  p.help-url a:link { font-size: 50%; text-decoration: none; color: black; }
	  p.help-url a:visited { color: black; }
	  p.help-url a:hover { font-size: 95%; text-decoration: underline; }
      #switchtoggles { text-align: right; padding: 0 2px 0 0; font-size: 90%; } 
      .sync-toc { color: #000000; font-size: 8pt; font-weight: bold; display: none; }
      .sync-toc a { color: #000000; text-decoration: none; font-weight: bold;}
      .sync-toc a:visited { color: #000000; }
      .sync-toc a:hover { text-decoration: underline; }
	  a#printbuttonlink { cursor: pointer; }
      a.hmanchor { display: inline-block; margin-top: -4em; padding-top: 4em; }  
   </style>
   <style TYPE="text/css" media="print">
      div#idheader, img.dropdown-toggle-icon, p.help-url { display:none } 
   </style>
   
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "16_7-network-and-fibre-channel.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<div id="printheader"><h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">16.7 Network and Fibre Channel Devices</span></h1>
</div>
<div id="idheader">
<div id="idheaderbg">
<table style="width:100%;border:none;margin:0px;" cellspacing="0" cellpadding="0"> 
  <tr>
    <td class="topichead" style="text-align:left; vertical-align:middle">
      <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="index.html?16_7-network-and-fibre-channel.html" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
      <p class="crumbs"><b>Navigation:</b>&nbsp;
      
      <a href="introduction.html">Introduction</a> &gt; <a href="architecture-overview.html">Architecture Overview</a> &gt; <a href="chapter-16---device-model--dma.html">Chapter 16 – Device Model &amp; DMA</a>&nbsp;&gt;</p>
   
      <h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">16.7 Network and Fibre Channel Devices</span></h1>

    </td>
    <td class="topichead" id="idnav">
      
      <a href="16_6-tape-drive-emulation-and-.html" title="Previous Topic"><span class="hmbtnprev"></span></a>
      <a href="chapter-16---device-model--dma.html" title="Parent Chapter"><span class="hmbtntop"></span></a>
      <a href="16_8-irq-integration-architect.html" title="Next Topic"><span class="hmbtnnext"></span></a>
      
    </td>
  </tr>  
</table>
</div>
</div>  

<div id="idcontent"><div id="innerdiv">
<!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser --> 
<!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->

<!--ZOOMRESTART-->
<h2 class="p_Heading2" style="page-break-after: avoid;"><span class="f_Heading2">16.7.1 Network Adapter Emulation</span></h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Network interface emulation presents a PCI NIC to the guest OS with standard MMIO-mapped control registers, a DMA-based packet transmit/receive path, and interrupt-driven completion. The guest network driver (e.g., <span class="f_CodeExample">de</span> for DEC Tulip-family NICs, <span class="f_CodeExample">tu</span> for TURBOchannel Ethernet) interacts with the emulated NIC through the same register interface it would use on real hardware.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The <span class="f_CodeExample">NetworkManager</span> handles adapter lifecycle, MAC address assignment (from configuration), and the host-side network backend binding. Network I/O operates asynchronously: packet transmit is queued from an MMIO doorbell write and performed by the device's I/O thread; packet receive is driven by the host network backend notifying the device thread, which writes packet data into GuestMemory via DMA and asserts a receive interrupt.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Endianness is a particular concern for network devices. Network protocol headers (Ethernet, IP, TCP/UDP) use big-endian (network byte order), while PCI control registers are little-endian. The NIC emulator must handle both byte orders: DMA packet buffers are transferred in network byte order (the guest driver handles ntohl/ntohs conversion), while register reads and writes use little-endian PCI conventions.</p>
<p class="p_Normal">&nbsp;</p>
<hr style="height:1px; color:#000000; border-width:0; background-color:#000000;" /><p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2" style="page-break-after: avoid;"><span class="f_Heading2">16.7.2 Fibre Channel and FG Storage</span></h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The <span class="f_CodeExample">FibreDeviceManager</span> emulates Fibre Channel HBA controllers that present FC-attached storage LUNs to the guest OS. The FC emulation layer handles FLOGI (fabric login), PLOGI (port login), and PRLI (process login) sequences during guest-side fabric discovery. FCP (Fibre Channel Protocol) commands are the FC equivalent of SCSI CDBs — the guest SCSI driver submits commands through the FC transport, and the HBA translates them into FCP information units.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">FC frame headers are big-endian per the FC-FS specification. The HBA controller emulator handles frame header byte swapping internally, presenting FCP command results through the standard DMA and interrupt path. Backing storage for FC LUNs uses the same RAW partition or file system container strategies described in 16.1.3.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">Implementation Status:</span> The FibreDeviceManager structure and FC port login sequences are scaffolded. FCP command dispatch to backing storage is functional for basic SCSI read/write operations. Extended FC operations (RSCN fabric notifications, LIP loop initialization, multi-path I/O) are not yet implemented.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_SeeAlso" style="page-break-after: avoid;"><span class="f_SeeAlso">See Also: <a href="chapter-10---devices-and-mmio.html" class="topiclink">Chapter 10 – Devices and Memory-Mapped I/O (MMIO) (device model overview)</a>; mmioLib/mmio_DMACoherencyManager.h (~579 lines) – DMA coherency for device data transfers.</span></p>

<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">



function normHeaders() {
 var topicHeadHeight =  $("#idheaderbg > table").first().height() + 1,
	 $topicHeaderBox = $("#idheader"),
	 $topicContentBox = $("#idcontent"),
	 $navHeader = $("#navbar", parent.document),			 
	$navBox = $("div#hmnavframe", parent.document),
	 navHeaderHeight = $navHeader.height();
 if (topicHeadHeight != navHeaderHeight) {
	 $navHeader.css("height",topicHeadHeight + "px");
	 $navBox.css("top", topicHeadHeight + "px");
	 $topicHeaderBox.css("height", topicHeadHeight + "px");
		if ($topicHeaderBox.css("position") == "fixed"){
			$topicContentBox.css("margin-top", topicHeadHeight + "px");
			}
		}
    }
			 
  $(document).ready(function(){
    $(window).on('resize', function() {
      var y = $('#idheader').height(); 
      $('#idcontent').css('margin-top', y);
      var par = window.parent;
      if ($( par ).width() <= $( window ).width()+20) {
        $('#idheader').css('position', 'relative');
        $('#idcontent').css('margin-top', 0);
        $('#idbacktotop').css('display', 'block');
        $('.hmanchor').css('margin-top', -20);
	$('.hmanchor').css('padding-top', 20);
      }
      else {
        $('#idheader').css('position', 'fixed');
        $('#idcontent').css('margin-top', $('#idheader').height());
        $('#idbacktotop').css('display', 'none');
        $('.hmanchor').css('margin-top', -y-20);
		$('.hmanchor').css('padding-top', y+20);
		$("div#hmsplitter", parent.document).css('width', '3px');
      }
	normHeaders();
    });
    
	 $(window).resize(); //trigger event for initially small displays
  });
 

if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) { $('.sync-toc').show();$('p.crumbs').hide();}

</script>
</body>
</html>
