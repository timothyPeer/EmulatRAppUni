<!DOCTYPE html>
<html>
<head>
   <title>Introduction &gt; Appendix &gt; Alpha &gt; Cpu &gt; Barriers &gt; executeMB_WMB</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta name="description" content="// ============================================================================" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link type="text/css" href="custom.css" rel="stylesheet" />

   <style TYPE="text/css" media="screen"> 
      html, body { margin:0; 
        padding:0; 
        background: #ffffff; 
      } 
      div#printheader { display: none; }
      #idheader { 
        width:100%; 
        min-height: 60px; 
        padding: 0; 
        margin: 0;
        position: fixed;
        top: 0;
        background: #2C5D88;
        z-index: 2;
      } 
      /* The "min-height" for "#idheader table" ensures that the (blue) header of the topic
         has at least the same height as the header of the navigation panel left of it */
      #idheader table { min-height: 59px;}             
      #idheader h1 span { color: #FFF }     
      #idnav {
        text-align: right;
        width: 126px;
        vertical-align: middle;        
      } 
      #idnav a { text-decoration: none }
      #idnav span {
        display: inline-block;
        width: 24px;
        height: 24px;
        margin-left: 4px;
        background:url('hm_webhelp_buttons_grey.png') top left no-repeat;
      } 
      #idnav a span {
        background-image:url('hm_webhelp_buttons_white.png');
      } 
      #idnav a span:hover {
        background-image:url('hm_webhelp_buttons_orange.png');
      } 
      #idnav span.hmbtnprev { background-position: 0 -32px }
      #idnav span.hmbtnnext { background-position: -24px -32px }
      #idnav span.hmbtntop  { background-position: -48px -32px }
      #idnav span.hmbtntoggle  { width: 20px; background-position: -70px -32px }
      #idnav span.hmbtnprint  { background-position: -88px -32px }

      #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
      #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
      #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
      #callout-table a {text-decoration: none; color: blue;}
      #callout-table a:visited {text-decoration: none; color: blue;}
      #overview-table a {text-decoration: none; color: black;}
      #overview-table a:visited {text-decoration: none; color: black;}
      #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}       
      p.help-url { margin: 20px 0 5px 0; text-align: center; }
	  p.help-url a:link { font-size: 50%; text-decoration: none; color: black; }
	  p.help-url a:visited { color: black; }
	  p.help-url a:hover { font-size: 95%; text-decoration: underline; }
      #switchtoggles { text-align: right; padding: 0 2px 0 0; font-size: 90%; } 
      .sync-toc { color: #FFF; font-size: 8pt; font-weight: bold; display: none; }
      .sync-toc a { color: #FFF; text-decoration: none; font-weight: bold;}
      .sync-toc a:visited { color: #FFF; }
      .sync-toc a:hover { text-decoration: underline; }
	  a#printbuttonlink { cursor: pointer; }
      a.hmanchor { display: inline-block; margin-top: -4em; padding-top: 4em; }  
   </style>
   <style TYPE="text/css" media="print">
      div#idheader, img.dropdown-toggle-icon, p.help-url { display:none } 
   </style>
   
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "executewmb-barriers.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<div id="printheader"><h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">executeMB_WMB</span></h1>
</div>
<div id="idheader">
<div id="idheaderbg">
<table style="width:100%;border:none;margin:0px;" cellspacing="0" cellpadding="0"> 
  <tr>
    <td class="topichead" style="text-align:left; vertical-align:middle">
      <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="index.html?executewmb-barriers.html" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
      <p class="crumbs"><b>Navigation:</b>&nbsp;
      
      <a href="introduction.html">Introduction</a> &gt; <a href="appendix---trait-examples.html">Appendix</a> &gt; <a href="alpha.html">Alpha</a> &gt; <a href="cpu.html">Cpu</a> &gt; <a href="barriers.html">Barriers</a>&nbsp;&gt;</p>
   
      <h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">executeMB_WMB</span></h1>

    </td>
    <td class="topichead" id="idnav">
      
      <a href="executeexcb-barriers.html" title="Previous Topic"><span class="hmbtnprev"></span></a>
      <a href="barriers.html" title="Parent Chapter"><span class="hmbtntop"></span></a>
      <a href="managers.html" title="Next Topic"><span class="hmbtnnext"></span></a>
      
    </td>
  </tr>  
</table>
</div>
</div>  

<div id="idcontent"><div id="innerdiv">
<!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser --> 
<!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->

<!--ZOOMRESTART-->
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">// WMB (Write Memory Barrier) - Complete Documentation with Alpha Assembly</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">// SerializationType::Barrier_WRITE</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">PURPOSE:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WMB is a WRITE-ONLY memory barrier that enforces ordering of STORE operations.</p>
<p class="p_Normal">Loads can bypass WMB, but stores cannot. This provides ordering guarantees for writes while allowing reads to proceed, improving performance vs full MB.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">ALPHA ARCHITECTURE:</p>
<p class="p_Normal">===================</p>
<p class="p_Normal">&quot;WMB guarantees that all store operations before the WMB are performed before any store operations after the WMB&quot; - Alpha Architecture Handbook</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WMB orders:</p>
<p class="p_Normal"> &nbsp;✓ Store → Store &nbsp;(write after write)</p>
<p class="p_Normal"> &nbsp;✗ Load &nbsp;→ Load &nbsp; (reads can reorder - NOT ordered by WMB)</p>
<p class="p_Normal"> &nbsp;✗ Load &nbsp;→ Store &nbsp;(NOT ordered by WMB)</p>
<p class="p_Normal"> &nbsp;✗ Store → Load &nbsp; (reads can bypass - NOT ordered by WMB)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WHEN TO USE:</p>
<p class="p_Normal">============</p>
<p class="p_Normal">1. Write buffer flushing</p>
<p class="p_Normal">2. Multiple stores that must complete in order</p>
<p class="p_Normal">3. Write-only synchronization (producer updating shared data)</p>
<p class="p_Normal">4. Performance optimization when reads don't need ordering</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">/ ============================================================================</p>
<p class="p_Normal">// EXAMPLE 1: Lock Implementation (Critical Use Case)</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">SCENARIO: Spinlock acquisition in SMP system</p>
<p class="p_Normal">=============================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Without MB, the CPU might reorder memory operations, breaking the lock!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Alpha Assembly Code (CORRECT with MB):</p>
<p class="p_Normal">---------------------------------------</p>
<p class="p_CodeExample"><span class="f_CodeExample">acquire_lock:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x1000:&nbsp;&nbsp;LDQ_L&nbsp;&nbsp;R1,&nbsp;lock_var&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Load-locked&nbsp;the&nbsp;lock</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x1004:&nbsp;&nbsp;BNE&nbsp;&nbsp;&nbsp;&nbsp;R1,&nbsp;acquire_lock&nbsp;;&nbsp;If&nbsp;locked,&nbsp;retry</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x1008:&nbsp;&nbsp;MOV&nbsp;&nbsp;&nbsp;&nbsp;1,&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Value&nbsp;to&nbsp;store&nbsp;(locked=1)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x100C:&nbsp;&nbsp;STQ_C&nbsp;&nbsp;R2,&nbsp;lock_var&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Store-conditional&nbsp;(acquire&nbsp;lock)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x1010:&nbsp;&nbsp;BEQ&nbsp;&nbsp;&nbsp;&nbsp;R2,&nbsp;acquire_lock&nbsp;;&nbsp;If&nbsp;failed,&nbsp;retry</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x1014:&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;MEMORY&nbsp;BARRIER&nbsp;-&nbsp;Critical!</span></p>
<p class="p_Normal"> &nbsp; &nbsp;</p>
<p class="p_CodeExample">&nbsp;&nbsp;<span class="f_CodeExample">&nbsp;&nbsp;;&nbsp;Now&nbsp;safe&nbsp;to&nbsp;access&nbsp;protected&nbsp;data:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x1018:&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;&nbsp;R3,&nbsp;shared_data&nbsp;&nbsp;;&nbsp;Read&nbsp;protected&nbsp;data</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x101C:&nbsp;&nbsp;ADDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;1,&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Modify&nbsp;it</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x1020:&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;&nbsp;R3,&nbsp;shared_data&nbsp;&nbsp;;&nbsp;Write&nbsp;it&nbsp;back</span></p>
<p class="p_Normal"> &nbsp; &nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample">release_lock:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x1024:&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;MEMORY&nbsp;BARRIER&nbsp;before&nbsp;release</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;0x1028:&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;&nbsp;R31,&nbsp;lock_var&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Release&nbsp;lock&nbsp;(store&nbsp;0)</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WHY MB IS CRITICAL:</p>
<p class="p_Normal">===================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WITHOUT MB after lock acquisition:</p>
<p class="p_Normal"> &nbsp;CPU might reorder: &quot;LDQ R3, shared_data&quot; BEFORE &quot;STQ_C R2, lock_var&quot;</p>
<p class="p_Normal"> &nbsp;Result: Reading shared_data BEFORE actually acquiring the lock!</p>
<p class="p_Normal"> &nbsp;Race condition: Two CPUs might read/modify simultaneously!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WITHOUT MB before lock release:</p>
<p class="p_Normal"> &nbsp;CPU might reorder: &quot;STQ R31, lock_var&quot; BEFORE &quot;STQ R3, shared_data&quot;</p>
<p class="p_Normal"> &nbsp;Result: Releasing lock BEFORE finishing write to shared_data!</p>
<p class="p_Normal"> &nbsp;Race condition: Another CPU might see partial update!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WITH MB:</p>
<p class="p_Normal"> &nbsp;Lock acquisition completes → MB → Memory accesses in protected region</p>
<p class="p_Normal"> &nbsp;Memory accesses complete → MB → Lock release</p>
<p class="p_Normal"> &nbsp;GUARANTEED correct synchronization!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">// CYCLE-BY-CYCLE PIPELINE FLOW FOR MB</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Scenario: Lock acquisition followed by protected memory access</p>
<p class="p_Normal">===============================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Alpha Assembly:</p>
<p class="p_Normal">---------------</p>
<p class="p_CodeExample"><span class="f_CodeExample">0x100C:&nbsp;&nbsp;STQ_C&nbsp;&nbsp;R2,&nbsp;lock_var&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Acquire&nbsp;lock&nbsp;(store-conditional)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">0x1010:&nbsp;&nbsp;BEQ&nbsp;&nbsp;&nbsp;&nbsp;R2,&nbsp;acquire_lock&nbsp;;&nbsp;Check&nbsp;if&nbsp;succeeded</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">0x1014:&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Memory&nbsp;barrier</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">0x1018:&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;&nbsp;R3,&nbsp;shared_data&nbsp;&nbsp;;&nbsp;Load&nbsp;protected&nbsp;data</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">0x101C:&nbsp;&nbsp;ADDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;1,&nbsp;R4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Increment</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">0x1020:&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;&nbsp;R4,&nbsp;shared_data&nbsp;&nbsp;;&nbsp;Store&nbsp;back</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">CYCLE&nbsp;0-3:&nbsp;Pipeline&nbsp;Filling&nbsp;(STQ_C&nbsp;enters)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">CYCLE&nbsp;3:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">-------|-----------|-----------|-----------|-----------|-----------|----------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Inst:&nbsp;&nbsp;|&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;STQ_C&nbsp;R2&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x1010)&nbsp;&nbsp;|&nbsp;(0x100C)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">CYCLE&nbsp;4:&nbsp;STQ_C&nbsp;executes,&nbsp;MB&nbsp;enters&nbsp;Decode</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">-------|-----------|-----------|-----------|-----------|-----------|----------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Inst:&nbsp;&nbsp;|&nbsp;LDQ&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;STQ_C&nbsp;R2&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1018)&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x1010)&nbsp;&nbsp;|&nbsp;(0x100C)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;^^^^^^^^^&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Store&nbsp;executes&nbsp;-&nbsp;begins&nbsp;write</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">CYCLE&nbsp;5:&nbsp;MB&nbsp;reaches&nbsp;Execute&nbsp;stage&nbsp;-&nbsp;SETS&nbsp;BARRIER&nbsp;FLAGS</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">-------|-----------|-----------|-----------|-----------|-----------|----------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Inst:&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3&nbsp;&nbsp;&nbsp;|&nbsp;LDQ&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;STQ_C&nbsp;R2&nbsp;&nbsp;|&nbsp;[empty]</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x101C)&nbsp;&nbsp;|&nbsp;(0x1018)&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x1010)&nbsp;&nbsp;|&nbsp;(0x100C)&nbsp;&nbsp;|</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;^^^^^^^^^&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;^^^^^^^^^&nbsp;|</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;EXECUTES:&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Writing&nbsp;to&nbsp;memory</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;stalled=true</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;serializeType=Barrier_MB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;MB&nbsp;sets&nbsp;stall&nbsp;-&nbsp;pipeline&nbsp;STOPS&nbsp;FETCHING</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;isFrontendStalled()&nbsp;=&nbsp;TRUE</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">CYCLE&nbsp;6:&nbsp;Pipeline&nbsp;draining&nbsp;-&nbsp;MB&nbsp;stalled,&nbsp;waiting&nbsp;for&nbsp;STQ_C&nbsp;to&nbsp;complete</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">-------|-----------|-----------|-----------|-----------|-----------|----------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Inst:&nbsp;&nbsp;|&nbsp;[STALL]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3&nbsp;&nbsp;&nbsp;|&nbsp;MB*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;STQ_C&nbsp;R2</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x101C)&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x1010)&nbsp;&nbsp;|&nbsp;(0x100C)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(STALLED)&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;^^^^^^^^</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Completing&nbsp;write</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;checkBarrierRelease(slot)&nbsp;checks:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;Prior&nbsp;stages&nbsp;(0-2):&nbsp;ADDQ&nbsp;is&nbsp;in&nbsp;Issue&nbsp;stage&nbsp;(stage&nbsp;2)&nbsp;-&nbsp;NOT&nbsp;CLEAR</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;Write&nbsp;buffers:&nbsp;STQ_C&nbsp;still&nbsp;completing&nbsp;-&nbsp;NOT&nbsp;DRAINED</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;→&nbsp;STAY&nbsp;STALLED</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">CYCLE&nbsp;7:&nbsp;Still&nbsp;draining&nbsp;-&nbsp;waiting&nbsp;for&nbsp;write&nbsp;to&nbsp;complete</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">-------|-----------|-----------|-----------|-----------|-----------|----------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Inst:&nbsp;&nbsp;|&nbsp;[STALL]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;MB*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3&nbsp;&nbsp;&nbsp;|&nbsp;BEQ&nbsp;R2</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;(0x101C)&nbsp;&nbsp;|&nbsp;(0x1010)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(STALLED)&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;checkBarrierRelease(slot)&nbsp;checks:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;Prior&nbsp;stages&nbsp;(0-2):&nbsp;All&nbsp;empty&nbsp;now&nbsp;-&nbsp;CLEAR&nbsp;✓</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;Write&nbsp;buffers:&nbsp;Checking&nbsp;CBox&nbsp;write&nbsp;buffer&nbsp;status</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;hasPendingMMIO():&nbsp;STQ_C&nbsp;write&nbsp;still&nbsp;buffered&nbsp;-&nbsp;NOT&nbsp;DRAINED</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;→&nbsp;STAY&nbsp;STALLED</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">CYCLE&nbsp;8:&nbsp;Write&nbsp;buffer&nbsp;drained&nbsp;-&nbsp;MB&nbsp;can&nbsp;release</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">-------|-----------|-----------|-----------|-----------|-----------|----------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Inst:&nbsp;&nbsp;|&nbsp;[STALL]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;MB*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x101C)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(STALLED)&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;checkBarrierRelease(slot)&nbsp;checks:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;✓&nbsp;Prior&nbsp;stages&nbsp;(0-2):&nbsp;All&nbsp;empty&nbsp;-&nbsp;CLEAR</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;✓&nbsp;Write&nbsp;buffers:&nbsp;STQ_C&nbsp;write&nbsp;committed&nbsp;to&nbsp;memory&nbsp;-&nbsp;DRAINED</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;✓&nbsp;Memory&nbsp;quiescent:&nbsp;No&nbsp;pending&nbsp;memory&nbsp;ops</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;&nbsp;&nbsp;→&nbsp;RELEASE:&nbsp;stalled&nbsp;=&nbsp;false</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">CYCLE&nbsp;9:&nbsp;MB&nbsp;released&nbsp;-&nbsp;advances&nbsp;to&nbsp;MEM,&nbsp;fetch&nbsp;resumes</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">================================================================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">-------|-----------|-----------|-----------|-----------|-----------|----------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Inst:&nbsp;&nbsp;|&nbsp;LDQ&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[empty]</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1018)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)&nbsp;&nbsp;|</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;MB&nbsp;advances&nbsp;to&nbsp;MEM&nbsp;(no-op&nbsp;for&nbsp;MB)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;isFrontendStalled()&nbsp;=&nbsp;FALSE</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">//&nbsp;Fetch&nbsp;resumes&nbsp;-&nbsp;LDQ&nbsp;R3&nbsp;(protected&nbsp;data&nbsp;read)&nbsp;is&nbsp;fetched</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">CRITICAL GUARANTEE:</p>
<p class="p_Normal">===================</p>
<p class="p_Normal">LDQ R3 (reading shared_data) CANNOT execute until AFTER STQ_C (lock acquisition)</p>
<p class="p_Normal">completes and its write is globally visible. This ensures correct synchronization!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">================================================================================</p>
<p class="p_Normal">CYCLE 10: MB completes, protected data read begins</p>
<p class="p_Normal">================================================================================</p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Stage:&nbsp;|&nbsp;Fetch&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Decode&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Issue&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;Execute&nbsp;&nbsp;&nbsp;|&nbsp;MEM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;WB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">-------|-----------|-----------|-----------|-----------|-----------|----------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Inst:&nbsp;&nbsp;|&nbsp;STQ&nbsp;R4&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;ADDQ&nbsp;R3&nbsp;&nbsp;&nbsp;|&nbsp;LDQ&nbsp;R3&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;[empty]&nbsp;&nbsp;&nbsp;|&nbsp;MB</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1020)&nbsp;&nbsp;|&nbsp;(0x101C)&nbsp;&nbsp;|&nbsp;(0x1018)&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;(0x1014)</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">// MB completes writeback</p>
<p class="p_Normal">// LDQ R3 proceeds normally - lock is guaranteed acquired</p>
<p class="p_Normal">// All memory operations properly ordered!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">// EXAMPLE 2: Producer-Consumer Queue (Classic Use Case)</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">SCENARIO: Thread-safe message passing between CPUs</p>
<p class="p_Normal">===================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample">Producer&nbsp;CPU&nbsp;writes&nbsp;data,&nbsp;then&nbsp;sets&nbsp;flag:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">------------------------------------------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R1,&nbsp;data_buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Write&nbsp;data</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Ensure&nbsp;data&nbsp;written</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R31,&nbsp;ready_flag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Set&nbsp;flag&nbsp;(data&nbsp;ready)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Consumer&nbsp;CPU&nbsp;checks&nbsp;flag,&nbsp;then&nbsp;reads&nbsp;data:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">-------------------------------------------</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">spin_wait:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R2,&nbsp;ready_flag&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Check&nbsp;flag</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;BEQ&nbsp;&nbsp;&nbsp;R2,&nbsp;spin_wait&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Wait&nbsp;until&nbsp;ready</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Ensure&nbsp;flag&nbsp;read</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;data_buffer&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Read&nbsp;data&nbsp;(now&nbsp;safe!)</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WHY MB IS CRITICAL:</p>
<p class="p_Normal">===================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WITHOUT MB in producer:</p>
<p class="p_Normal"> &nbsp;CPU might reorder: &quot;STQ R31, ready_flag&quot; BEFORE &quot;STQ R1, data_buffer&quot;</p>
<p class="p_Normal"> &nbsp;Consumer sees flag set, reads data_buffer before it's written!</p>
<p class="p_Normal"> &nbsp;Result: GARBAGE DATA!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WITHOUT MB in consumer:</p>
<p class="p_Normal"> &nbsp;CPU might reorder: &quot;LDQ R3, data_buffer&quot; BEFORE &quot;LDQ R2, ready_flag&quot;</p>
<p class="p_Normal"> &nbsp;Reads old data before producer updates it!</p>
<p class="p_Normal"> &nbsp;Result: STALE DATA!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WITH MB:</p>
<p class="p_Normal"> &nbsp;Producer: Data write completes → MB → Flag set</p>
<p class="p_Normal"> &nbsp;Consumer: Flag read completes → MB → Data read</p>
<p class="p_Normal"> &nbsp;GUARANTEED: Consumer never reads data before producer writes it!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">// EXAMPLE 3: Memory-Mapped I/O (Device Registers)</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample">SCENARIO:&nbsp;Writing&nbsp;to&nbsp;DMA&nbsp;controller&nbsp;registers</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">==============================================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R1,&nbsp;dma_addr_reg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Set&nbsp;DMA&nbsp;source&nbsp;address</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R2,&nbsp;dma_count_reg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Set&nbsp;transfer&nbsp;count</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Ensure&nbsp;registers&nbsp;written&nbsp;IN&nbsp;ORDER</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R3,&nbsp;dma_start_reg&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Start&nbsp;DMA&nbsp;(must&nbsp;be&nbsp;last!)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_Normal">WHY MB IS CRITICAL:</p>
<p class="p_Normal">===================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WITHOUT MB:</p>
<p class="p_Normal"> &nbsp;CPU might reorder stores to MMIO registers</p>
<p class="p_Normal"> &nbsp;dma_start_reg might be written BEFORE dma_addr_reg/dma_count_reg</p>
<p class="p_Normal"> &nbsp;DMA starts with GARBAGE address/count!</p>
<p class="p_Normal"> &nbsp;Result: System crash, data corruption, hardware damage!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">WITH MB:</p>
<p class="p_Normal"> &nbsp;Address/count registers written first → MB → Start register written last</p>
<p class="p_Normal"> &nbsp;GUARANTEED: DMA gets correct parameters before starting!</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">// MB vs WMB Comparison</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">MB (Memory Barrier):</p>
<p class="p_Normal">====================</p>
<p class="p_Normal">Orders: &nbsp;ALL memory operations (loads AND stores)</p>
<p class="p_Normal">Waits: &nbsp; All prior loads AND stores complete</p>
<p class="p_Normal">Allows: &nbsp;Nothing to bypass (full fence)</p>
<p class="p_Normal">Use: &nbsp; &nbsp; Synchronization, locks, MMIO sequences</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample">Example:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R1,&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Load</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R2,&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Store</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;MB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Both&nbsp;load&nbsp;AND&nbsp;store&nbsp;must&nbsp;complete</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;load&nbsp;waits&nbsp;for&nbsp;both&nbsp;above</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R4,&nbsp;w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;store&nbsp;waits&nbsp;for&nbsp;both&nbsp;above</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample">WMB&nbsp;(Write&nbsp;Memory&nbsp;Barrier):</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">===========================</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Orders:&nbsp;&nbsp;Only&nbsp;STORES&nbsp;(loads&nbsp;can&nbsp;bypass)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Waits:&nbsp;&nbsp;&nbsp;All&nbsp;prior&nbsp;stores&nbsp;complete</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Allows:&nbsp;&nbsp;Loads&nbsp;to&nbsp;bypass&nbsp;(performance&nbsp;optimization)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Use:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Write-only&nbsp;synchronization,&nbsp;write&nbsp;buffers</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_Normal">Example:</p>
<p class="p_CodeExample">&nbsp;&nbsp;<span class="f_CodeExample">&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R1,&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Store&nbsp;1</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R2,&nbsp;y&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;Store&nbsp;2</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;WMB&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;←&nbsp;Both&nbsp;stores&nbsp;must&nbsp;complete</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;LDQ&nbsp;&nbsp;&nbsp;R3,&nbsp;z&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;load&nbsp;can&nbsp;START&nbsp;before&nbsp;WMB&nbsp;completes!</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;&nbsp;&nbsp;STQ&nbsp;&nbsp;&nbsp;R4,&nbsp;w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;This&nbsp;store&nbsp;waits&nbsp;for&nbsp;stores&nbsp;above</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">KEY DIFFERENCE:</p>
<p class="p_Normal">===============</p>
<p class="p_Normal">MB: &nbsp;Stalls EVERYTHING (loads + stores)</p>
<p class="p_Normal">WMB: Stalls only stores (loads can proceed)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">USE MB when: &nbsp;Synchronizing both reads and writes</p>
<p class="p_Normal">USE WMB when: Only need to order writes (performance win!)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">// Release Conditions for MB</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">MB can be released when ALL of these are true:</p>
<p class="p_Normal">===============================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">1. All PRIOR pipeline stages are empty/invalid</p>
<p class="p_Normal"> &nbsp; → No instructions before MB are in-flight</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">2. All write buffers are drained</p>
<p class="p_Normal"> &nbsp; → hasPendingMMIO() returns false</p>
<p class="p_Normal"> &nbsp; → All buffered stores committed to memory</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">3. All pending memory operations complete</p>
<p class="p_Normal"> &nbsp; → No loads/stores in MEM stage before MB</p>
<p class="p_Normal"> &nbsp; → Memory subsystem quiescent</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">4. For SMP systems: Global memory barrier acknowledged</p>
<p class="p_Normal"> &nbsp; → Other CPUs have reached synchronization point</p>
<p class="p_Normal"> &nbsp; → Memory order visible across all CPUs</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Stall Duration:</p>
<p class="p_Normal">===============</p>
<p class="p_Normal">Minimum: ~3-5 cycles (pipeline drain time)</p>
<p class="p_Normal">Typical: ~5-10 cycles (including write buffer drain)</p>
<p class="p_Normal">Maximum: Varies (depends on memory latency, SMP coordination)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">For lock acquisition:</p>
<p class="p_Normal"> &nbsp;~5-8 cycles typical (local memory)</p>
<p class="p_Normal"> &nbsp;~20-50 cycles if waiting for remote CPU caches (SMP)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">For MMIO:</p>
<p class="p_Normal"> &nbsp;~10-100 cycles (depends on device response time)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">// Implementation Summary for MB</p>
<p class="p_Normal">// ============================================================================</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">In CBox::executeMB(PipelineSlot&amp; slot):</p>
<p class="p_Normal">=======================================</p>
<p class="p_Normal">1. Drain write buffers</p>
<p class="p_Normal">2. Execute platform memory barrier</p>
<p class="p_Normal">3. SMP coordination (if multiprocessor)</p>
<p class="p_Normal">4. Set: stalled=true, serializeType=Barrier_MB</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">In AlphaPipeline::checkBarrierRelease(slot):</p>
<p class="p_Normal">=============================================</p>
<p class="p_Normal">1. Check prior stages clear</p>
<p class="p_Normal">2. Check write buffers drained</p>
<p class="p_Normal">3. Check memory operations complete</p>
<p class="p_Normal">4. If all true → stalled=false</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Result:</p>
<p class="p_Normal">=======</p>
<p class="p_Normal">Lock acquisition works correctly</p>
<p class="p_Normal">Producer-consumer queues work correctly</p>
<p class="p_Normal">MMIO sequences execute in order</p>
<p class="p_Normal">SMP synchronization is guaranteed</p>
<p class="p_Normal">&nbsp;</p>

<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">




function normHeaders() {
 var topicHeadHeight =  $("#idheaderbg > table").first().height() + 1,
	 $topicHeaderBox = $("#idheader"),
	 $topicContentBox = $("#idcontent"),
	 $navHeader = $("#navbar", parent.document),			 
	$navBox = $("div#hmnavframe", parent.document),
	 navHeaderHeight = $navHeader.height();
 if (topicHeadHeight != navHeaderHeight) {
	 $navHeader.css("height",topicHeadHeight + "px");
	 $navBox.css("top", topicHeadHeight + "px");
	 $topicHeaderBox.css("height", topicHeadHeight + "px");
		if ($topicHeaderBox.css("position") == "fixed"){
			$topicContentBox.css("margin-top", topicHeadHeight + "px");
			}
		}
    }
			 
  $(document).ready(function(){
    $(window).on('resize', function() {
      var y = $('#idheader').height(); 
      $('#idcontent').css('margin-top', y);
      var par = window.parent;
      if ($( par ).width() <= $( window ).width()+20) {
        $('#idheader').css('position', 'relative');
        $('#idcontent').css('margin-top', 0);
        $('#idbacktotop').css('display', 'block');
        $('.hmanchor').css('margin-top', -20);
	$('.hmanchor').css('padding-top', 20);
      }
      else {
        $('#idheader').css('position', 'fixed');
        $('#idcontent').css('margin-top', $('#idheader').height());
        $('#idbacktotop').css('display', 'none');
        $('.hmanchor').css('margin-top', -y-20);
		$('.hmanchor').css('padding-top', y+20);
		$("div#hmsplitter", parent.document).css('width', '3px');
      }
	normHeaders();
    });
    
	 $(window).resize(); //trigger event for initially small displays
  });
 

if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) { $('.sync-toc').show();$('p.crumbs').hide();}

</script>
</body>
</html>
