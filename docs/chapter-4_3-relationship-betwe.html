<!DOCTYPE html>
<html>
<head>
   <title>Introduction &gt; Architecture Overview &gt; Chapter 4 - Functional Execution Domains (&quot;Boxes) &gt; 4.3 Execution Flow: Grains, Pipeline, and Boxes</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta name="description" content="4.3.1 Execution Flow Summary &nbsp;Execution always follows this pattern: Instruction is decoded into a Grain by IBox (via GrainResolver) Grain enters the pipeline, populating a Pip" />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link type="text/css" href="custom.css" rel="stylesheet" />

   <style TYPE="text/css" media="screen"> 
      html, body { margin:0; 
        padding:0; 
        background: #ffffff; 
      } 
      div#printheader { display: none; }
      #idheader { 
        width:100%; 
        min-height: 60px; 
        padding: 0; 
        margin: 0;
        position: fixed;
        top: 0;
        background: #2C5D88;
        z-index: 2;
      } 
      /* The "min-height" for "#idheader table" ensures that the (blue) header of the topic
         has at least the same height as the header of the navigation panel left of it */
      #idheader table { min-height: 59px;}             
      #idheader h1 span { color: #FFF }     
      #idnav {
        text-align: right;
        width: 126px;
        vertical-align: middle;        
      } 
      #idnav a { text-decoration: none }
      #idnav span {
        display: inline-block;
        width: 24px;
        height: 24px;
        margin-left: 4px;
        background:url('hm_webhelp_buttons_grey.png') top left no-repeat;
      } 
      #idnav a span {
        background-image:url('hm_webhelp_buttons_white.png');
      } 
      #idnav a span:hover {
        background-image:url('hm_webhelp_buttons_orange.png');
      } 
      #idnav span.hmbtnprev { background-position: 0 -32px }
      #idnav span.hmbtnnext { background-position: -24px -32px }
      #idnav span.hmbtntop  { background-position: -48px -32px }
      #idnav span.hmbtntoggle  { width: 20px; background-position: -70px -32px }
      #idnav span.hmbtnprint  { background-position: -88px -32px }

      #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
      #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
      #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
      #callout-table a {text-decoration: none; color: blue;}
      #callout-table a:visited {text-decoration: none; color: blue;}
      #overview-table a {text-decoration: none; color: black;}
      #overview-table a:visited {text-decoration: none; color: black;}
      #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}       
      p.help-url { margin: 20px 0 5px 0; text-align: center; }
	  p.help-url a:link { font-size: 50%; text-decoration: none; color: black; }
	  p.help-url a:visited { color: black; }
	  p.help-url a:hover { font-size: 95%; text-decoration: underline; }
      #switchtoggles { text-align: right; padding: 0 2px 0 0; font-size: 90%; } 
      .sync-toc { color: #FFF; font-size: 8pt; font-weight: bold; display: none; }
      .sync-toc a { color: #FFF; text-decoration: none; font-weight: bold;}
      .sync-toc a:visited { color: #FFF; }
      .sync-toc a:hover { text-decoration: underline; }
	  a#printbuttonlink { cursor: pointer; }
      a.hmanchor { display: inline-block; margin-top: -4em; padding-top: 4em; }  
   </style>
   <style TYPE="text/css" media="print">
      div#idheader, img.dropdown-toggle-icon, p.help-url { display:none } 
   </style>
   
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "chapter-4_3-relationship-betwe.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<div id="printheader"><h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">4.3 Execution Flow: Grains, Pipeline, and Boxes</span></h1>
</div>
<div id="idheader">
<div id="idheaderbg">
<table style="width:100%;border:none;margin:0px;" cellspacing="0" cellpadding="0"> 
  <tr>
    <td class="topichead" style="text-align:left; vertical-align:middle">
      <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="index.html?chapter-4_3-relationship-betwe.html" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
      <p class="crumbs"><b>Navigation:</b>&nbsp;
      
      <a href="introduction.html">Introduction</a> &gt; <a href="architecture-overview.html">Architecture Overview</a> &gt; <a href="chapter-4---functionexecution-.html">Chapter 4 - Functional Execution Domains (&quot;Boxes)</a>&nbsp;&gt;</p>
   
      <h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">4.3 Execution Flow: Grains, Pipeline, and Boxes</span></h1>

    </td>
    <td class="topichead" id="idnav">
      
      <a href="chapter-4_2-box-based-executio.html" title="Previous Topic"><span class="hmbtnprev"></span></a>
      <a href="chapter-4---functionexecution-.html" title="Parent Chapter"><span class="hmbtntop"></span></a>
      <a href="chapter-4_4-ibox---instruction.html" title="Next Topic"><span class="hmbtnnext"></span></a>
      
    </td>
  </tr>  
</table>
</div>
</div>  

<div id="idcontent"><div id="innerdiv">
<!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser --> 
<!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->

<!--ZOOMRESTART-->
<h2 class="p_Heading2" style="page-break-after: avoid;"><span class="f_Heading2">4.3.1 Execution Flow Summary</span></h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Execution always follows this pattern:</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>Instruction is decoded into a Grain by IBox (via GrainResolver)</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>Grain enters the pipeline, populating a PipelineSlot</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">3.</span>In the Execute (EX) stage, the grain's execute() method runs</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">4.</span>The grain dispatches work to one or more Boxes</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">5.</span>Boxes perform architectural actions synchronously, writing results into the slot</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">6.</span>Results flow through MEM (deferred register commit) to WB (store commit, retirement)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Boxes never call the pipeline and never call other Boxes directly unless explicitly allowed by the interaction rules.</p>
<p class="p_Normal">&nbsp;</p>
<hr style="height:1px; color:#000000; border-width:0; background-color:#000000;" /><p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2" style="page-break-after: avoid;"><span class="f_Heading2">4.3.2 Box Routing</span></h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Each PipelineSlot carries pointers to all five Boxes (m_eBox, m_fBox, m_mBox, m_palBox, m_cBox), injected once during pipeline initialization. The Decode stage (DE) classifies each instruction into its target Box via executionBoxDecoder(opCode), setting the slot's execUnit field. This routing determines which Box the grain's execute() method will call.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The six Box types and their ExecUnit identifiers:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">IBox (ExecUnit::IBOX) — Instruction frontend only, never called during EX</p>
<p class="p_Normal">EBox (ExecUnit::EBOX) — Integer and control-flow execution</p>
<p class="p_Normal">FBox (ExecUnit::FBOX) — Floating-point execution</p>
<p class="p_Normal">MBox (ExecUnit::MBOX) — Memory access execution</p>
<p class="p_Normal">CBox (ExecUnit::CBOX) — Serialization and coherency</p>
<p class="p_Normal">PalBox (ExecUnit::PALBOX) — Privileged execution</p>
<p class="p_Normal">&nbsp;</p>
<hr style="height:1px; color:#000000; border-width:0; background-color:#000000;" /><p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2" style="page-break-after: avoid;"><span class="f_Heading2">4.3.3 Execution Flow Example: LDQ R1, 0(R2)</span></h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample">IBox:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Fetch&nbsp;instruction&nbsp;at&nbsp;current&nbsp;PC</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Decode&nbsp;raw&nbsp;bits&nbsp;→&nbsp;GrainResolver&nbsp;resolves&nbsp;to&nbsp;LDQ&nbsp;grain</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Cache&nbsp;grain&nbsp;in&nbsp;InstructionGrainRegistry</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Pipeline&nbsp;EX&nbsp;(grain-&gt;execute()):</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;→&nbsp;MBox::executeLDQ(slot)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Calculate&nbsp;EA:&nbsp;slot.va&nbsp;=&nbsp;Rb&nbsp;+&nbsp;SEXT(disp)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Check&nbsp;alignment&nbsp;(8-byte&nbsp;for&nbsp;LDQ)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Translate&nbsp;VA&nbsp;→&nbsp;PA&nbsp;via&nbsp;Ev6Translator&nbsp;(DTB&nbsp;lookup)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Read&nbsp;from&nbsp;GuestMemory:&nbsp;m_guestMemory-&gt;read64(pa)</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Store&nbsp;result:&nbsp;slot.payLoad&nbsp;=&nbsp;data</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Set:&nbsp;slot.needsWriteback&nbsp;=&nbsp;true</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Pipeline&nbsp;MEM:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;commitPending()&nbsp;writes&nbsp;previous&nbsp;cycle's&nbsp;result&nbsp;to&nbsp;register&nbsp;file</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">Pipeline&nbsp;WB:</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Register&nbsp;R1&nbsp;updated&nbsp;with&nbsp;slot.payLoad</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;-&nbsp;Instruction&nbsp;retired</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">No other Box participates. EBox is not involved because MBox handles the entire load operation including address calculation.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_SeeAlso" style="page-break-after: avoid;"><span class="f_SeeAlso">See Also: <a href="chapter-3_7-execute-stage-(ex).html" class="topiclink">3.7 Execute Stage (EX)</a>; <a href="3_16-grain-system-chapter3.html" class="topiclink">3.16 Grain System</a>.</span></p>

<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">




function normHeaders() {
 var topicHeadHeight =  $("#idheaderbg > table").first().height() + 1,
	 $topicHeaderBox = $("#idheader"),
	 $topicContentBox = $("#idcontent"),
	 $navHeader = $("#navbar", parent.document),			 
	$navBox = $("div#hmnavframe", parent.document),
	 navHeaderHeight = $navHeader.height();
 if (topicHeadHeight != navHeaderHeight) {
	 $navHeader.css("height",topicHeadHeight + "px");
	 $navBox.css("top", topicHeadHeight + "px");
	 $topicHeaderBox.css("height", topicHeadHeight + "px");
		if ($topicHeaderBox.css("position") == "fixed"){
			$topicContentBox.css("margin-top", topicHeadHeight + "px");
			}
		}
    }
			 
  $(document).ready(function(){
    $(window).on('resize', function() {
      var y = $('#idheader').height(); 
      $('#idcontent').css('margin-top', y);
      var par = window.parent;
      if ($( par ).width() <= $( window ).width()+20) {
        $('#idheader').css('position', 'relative');
        $('#idcontent').css('margin-top', 0);
        $('#idbacktotop').css('display', 'block');
        $('.hmanchor').css('margin-top', -20);
	$('.hmanchor').css('padding-top', 20);
      }
      else {
        $('#idheader').css('position', 'fixed');
        $('#idcontent').css('margin-top', $('#idheader').height());
        $('#idbacktotop').css('display', 'none');
        $('.hmanchor').css('margin-top', -y-20);
		$('.hmanchor').css('padding-top', y+20);
		$("div#hmsplitter", parent.document).css('width', '3px');
      }
	normHeaders();
    });
    
	 $(window).resize(); //trigger event for initially small displays
  });
 

if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) { $('.sync-toc').show();$('p.crumbs').hide();}

</script>
</body>
</html>
