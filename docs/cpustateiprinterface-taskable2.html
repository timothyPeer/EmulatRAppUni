<!DOCTYPE html>
<html>
<head>
   <title>Introduction &gt; Appendix &gt; Taskables &gt; CPUStateIPRInterface taskables</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />   
   <meta http-equiv="X-UA-Compatible" content="IE=edge" />
   <meta name="generator" content="Help &amp; Manual" />
   <meta name="keywords" content="" />
   <meta name="description" content="Here’s the matching **System Side-Effect Checklist** for `CPUStateIPRInterface`, in the same style as the one we just did for `EV6_Hooks`." />
   <link type="text/css" href="default.css" rel="stylesheet" />
   <link type="text/css" href="custom.css" rel="stylesheet" />

   <style TYPE="text/css" media="screen"> 
      html, body { margin:0; 
        padding:0; 
        background: #ffffff; 
      } 
      div#printheader { display: none; }
      #idheader { 
        width:100%; 
        height:auto; 
        padding: 0; 
        margin: 0;
        position: fixed;
        top: 0;
        z-index: 2;
      } 
      /* The "min-height" for "#idheader table" ensures that the (blue) header of the topic
         has at least the same height as the header of the navigation panel left of it */
      #idheader table { background: #2C5D88; min-height: 59px }             
      #idheader h1 { color: #FFF }     
      #idnav {
        text-align: right;
        width: 126px;
        vertical-align: middle;        
      } 
      #idnav a { text-decoration: none }
      #idnav span {
        display: inline-block;
        width: 24px;
        height: 24px;
        margin-left: 4px;
        background:url('hm_webhelp_buttons_grey.png') top left no-repeat;
      } 
      #idnav a span {
        background-image:url('hm_webhelp_buttons_white.png');
      } 
      #idnav a span:hover {
        background-image:url('hm_webhelp_buttons_orange.png');
      } 
      #idnav span.hmbtnprev { background-position: 0 -32px }
      #idnav span.hmbtnnext { background-position: -24px -32px }
      #idnav span.hmbtntop  { background-position: -48px -32px }
      #idnav span.hmbtntoggle  { width: 20px; background-position: -70px -32px }
      #idnav span.hmbtnprint  { background-position: -88px -32px }

      #callout-table, #overview-table {display:block; position:relative; top:0; left:0;}
      #callout-icon {display:block; position:absolute; top:-11px; left:-11px;}
      #callout-icon-flag {display:block; position:absolute; top:-11px; left:-8px;}
      #callout-table a {text-decoration: none; color: blue;}
      #callout-table a:visited {text-decoration: none; color: blue;}
      #overview-table a {text-decoration: none; color: black;}
      #overview-table a:visited {text-decoration: none; color: black;}
      #callout-table a:hover, #overview-table a:hover {text-decoration: underline;}       
      p.help-url { margin: 20px 0 5px 0; text-align: center; font-size: 80%; text-decoration: none }      
      #switchtoggles { text-align: right; padding: 0 2px 0 0; font-size: 90%; } 
      .sync-toc { color: #FFF; font-size: 8pt; font-weight: bold; display: none; }
      .sync-toc a { color: #FFF; text-decoration: none; font-weight: bold;}
      .sync-toc a:visited { color: #FFF; }
      .sync-toc a:hover { text-decoration: underline; }
      a.hmanchor { display: inline-block; margin-top: -4em; padding-top: 4em }	  
   </style>
   <style TYPE="text/css" media="print">
      div#idheader, img.dropdown-toggle-icon, p.help-url { display:none } 
   </style>
   <script type="text/javascript" src="jquery.js"></script>
   <script type="text/javascript" src="helpman_settings.js"></script>
   <script type="text/javascript" src="helpman_topicinit.js"></script>

   <script type="text/javascript">
     HMSyncTOC("index.html", "cpustateiprinterface-taskable2.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
<body>


<div id="printheader"><h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">CPUStateIPRInterface taskables</span></h1>
</div>
<div id="idheader">
<div id="idheaderbg">
<table style="width:100%;border:none;margin:0px;" cellspacing="0" cellpadding="0"> 
  <tr>
    <td class="topichead" style="text-align:left; vertical-align:bottom">
      <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="index.html?cpustateiprinterface-taskable2.html" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
      <p class="crumbs"><b>Navigation:</b>&nbsp;
      
      <a href="introduction.html">Introduction</a> &gt; <a href="appendix---trait-examples.html">Appendix</a> &gt; <a href="taskables.html">Taskables</a>&nbsp;&gt;</p>
   
      <h1 class="p_Heading1" style="page-break-after: avoid;"><span class="f_Heading1">CPUStateIPRInterface taskables</span></h1>

    </td>
    <td class="topichead" id="idnav">
      
      <a href="cpustateiprinterface-taskables.html" title="Previous Topic"><span class="hmbtnprev"></span></a>
      <a href="taskables.html" title="Parent Chapter"><span class="hmbtntop"></span></a>
      <a href="spam-shard-support.html" title="Next Topic"><span class="hmbtnnext"></span></a>
      
    </td>
  </tr>  
</table>
</div>
</div>  

<div id="idcontent"><div id="innerdiv">
<!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser --> 
<!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->

<!--ZOOMRESTART-->
<p class="p_Normal">Here’s the matching **System Side-Effect Checklist** for `CPUStateIPRInterface`, in the same style as the one we just did for `EV6_Hooks`.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">You can paste this straight into your docs and then refine it as we flesh the class out.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">---</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">## System Side-Effect Checklist (SSEC)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> Facility: `CPUStateIPRInterface`</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"># Purpose</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">`CPUStateIPRInterface` is the **per-CPU façade** that:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">* Provides structured access to `IPRBank` and `HWPCBBank` for a given `cpuId`.</p>
<p class="p_Normal">* Tracks **current mode**, **PAL mode**, and **interrupt / AST eligibility**.</p>
<p class="p_Normal">* Mediates **IPR read/write side effects** for EV6 (via `EV6_Hooks`).</p>
<p class="p_Normal">* Coordinates with:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> &nbsp;* `IRQController` (IPL, IER, AST eligibility)</p>
<p class="p_Normal"> &nbsp;* `ReservationManager` (clearing reservations on traps/mode changes)</p>
<p class="p_Normal"> &nbsp;* `HWPCBBank` (context save/restore)</p>
<p class="p_Normal"> &nbsp;* `Ev6PteCache` (via access permission checks)</p>
<p class="p_Normal"> &nbsp;* `GlobalSettings` (optional config, e.g. FEN / access rules)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">It doesn’t own global state; it’s a **per-CPU view** over `IPRStorage_core` + `HWPCB_core`.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">---</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">## A. Internal Operations (performed by `CPUStateIPRInterface`)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">These are operations the interface itself is responsible for, per CPU:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">| Step | Operation &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Description &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Must Trigger &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">| ---- | ---------------------------------------------------- | ------------------------------------------------------ | ------------------------------------------------- |</p>
<p class="p_Normal">| A1 &nbsp; | `state()` / `state() const` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Returns reference to `IPRStorage` for `m_cpuId` &nbsp; &nbsp; &nbsp; &nbsp;| Underpins all IPR read/write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">| A2 &nbsp; | `cpuId()` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Returns logical CPU index &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Used by all downstream modules &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">| A3 &nbsp; | `isInPalMode()` / `enterPalMode()` / `exitPalMode()` | Tracks PAL mode state for this CPU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Influences access checks, traps, PS semantics &nbsp; &nbsp; |</p>
<p class="p_Normal">| A4 &nbsp; | `currentMode()` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Returns current CM (K/E/S/U) from IPR storage &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Used by access checks &amp; hooks &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| A5 &nbsp; | `savetoPCB()` / `restoreFromPCB()` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Calls `HWPCBBank::context_save/restore` for this CPU &nbsp; | Context switch behavior &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| A6 &nbsp; | `checkAccess(va, intent, permMask)` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Performs VA+intent+mode permission check (via helper) &nbsp;| AccessResult: Allowed / Fault_xxx &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| A7 &nbsp; | `logIPRWrite(name, oldValue, newValue)` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Debug/logging for IPR writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Optional tracing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">| A8 &nbsp; | `logIPRRead(name, value)` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Debug/logging for IPR reads &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Optional tracing &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">| A9 &nbsp; | `fenEnabled()` (present or to be added) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Queries FEN / FP enable state &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Used for FP access checks &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| A10 &nbsp;| AST fields (pending/enabled masks, etc.) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Tracks per-CPU AST state (masks for ASTRR/ASTER/ASTEN) | Used by AST helpers below &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| A11 &nbsp;| `onModeChange(...)` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Reacts to CM changes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Updates internal mode + triggers downstream hooks |</p>
<p class="p_Normal">| A12 &nbsp;| `interruptEligibilityDirty()` flag (if present) &nbsp; &nbsp; &nbsp;| Tracks whether IRQ eligibility must be recomputed &nbsp; &nbsp; &nbsp;| Used by AlphaCPU/IRQ paths &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">You already have partial versions of some (e.g. `state()`, PAL mode bits, PCB save/restore, `checkAccess` wrapper); the rest we stub.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">---</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">## B. External Events Affecting `CPUStateIPRInterface`</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">These are events from other subsystems that **drive** this interface:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">| Step | External Source &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Event &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Expected Response in `CPUStateIPRInterface` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">| ---- | ---------------------------------------------------- | --------------------------------------------- | -------------------------------------------------------------------------------------------------------- |</p>
<p class="p_Normal">| B1 &nbsp; | `EV6_Hooks::onCM_Write` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| CM (Current Mode) write &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Call `onModeChange(oldCM, newCM)` and update internal CM &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| B2 &nbsp; | `EV6_Hooks::onPCTX_ASTERWrite` / `onPCTX_ASTRRWrite` | AST enable / request writes &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Update AST masks (`ASTER`, `ASTEN`, `ASTRR`) and recompute AST pending &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| B3 &nbsp; | `EV6_Hooks::onEXC_ADDR_Write` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Exception address change &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Update EXC_ADDR in IPR, call `updateExceptionState()` and `notifyExceptionAddressChanged()` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">| B4 &nbsp; | `EV6_Hooks::onEXC_SUM_Write` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Exception summary update &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Call `evaluateExceptionSummary()`, and possibly `triggerMachineCheck()` / `generateExceptionInterrupt()` |</p>
<p class="p_Normal">| B5 &nbsp; | `EV6_Hooks::onSIRRWrite` / `onIER_Write` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Software interrupt / interrupt enable changes | Mark interrupt eligibility dirty (`notifyModeChangeAffectsInterruptEligibility()` / similar) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| B6 &nbsp; | PAL executor / AlphaCPU &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Trap / exception entry/exit &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Clear reservations, update PS, CM, EXC_ADDR/EXC_SUM via IPR writes that go through this interface &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">| B7 &nbsp; | `GlobalSettings` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Changes in security or debug flags &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| May modify behavior of `checkAccess()` or logging &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">---</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">## C. Downstream Effects (side effects caused by `CPUStateIPRInterface`)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">These are **calls out to other subsystems** that CSII is expected to perform when certain events happen.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&gt; Many of these are the functions we said should exist as stubs; this table tells you where they go.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> C1. Mode &amp; PAL related</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">| Step | Called Subsystem &nbsp; &nbsp; &nbsp;| Condition &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Must Call &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| ---- | --------------------- | -------------------------------------------- | --------------------------------------------------------------------------------------------------- |</p>
<p class="p_Normal">| C1.1 | `IRQController` &nbsp; &nbsp; &nbsp; | IPL / mode changed, affects IRQ eligibility &nbsp;| e.g. `recalculateInterruptPriorities(cpuId, ierMask)` (triggered from `onModeChange` or IER writes) |</p>
<p class="p_Normal">| C1.2 | `ReservationManager` &nbsp;| Mode change, trap, REI, certain EXC_SUM bits | `ReservationManager::instance().clearReservation(cpuId)` from inside CSII helper &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">| C1.3 | `AlphaCPU` (indirect) | Mode change affects instruction fetch &nbsp; &nbsp; &nbsp; &nbsp;| Possibly triggers `flushSpeculativeState()` to discard spec state &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> C2. AST related</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">| Step | Called Subsystem | Condition &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Must Call &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| ---- | ---------------- | -------------------------------- | --------------------------------------------- |</p>
<p class="p_Normal">| C2.1 | `IRQController` &nbsp;| AST pending &amp; eligible &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Request “soft interrupt” or use AST vector &nbsp; &nbsp;|</p>
<p class="p_Normal">| C2.2 | `HWPCBBank` &nbsp; &nbsp; &nbsp;| AST state must be saved/restored | Wrap AST fields in HWPCB context_save/restore |</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> C3. Exception / trap related</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">| Step | Called Subsystem &nbsp; &nbsp; &nbsp;| Condition &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Must Call &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| ---- | --------------------- | ------------------------------------------------- | ----------------------------------------------------------------- |</p>
<p class="p_Normal">| C3.1 | `IPRBank` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | EXC_ADDR/EXC_SUM written &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Update underlying IPR storage &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| C3.2 | `IRQController` / PAL | Severe EXC_SUM (e.g. machine check) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | `triggerMachineCheck()` → which in turn arranges SCB vector, etc. |</p>
<p class="p_Normal">| C3.3 | `AlphaCPU` / PAL &nbsp; &nbsp; &nbsp;| Certain EXC_SUM bits require exception interrupts | `generateExceptionInterrupt()` to request an interrupt &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> C4. Memory / access check related</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">| Step | Called Subsystem &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Condition &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | Must Call &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</p>
<p class="p_Normal">| ---- | -------------------------- | --------------------------- | ------------------------------------------------------------------- |</p>
<p class="p_Normal">| C4.1 | `Ev6PteCache` / SafeMemory | CheckAccess result is Fault | Use return `AccessResult` to drive page-fault/trap path in AlphaCPU |</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">---</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">## D. Methods to Add / Stub in `CPUStateIPRInterface`</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">These are the functions **EV6_Hooks expects to exist** and that you can safely stub now (no-ops or minimal logic) and refine later. This is the “kill 200 errors” checklist.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">You can define them as `inline` members in `CPUStateIPRInterface`:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> D1. Mode &amp; speculative state</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">```cpp</p>
<p class="p_Normal">inline void onModeChange(quint8 /*oldCM*/, quint8 /*newCM*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: update any cached mode-derived state here.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void manageShadowBanks(quint8 /*newCM*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: swap or update shadow register banks for new mode.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void flushSpeculativeState() noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: flush branch predictor / speculative state if you model it.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void notifyModeChangeAffectsInterruptEligibility() noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: mark interrupt eligibility dirty; AlphaCPU/IRQ should re-check.</p>
<p class="p_Normal"> &nbsp; &nbsp;// e.g. m_interruptEligibilityDirty.store(true, std::memory_order_release);</p>
<p class="p_Normal">}</p>
<p class="p_Normal">```</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">(If you don’t have `oldCM` yet, you can extend the signature when you’re ready.)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> D2. AST helpers</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">```cpp</p>
<p class="p_Normal">inline void requestAST(quint8 level) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: update per-CPU AST request mask; tie to ASTRR/HWPCB.</p>
<p class="p_Normal"> &nbsp; &nbsp;level &amp;= 0x3;</p>
<p class="p_Normal"> &nbsp; &nbsp;// m_astPendingMask |= (1u &lt;&lt; level); // if you have such a field</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline bool checkPendingAST() const noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: compute ASTSR = ASTEN &amp; ASTRR with IPL gating.</p>
<p class="p_Normal"> &nbsp; &nbsp;// For now, return false to avoid spurious delivery.</p>
<p class="p_Normal"> &nbsp; &nbsp;return false;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">```</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> D3. Exception state / EXC_ADDR / EXC_SUM</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">```cpp</p>
<p class="p_Normal">inline void updateExceptionState(quint64 /*excAddr*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: track last exception address if you want debugging correlation.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void notifyExceptionAddressChanged(quint64 /*oldValue*/, quint64 /*newValue*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: optional logging hook.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void evaluateExceptionSummary(quint64 /*excSum*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: decode EXC_SUM bits, classify exception types.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline bool isHardwareErrorPresent(quint64 /*excSum*/) const noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: inspect EXC_SUM for machine-check-worthy bits.</p>
<p class="p_Normal"> &nbsp; &nbsp;return false;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void triggerMachineCheck(quint64 /*excSum*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: schedule a machine check interrupt/trap.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline bool shouldGenerateExceptionInterrupt(quint64 /*excSum*/) const noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: determine if EXC_SUM implies an interrupt, beyond trap already taken.</p>
<p class="p_Normal"> &nbsp; &nbsp;return false;</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void generateExceptionInterrupt(quint64 /*excSum*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: arrange for an interrupt at the appropriate SCB vector.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void attemptErrorRecovery(quint64 /*oldValue*/, quint64 /*newValue*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: attempt micro-architectural state recovery, if modeled.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void logExceptionSummaryChange(quint64 /*oldValue*/, quint64 /*newValue*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: add structured logging/tracing.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">```</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> D4. VA / MM_STAT helpers (IPR-level)</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">```cpp</p>
<p class="p_Normal">inline void updateVA(quint64 /*va*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: track current VA used for ITB/DTB miss PAL handlers.</p>
<p class="p_Normal">}</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">inline void updateMMStat(quint64 /*mmStat*/) noexcept {</p>
<p class="p_Normal"> &nbsp; &nbsp;// TODO: keep a decoded view of MM_STAT if needed (IME/DME/ACV/TNV).</p>
<p class="p_Normal">}</p>
<p class="p_Normal">```</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">You don’t have to *finish* their behavior now — just add them so EV6_Hooks and your IPR descriptor table have a complete, well-defined interface to call into. Then your “hooks vs. implementation” gap becomes a **finite todo list**, not a compiler error storm.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">---</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">If you’d like next, I can:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">* Take your current `Global_IPRInterface.h` and generate a **patched version** with all of these stubs added in-place, ready to drop into coreLib; or</p>
<p class="p_Normal">* Do the same style SSEC for `IRQController` so you can keep building your side-effect matrix.</p>
<p class="p_Normal">&nbsp;</p>

<!--ZOOMSTOP-->
</div></div>
<script type="text/javascript">

  

  $(document).ready(function(){
    $(window).bind('resize', function() {
      var y = $('#idheader').height(); 
      $('#idcontent').css('margin-top', y);
      var par = window.parent;
      if ($( par ).width() <= $( window ).width()+20) {
        $('#idheader').css('position', 'relative');
        $('#idcontent').css('margin-top', 0);
        $('#idbacktotop').css('display', 'block');
        $('.hmanchor').css('margin-top', -20);
	$('.hmanchor').css('padding-top', 20);
      }
      else {
        $('#idheader').css('position', 'fixed');
        $('#idcontent').css('margin-top', $('#idheader').height());
        $('#idbacktotop').css('display', 'none');
        $('.hmanchor').css('margin-top', -y-20);
	$('.hmanchor').css('padding-top', y+20);
      }
    });
    
    $(window).resize(); //trigger event for initially small displays
  });

if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) { $('.sync-toc').show();$('p.crumbs').hide();}

</script>
</body>
</html>
